# –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –±–∞–∑–∞–º –¥–∞–Ω–Ω—ã—Ö –¥–ª—è Senior ML Engineer: SQL/NoSQL + Vector DB + RAG

## –û–±—ã—á–Ω—ã–µ –ë–î

### SQL/NoSQL –∏ –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

#### –í–æ–ø—Ä–æ—Å: –ß–µ–º —Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å –ø—Ä–∏–Ω—Ü–∏–ø–∏–∞–ª—å–Ω–æ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç–Ω–æ–π/–∫–ª—é—á-–∑–Ω–∞—á–µ–Ω–∏–µ?

**–û—Ç–≤–µ—Ç:**
–†–µ–ª—è—Ü–∏–æ–Ω–Ω–∞—è ‚Äî —Å—Ç—Ä–æ–≥–∞—è —Å—Ö–µ–º–∞, –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è, —Å–≤—è–∑–∏ –∏ JOIN, —Å–∏–ª—å–Ω—ã–µ –≥–∞—Ä–∞–Ω—Ç–∏–∏ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ (constraints). –î–æ–∫—É–º–µ–Ω—Ç–Ω–∞—è ‚Äî –¥–∞–Ω–Ω—ã–µ –∫–∞–∫ –¥–æ–∫—É–º–µ–Ω—Ç—ã (JSON), —Å–ª–∞–±–µ–µ —Å–≤—è–∑–∏ (–æ–±—ã—á–Ω–æ –¥–µ–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è), —É–¥–æ–±–Ω–∞ –¥–ª—è –±—ã—Å—Ç—Ä–æ –º–µ–Ω—è—é—â–µ–π—Å—è —Å—Ö–µ–º—ã. Key-value ‚Äî —Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π –¥–æ—Å—Ç—É–ø –ø–æ –∫–ª—é—á—É, —á–∞—Å—Ç–æ –∫–∞–∫ –∫—ç—à/—Å–µ—Å—Å–∏–∏.

**–¢–µ–æ—Ä–∏—è –∏ –ø–æ–Ω–∏–º–∞–Ω–∏–µ:**

**–†–µ–ª—è—Ü–∏–æ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å (–°–£–ë–î):**
- **–°—Ö–µ–º–∞ —Å—Ç—Ä–æ–≥–∞—è**: —Ç–∞–±–ª–∏—Ü—ã —Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —Å—Ç–æ–ª–±—Ü–∞–º–∏, —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã
- **–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è**: –¥–∞–Ω–Ω—ã–µ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω—ã –ø–æ 1NF/2NF/3NF ‚Üí –º–∏–Ω–∏–º—É–º –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è
- **–°–≤—è–∑–∏ (Relations)**: —á–µ—Ä–µ–∑ –≤–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏ (Foreign Key), –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç—Å—è —Å—Å—ã–ª–æ—á–Ω–∞—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å
- **JOIN**: –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Ä–∞–∑–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü –Ω—É–∂–Ω–æ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ (–¥–æ—Ä–æ–≥–æ –ø—Ä–∏ –º–Ω–æ–≥–æ JOIN'–æ–≤)
- **ACID –≥–∞—Ä–∞–Ω—Ç–∏–∏**: –∂–µ–ª–µ–∑–Ω—ã–µ –≥–∞—Ä–∞–Ω—Ç–∏–∏ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, atomicity
- –ü—Ä–∏–º–µ—Ä: PostgreSQL, MySQL, Oracle
- **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**: —É—á—ë—Ç—ã, —Ñ–∏–Ω–∞–Ω—Å—ã, CRM, —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –∫–æ–≥–¥–∞ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –∫—Ä–∏—Ç–∏—á–Ω–∞

**–î–æ–∫—É–º–µ–Ω—Ç–Ω–∞—è –º–æ–¥–µ–ª—å (NoSQL):**
- **–°—Ö–µ–º–∞ –≥–∏–±–∫–∞—è**: –¥–æ–∫—É–º–µ–Ω—Ç—ã (JSON/BSON) –º–æ–≥—É—Ç –∏–º–µ—Ç—å —Ä–∞–∑–Ω—ã–µ –ø–æ–ª—è
- **–î–µ–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è**: –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã, –≤—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± "—Å—É—â–Ω–æ—Å—Ç–∏" –≤ –æ–¥–Ω–æ–º –¥–æ–∫—É–º–µ–Ω—Ç–µ
- **–°–ª–∞–±—ã–µ —Å–≤—è–∑–∏**: –Ω–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ JOIN, –æ–±—ã—á–Ω–æ –¥–µ–Ω–æ—Ä–º–∞–ª–∏–∑—É—é—Ç ("–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ" —Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è –ë–î)
- **–ë—ã—Å—Ç—Ä–æ –º–µ–Ω—è—é—â–∞—è—Å—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞**: –¥–æ–±–∞–≤–ª—è–ª –ø–æ–ª–µ –≤ –¥–æ–∫—É–º–µ–Ω—Ç ‚Üí –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω–µ –Ω—É–∂–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è
- –ü—Ä–∏–º–µ—Ä—ã: MongoDB, CouchDB, Firebase
- **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**: –∫—ç—à, –±—ã—Å—Ç—Ä–æ —Ä–∞–∑–≤–∏–≤–∞—é—â–∏–π—Å—è –ø—Ä–æ–¥—É–∫—Ç, document-centric –¥–∞–Ω–Ω—ã–µ, –º–Ω–æ–≥–æ –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏, –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –∫–ª–∞—Å—Ç–µ—Ä

**Key-Value (–≤–æ–æ–±—â–µ –ø—Ä–æ—Å—Ç–µ–π—à–µ–µ):**
- **–ú–∏–Ω–∏–º—É–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏**: —Ç–æ–ª—å–∫–æ get(key) ‚Üí value, set(key, value)
- **–û—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ**: —á–∞—Å—Ç–æ –≤ –ø–∞–º—è—Ç–∏, –Ω–µ—Ç –ø–∞—Ä—Å–∏–Ω–≥–∞ —Å—Ö–µ–º—ã, –Ω–µ—Ç JOIN
- **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è**: —Å–ª–æ–∂–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–µ–≤–æ–∑–º–æ–∂–Ω—ã (–Ω–µ –º–æ–∂–µ—à—å —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å, –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞—Ç—å)
- –ü—Ä–∏–º–µ—Ä—ã: Redis, Memcached, DynamoDB
- **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**: —Å–µ—Å—Å–∏–∏, –∫—ç—à, –æ—á–µ—Ä–µ–¥—å, —Å—á—ë—Ç—á–∏–∫–∏, rate limiting

**–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–º–µ—Ä (E-commerce):**

–¢–∞–±–ª–∏—Ü–∞ –∑–∞–∫–∞–∑–æ–≤ ‚Äî **—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å:**
```sql
-- PostgreSQL: –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–æ
CREATE TABLE orders (
    id SERIAL PRIMARY KEY,
    user_id INT REFERENCES users(id),
    order_date TIMESTAMP,
    total_price DECIMAL
);

CREATE TABLE order_items (
    order_id INT REFERENCES orders(id),
    product_id INT REFERENCES products(id),
    quantity INT,
    price DECIMAL
);
-- JOIN –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –¥–µ—Ç–∞–ª–µ–π –∑–∞–∫–∞–∑–∞
SELECT o.id, oi.product_id, oi.quantity 
FROM orders o 
JOIN order_items oi ON o.id = oi.order_id 
WHERE o.user_id = 123;
```

–¢–æ—Ç –∂–µ –∑–∞–∫–∞–∑ ‚Äî **–¥–æ–∫—É–º–µ–Ω—Ç–Ω–∞—è –º–æ–¥–µ–ª—å:**
```javascript
// MongoDB: –≤–µ—Å—å –∑–∞–∫–∞–∑ –≤ –æ–¥–Ω–æ–º –¥–æ–∫—É–º–µ–Ω—Ç–µ
db.orders.insertOne({
    _id: ObjectId("..."),
    user_id: 123,
    order_date: ISODate("2026-01-23"),
    total_price: 2500,
    items: [
        { product_id: 5, quantity: 2, price: 1000 },
        { product_id: 7, quantity: 1, price: 500 }
    ]
});

// –ó–∞–ø—Ä–æ—Å –ø—Ä–æ—Å—Ç–æ: –Ω–µ—Ç JOIN!
db.orders.findOne({ _id: ObjectId("...") })
```

---

#### –í–æ–ø—Ä–æ—Å: –ß—Ç–æ —Ç–∞–∫–æ–µ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è (1NF‚Äì3NF) –∏ –∑–∞—á–µ–º –æ–Ω–∞?

**–û—Ç–≤–µ—Ç:**
–£–º–µ–Ω—å—à–∞–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ, –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –∞–Ω–æ–º–∞–ª–∏–∏ –≤—Å—Ç–∞–≤–∫–∏/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è/—É–¥–∞–ª–µ–Ω–∏—è. –¶–µ–Ω–∞ ‚Äî –±–æ–ª—å—à–µ JOIN –∏ —Å–ª–æ–∂–Ω–µ–µ –∑–∞–ø—Ä–æ—Å—ã; –≤ OLTP –æ–±—ã—á–Ω–æ –Ω–æ—Ä–º–∞–ª–∏–∑—É—é—Ç, –≤ OLAP/–ø–æ–∏—Å–∫–µ —á–∞—Å—Ç–æ –¥–µ–Ω–æ—Ä–º–∞–ª–∏–∑—É—é—Ç.

**–¢–µ–æ—Ä–∏—è –∏ –ø–æ–Ω–∏–º–∞–Ω–∏–µ:**

–ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è ‚Äî —ç—Ç–æ –Ω–∞–±–æ—Ä –ø—Ä–∞–≤–∏–ª, –∫–∞–∫ **–ø—Ä–∞–≤–∏–ª—å–Ω–æ** –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –∞–Ω–æ–º–∞–ª–∏–π –∏ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è. –ï—Å—Ç—å —Ä–∞–∑–Ω—ã–µ "–Ω–æ—Ä–º–∞–ª—å–Ω—ã–µ —Ñ–æ—Ä–º—ã" (1NF, 2NF, 3NF, BCNF), –∫–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∂–µ –ø—Ä–µ–¥—ã–¥—É—â–µ–π.

**1NF (First Normal Form):**
- –í—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ —è—á–µ–π–∫–∞—Ö ‚Äî –∞—Ç–æ–º–∞—Ä–Ω—ã–µ (–Ω–µ –º–Ω–æ–∂–µ—Å—Ç–≤–∞, –Ω–µ –≤–ª–æ–∂–µ–Ω–Ω—ã–µ —Å–ø–∏—Å–∫–∏)
- –ù–µ—Ç –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è –≥—Ä—É–ø–ø —Å—Ç–æ–ª–±—Ü–æ–≤

```sql
-- –ù–µ 1NF (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
CREATE TABLE products (
    id INT,
    name TEXT,
    tags TEXT -- "–∫—Ä–∞—Å–Ω–æ–µ,—Å–∏–Ω–µ–µ,–∑–µ–ª—ë–Ω–æ–µ" ‚Äî —Å—Ç—Ä–æ–∫–∞, –Ω–µ –∞—Ç–æ–º–∞—Ä–Ω–∞—è!
);

-- 1NF (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
CREATE TABLE products (id INT, name TEXT);
CREATE TABLE product_tags (product_id INT, tag TEXT);
```

**2NF (Second Normal Form):**
- –°–Ω–∞—á–∞–ª–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å 1NF
- –ù–∏–∫–∞–∫–æ–π –Ω–µ–∫–ª—é—á–µ–≤–æ–π —Å—Ç–æ–ª–±–µ—Ü –Ω–µ –¥–æ–ª–∂–µ–Ω –∑–∞–≤–∏—Å–µ—Ç—å —Ç–æ–ª—å–∫–æ –æ—Ç **—á–∞—Å—Ç–∏** –ø–µ—Ä–≤–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞

```sql
-- –ù–µ 2NF (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
CREATE TABLE order_items (
    order_id INT,
    product_id INT,
    quantity INT,
    product_name TEXT, -- –∑–∞–≤–∏—Å–∏—Ç –¢–û–õ–¨–ö–û –æ—Ç product_id, –Ω–µ –æ—Ç –≤—Å–µ–≥–æ –∫–ª—é—á–∞ (order_id, product_id)!
    PRIMARY KEY (order_id, product_id)
);

-- 2NF (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
CREATE TABLE order_items (
    order_id INT,
    product_id INT,
    quantity INT,
    PRIMARY KEY (order_id, product_id)
);
CREATE TABLE products (id INT, name TEXT);
```

**3NF (Third Normal Form):**
- –°–Ω–∞—á–∞–ª–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å 2NF
- –ù–∏–∫–∞–∫–æ–π –Ω–µ–∫–ª—é—á–µ–≤–æ–π —Å—Ç–æ–ª–±–µ—Ü –Ω–µ –¥–æ–ª–∂–µ–Ω –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç **–¥—Ä—É–≥–æ–≥–æ** –Ω–µ–∫–ª—é—á–µ–≤–æ–≥–æ —Å—Ç–æ–ª–±—Ü–∞ (—Ç—Ä–∞–Ω–∑–∏—Ç–∏–≤–Ω–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å)

```sql
-- –ù–µ 3NF (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
CREATE TABLE orders (
    id INT PRIMARY KEY,
    user_id INT,
    user_city TEXT -- –∑–∞–≤–∏—Å–∏—Ç –æ—Ç user_id, –Ω–µ –æ—Ç id! –¢—Ä–∞–Ω–∑–∏—Ç–∏–≤–Ω–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å!
);

-- 3NF (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
CREATE TABLE orders (id INT PRIMARY KEY, user_id INT REFERENCES users(id));
CREATE TABLE users (id INT PRIMARY KEY, city TEXT);
```

**–ü–ª—é—Å—ã –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏:**
1. **–ú–∏–Ω–∏–º—É–º –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è**: –µ—Å–ª–∏ –º–µ–Ω—è–µ—Ç—Å—è –≥–æ—Ä–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –º–µ–Ω—è–µ—à—å –≤ –æ–¥–Ω–æ–º –º–µ—Å—Ç–µ
2. **–ê–Ω–æ–º–∞–ª–∏–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã**:
   - **Insertion anomaly**: –Ω–µ –º–æ–∂–µ—à—å –¥–æ–±–∞–≤–∏—Ç—å –≥–æ—Ä–æ–¥ –±–µ–∑ —é–∑–µ—Ä–∞
   - **Update anomaly**: –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ = –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫
   - **Deletion anomaly**: —É–¥–∞–ª–µ–Ω–∏–µ —é–∑–µ—Ä–∞ = —Ç–µ—Ä—è–µ—à—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≥–æ—Ä–æ–¥–µ

**–ú–∏–Ω—É—Å—ã –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏:**
1. **–ú–Ω–æ–≥–æ JOIN'–æ–≤**: –¥–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å 5+ JOIN'–æ–≤ ‚Üí –º–µ–¥–ª–µ–Ω–Ω–æ
2. **–°–ª–æ–∂–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã**: –Ω—É–∂–Ω–æ —Ö–æ—Ä–æ—à–æ –∑–Ω–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É, –ø–∏—Å–∞—Ç—å SQL —Å–ª–æ–∂–Ω–µ–µ

**–í OLTP (Online Transaction Processing)** ‚Äî –æ–±—ã—á–Ω–æ –Ω–æ—Ä–º–∞–ª–∏–∑—É—é—Ç –Ω–∞ 3NF:
- –£—á—ë—Ç—ã, —Ñ–∏–Ω–∞–Ω—Å—ã, CRM ‚Äî –º–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π, –≤–∞–∂–Ω–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å
- –ù–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —á–∏—Ç–∞—é—Ç/–ø–∏—à—É—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ ‚Üí –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Å–ø–∞—Å–∞–µ—Ç –æ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤

**–í OLAP (Online Analytical Processing)** ‚Äî —á–∞—Å—Ç–æ –¥–µ–Ω–æ—Ä–º–∞–ª–∏–∑—É—é—Ç:
- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞, –¥–∞—à–±–æ—Ä–¥—ã ‚Äî –º–Ω–æ–≥–æ —á—Ç–µ–Ω–∏–π, –º–∞–ª–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
- –î–µ–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è = –º–µ–Ω—å—à–µ JOIN'–æ–≤ = –±—ã—Å—Ç—Ä–µ–µ –∑–∞–ø—Ä–æ—Å—ã

---

#### –í–æ–ø—Ä–æ—Å: –ö–æ–≥–¥–∞ —Å–æ–∑–Ω–∞—Ç–µ–ª—å–Ω–æ –¥–µ–Ω–æ—Ä–º–∞–ª–∏–∑—É—é—Ç –¥–∞–Ω–Ω—ã–µ?

**–û—Ç–≤–µ—Ç:**
–ß—Ç–æ–±—ã —É–±—Ä–∞—Ç—å –¥–æ—Ä–æ–≥–∏–µ JOIN –Ω–∞ —á—Ç–µ–Ω–∏–∏ (read-heavy), —É–ø—Ä–æ—Å—Ç–∏—Ç—å –∑–∞–ø—Ä–æ—Å—ã, —Å–Ω–∏–∑–∏—Ç—å latency. –ö–æ–º–ø—Ä–æ–º–∏—Å—Å ‚Äî —Å–ª–æ–∂–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏ —Ä–∏—Å–∫ —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏.

**–¢–µ–æ—Ä–∏—è –∏ –ø–æ–Ω–∏–º–∞–Ω–∏–µ:**

**–î–µ–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è** ‚Äî —ç—Ç–æ **–Ω–∞–º–µ—Ä–µ–Ω–Ω–æ–µ –Ω–∞—Ä—É—à–µ–Ω–∏–µ** –Ω–æ—Ä–º–∞–ª—å–Ω—ã—Ö —Ñ–æ—Ä–º –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è —á—Ç–µ–Ω–∏—è, —Ü–µ–Ω–æ–π —É—Å–ª–æ–∂–Ω–µ–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π.

**–ö–æ–≥–¥–∞ –∏–º–µ–µ—Ç —Å–º—ã—Å–ª –¥–µ–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å:**

1. **Read-heavy –æ–ø–µ—Ä–∞—Ü–∏–∏**: –µ—Å–ª–∏ 99% –æ–ø–µ—Ä–∞—Ü–∏–π ‚Äî —á—Ç–µ–Ω–∏–µ, 1% ‚Äî –∑–∞–ø–∏—Å—å
2. **–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ JOIN'–æ–≤**: 5+ JOIN'–æ–≤ –¥–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ ‚Üí –¥–æ–ª–≥–æ
3. **–ö—Ä–∏—Ç–∏—á–Ω—ã–π latency**: –Ω—É–∂–µ–Ω –æ—á–µ–Ω—å –±—ã—Å—Ç—Ä—ã–π –æ—Ç–≤–µ—Ç (<10ms p99)
4. **–†–µ–¥–∫–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**: –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –º–µ–Ω—è—é—Ç—Å—è —Ä–∞–∑ –≤ –¥–µ–Ω—å ‚Üí –º–æ–∂–Ω–æ –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –¥–µ–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Å—Ç–æ–ª–±—Ü—ã –±–∞—Ç—á–µ–º

**–ü—Ä–∏–º–µ—Ä—ã –¥–µ–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏:**

**–ü—Ä–∏–º–µ—Ä 1: –°—á—ë—Ç—á–∏–∫ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤**
```sql
-- –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–æ (3NF):
SELECT COUNT(*) FROM comments WHERE post_id = 123; -- –∫–∞–∂–¥—ã–π —Ä–∞–∑ —Å—á–∏—Ç–∞–µ–º

-- –î–µ–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–æ:
CREATE TABLE posts (
    id INT,
    title TEXT,
    comments_count INT -- –≤—Å–µ–≥–¥–∞ –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ!
);
-- –û–±–Ω–æ–≤–ª—è–µ–º trigger'–æ–º –ø—Ä–∏ –≤—Å—Ç–∞–≤–∫–µ/—É–¥–∞–ª–µ–Ω–∏–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
CREATE TRIGGER after_comment_insert
AFTER INSERT ON comments
FOR EACH ROW
BEGIN
    UPDATE posts SET comments_count = comments_count + 1 WHERE id = NEW.post_id;
END;
```

–ü–ª—é—Å: `SELECT comments_count FROM posts WHERE id = 123` ‚Äî –æ–¥–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—è!
–ú–∏–Ω—É—Å: –Ω—É–∂–µ–Ω trigger, —Ä–∏—Å–∫ —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏, –µ—Å–ª–∏ trigger –ø–∞–¥–∞–µ—Ç

**–ü—Ä–∏–º–µ—Ä 2: –í–ª–æ–∂–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**
```sql
-- –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–æ:
CREATE TABLE users (id INT, name TEXT);
CREATE TABLE profiles (user_id INT, bio TEXT, avatar_url TEXT);
SELECT u.id, u.name, p.bio, p.avatar_url FROM users u JOIN profiles p ON u.id = p.user_id;

-- –î–µ–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–æ (–¥–æ–∫—É–º–µ–Ω—Ç–Ω–∞—è –ë–î):
db.users.find({
    _id: 123,
    name: "Ivan",
    profile: { bio: "...", avatar_url: "..." } // –≤—Å—ë –≤ –æ–¥–Ω–æ–º –¥–æ–∫—É–º–µ–Ω—Ç–µ
})
```

**–ü—Ä–∏–º–µ—Ä 3: –ü—Ä–µ–¥–≤—ã—á–∏—Å–ª–µ–Ω–Ω—ã–µ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏**
```sql
-- –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–æ (—Å—á–∏—Ç–∞–µ–º –∫–∞–∂–¥—ã–π —Ä–∞–∑):
SELECT user_id, SUM(amount) FROM transactions WHERE user_id = 123;

-- –î–µ–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–æ (–º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞):
CREATE TABLE user_balance (
    user_id INT,
    total_amount DECIMAL,
    last_updated TIMESTAMP
);
-- –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –±–∞—Ç—á–µ–º –∫–∞–∂–¥—ã–π —á–∞—Å
```

**–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –∫–æ–º–ø—Ä–æ–º–∏—Å—Å:**

| –ê—Å–ø–µ–∫—Ç | –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–æ | –î–µ–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–æ |
|--------|---------------|-----------------|
| **–°–∫–æ—Ä–æ—Å—Ç—å —á—Ç–µ–Ω–∏—è** | –ú–µ–¥–ª–µ–Ω–Ω–µ–µ (JOIN'—ã) | –ë—ã—Å—Ç—Ä–µ–µ (–Ω–µ—Ç JOIN'–æ–≤) |
| **–°–∫–æ—Ä–æ—Å—Ç—å –∑–∞–ø–∏—Å–∏** | –ë—ã—Å—Ç—Ä–µ–µ (–æ–¥–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞) | –ú–µ–¥–ª–µ–Ω–Ω–µ–µ (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–µ–∑–¥–µ) |
| **–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å** | –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞ | –•—Ä—É–ø–∫–∞—è (–Ω—É–∂–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è) |
| **–ú–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ** | –ö–æ–º–ø–∞–∫—Ç–Ω–æ | –ë–æ–ª—å—à–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è |
| **–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å** | OLTP, –º–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π | OLAP, –º–Ω–æ–≥–æ —á—Ç–µ–Ω–∏–π, —Ä–µ–¥–∫–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è |

---

### –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, ACID, –∏–∑–æ–ª—è—Ü–∏—è

#### –í–æ–ø—Ä–æ—Å: –†–∞—Å–∫—Ä–æ–π ACID –∏ –≥–¥–µ —á–∞—â–µ –≤—Å–µ–≥–æ "–±–æ–ª–∏—Ç" Isolation?

**–û—Ç–≤–µ—Ç:**
Atomicity/Consistency/Isolation/Durability. "–ë–æ–ª–∏—Ç" –∏–∑–æ–ª—è—Ü–∏—è –≤ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏–∏: –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏, –¥–µ–¥–ª–æ–∫–∏, –∞–Ω–æ–º–∞–ª–∏–∏ —á—Ç–µ–Ω–∏—è. –£—Ä–æ–≤–µ–Ω—å –∏–∑–æ–ª—è—Ü–∏–∏ –≤—ã–±–∏—Ä–∞—é—Ç –±–∞–ª–∞–Ω—Å–æ–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å ‚Üî –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å.

**–¢–µ–æ—Ä–∏—è –∏ –ø–æ–Ω–∏–º–∞–Ω–∏–µ:**

**ACID** ‚Äî —á–µ—Ç—ã—Ä–µ –≥–∞—Ä–∞–Ω—Ç–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –°–£–ë–î –¥–∞—ë—Ç –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π:

**A ‚Äî Atomicity (–ê—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å)**
–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ª–∏–±–æ **–ø–æ–ª–Ω–æ—Å—Ç—å—é –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è, –ª–∏–±–æ –Ω–µ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è –≤–æ–æ–±—â–µ**. –ù–µ—Ç —á–∞—Å—Ç–∏—á–Ω–æ–≥–æ —É—Å–ø–µ—Ö–∞.

```sql
-- –ü–µ—Ä–µ–≤–æ–¥ –¥–µ–Ω–µ–≥: 100‚ÇΩ —Å —Å—á—ë—Ç–∞ A –Ω–∞ —Å—á—ë—Ç B
BEGIN TRANSACTION;
UPDATE accounts SET balance = balance - 100 WHERE id = 'A';
UPDATE accounts SET balance = balance + 100 WHERE id = 'B';
COMMIT;

-- –ï—Å–ª–∏ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç –æ—à–∏–±–∫–∞ (–Ω–µ–≤–µ—Ä–Ω—ã–π ID, overflow –∏ —Ç.–¥.) ‚Üí ROLLBACK
-- –õ–∏–±–æ –æ–±–∞ UPDATE –≤—ã–ø–æ–ª–Ω–∏–ª–∏—Å—å, –ª–∏–±–æ –æ–±–∞ –æ—Ç–∫–∞—Ç–∏–ª–∏—Å—å
-- –ù–∏–∫–æ–≥–¥–∞: A –ø–æ—Ç–µ—Ä—è–ª 100, –∞ B –Ω–µ –ø–æ–ª—É—á–∏–ª!
```

**C ‚Äî Consistency (–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å)**
–ë–î –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –∏–∑ –æ–¥–Ω–æ–≥–æ **–ª–æ–≥–∏—á–µ—Å–∫–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ** —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ –¥—Ä—É–≥–æ–µ. –í—Å–µ constraints, triggers, –ø—Ä–∞–≤–∏–ª–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ —Å–æ–±–ª—é–¥–∞—é—Ç—Å—è.

```sql
-- Constraint: –≥–æ—Ä–æ–¥–∞ —Ç–æ–ª—å–∫–æ –∏–∑ —Å–ø–∏—Å–∫–∞ ('Moscow', 'SPB', 'NY')
ALTER TABLE users ADD CONSTRAINT check_city CHECK (city IN ('Moscow', 'SPB', 'NY'));

-- –ü–æ–ø—ã—Ç–∫–∞ –≤—Å—Ç–∞–≤–∏—Ç—å –Ω–µ–≤–µ—Ä–Ω—ã–π –≥–æ—Ä–æ–¥ ‚Üí –æ—à–∏–±–∫–∞, —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ë–î –Ω–µ –∏–∑–º–µ–Ω–∏—Ç—Å—è
INSERT INTO users (name, city) VALUES ('Ivan', 'UnknownCity'); -- FAIL
```

**I ‚Äî Isolation (–ò–∑–æ–ª—è—Ü–∏—è)** ‚Üê **–í–û–¢ –≠–¢–û –ë–û–õ–ò–¢!**
–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ, –æ–¥–Ω–∞ –Ω–µ –≤–∏–¥–∏—Ç –ø–æ–ª–æ–≤–∏–Ω—É –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥—Ä—É–≥–æ–π. –≠—Ç–æ **—Å–ª–æ–∂–Ω–∞—è —Ç–µ–º–∞** –∏–∑-–∑–∞ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏–∏.

```sql
-- –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è 1 (T1):
BEGIN;
SELECT balance FROM accounts WHERE id = 'A'; -- —á–∏—Ç–∞–µ—Ç 1000
UPDATE accounts SET balance = balance - 100 WHERE id = 'A';

-- –í —ç—Ç–æ –≤—Ä–µ–º—è –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è 2 (T2) —Ç–æ–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:
BEGIN;
SELECT balance FROM accounts WHERE id = 'A'; -- –≤–∏–¥–∏—Ç 1000 –∏–ª–∏ 900?
-- –ó–∞–≤–∏—Å–∏—Ç –æ—Ç —É—Ä–æ–≤–Ω—è –∏–∑–æ–ª—è—Ü–∏–∏!
```

**D ‚Äî Durability (–î–æ–ª–≥–æ–≤–µ—á–Ω–æ—Å—Ç—å)**
–ï—Å–ª–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –∑–∞–∫–æ–º–º–∏—á–µ–Ω–∞, –¥–∞–Ω–Ω—ã–µ **—Ç–æ—á–Ω–æ** –±—É–¥—É—Ç –Ω–∞ –¥–∏—Å–∫–µ, –¥–∞–∂–µ –µ—Å–ª–∏ –∑–∞–≤—Ç—Ä–∞ –ø–∞–¥–µ–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä–∞.

```sql
COMMIT; -- —ç—Ç–æ –∑–Ω–∞—á–∏—Ç: –¥–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∞–Ω—ã –Ω–∞ –¥–∏—Å–∫, –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ
-- –î–∞–∂–µ –µ—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä —É–ø–∞–¥—ë—Ç —Å–µ–∫—É–Ω–¥—É –ø–æ—Å–ª–µ ‚Äî –¥–∞–Ω–Ω—ã–µ –æ—Å—Ç–∞—é—Ç—Å—è
```

**–ü–æ—á–µ–º—É Isolation "–±–æ–ª–∏—Ç"?**

–ò–∑–æ–ª—è—Ü–∏—è —Å–æ–∑–¥–∞—ë—Ç **–∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –ø—Ä–∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ü–∏–∏** (–Ω–µ—Å–∫–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ):
1. **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏**: T1 –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∞ —Å—Ç—Ä–æ–∫—É ‚Üí T2 –∂–¥—ë—Ç
2. **–î–µ–¥–ª–æ–∫–∏**: T1 –∂–¥—ë—Ç T2, T2 –∂–¥—ë—Ç T1 ‚Üí –≤–∑–∞–∏–º–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞
3. **–ê–Ω–æ–º–∞–ª–∏–∏ —á—Ç–µ–Ω–∏—è**: –≤–∏–¥–∏—à—å –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ—Ç–æ–º –∏–∑–º–µ—Ä—è—é—Ç—Å—è (–¥—Ä—É–≥–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –æ—Ç–∫–∞—Ç–∏–ª–∞—Å—å)
4. **–°–ª–æ–∂–Ω–æ—Å—Ç—å –≤—ã–±–æ—Ä–∞ —É—Ä–æ–≤–Ω—è**: —Å—Ç—Ä–æ–≥–∞—è –∏–∑–æ–ª—è—Ü–∏—è = –º–µ–¥–ª–µ–Ω–Ω–æ, —Å–ª–∞–±–∞—è = —Ä–∏—Å–∫ –æ—à–∏–±–æ–∫

**–ö–æ–º–ø—Ä–æ–º–∏—Å—Å: —É—Ä–æ–≤–Ω–∏ –∏–∑–æ–ª—è—Ü–∏–∏** ‚Äî –æ—Ç —Å–ª–∞–±–æ–≥–æ –∫ —Å–∏–ª—å–Ω–æ–º—É:
- **Read Uncommitted** (—Å–ª–∞–±–æ): T1 –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å –Ω–µ–∑–∞–∫–æ–º–º–∏—á–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è T2 ‚Üí –±—ã—Å—Ç—Ä–æ, –Ω–æ –æ–ø–∞—Å–Ω–æ
- **Read Committed** (—Å—Ä–µ–¥–Ω–µ–µ): T1 —á–∏—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∑–∞–∫–æ–º–º–∏—á–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ ‚Üí —Å—Ç–∞–Ω–¥–∞—Ä—Ç
- **Repeatable Read**: –¥–∞–Ω–Ω—ã–µ, –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ –æ–¥–∏–Ω —Ä–∞–∑ ‚Üí –≤—Å–µ–≥–¥–∞ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ
- **Serializable** (—Å—Ç—Ä–æ–≥–æ): –∫–∞–∫ –±—É–¥—Ç–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ ‚Üí –º–µ–¥–ª–µ–Ω–Ω–æ, –Ω–æ –∏–¥–µ–∞–ª—å–Ω–æ

---

#### –í–æ–ø—Ä–æ—Å: –ö–∞–∫–∏–µ –∞–Ω–æ–º–∞–ª–∏–∏ —Ä–µ—à–∞—é—Ç —É—Ä–æ–≤–Ω–∏ –∏–∑–æ–ª—è—Ü–∏–∏ (dirty/non-repeatable/phantom)?

**–û—Ç–≤–µ—Ç:**
Dirty read ‚Äî —á—Ç–µ–Ω–∏–µ –Ω–µ–∑–∞–∫–æ–º–º–∏—á–µ–Ω–Ω–æ–≥–æ; non-repeatable ‚Äî –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ —á—Ç–µ–Ω–∏–µ –¥–∞—ë—Ç –¥—Ä—É–≥–æ–µ; phantom ‚Äî –Ω–æ–≤—ã–µ —Å—Ç—Ä–æ–∫–∏ –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ. Serializable —É—Å—Ç—Ä–∞–Ω—è–µ—Ç –≤—Å–µ, –Ω–æ —Å–∞–º—ã–π –¥–æ—Ä–æ–≥–æ–π.

**–¢–µ–æ—Ä–∏—è –∏ –ø–æ–Ω–∏–º–∞–Ω–∏–µ:**

–¢—Ä–∏ –æ—Å–Ω–æ–≤–Ω—ã–µ **–∞–Ω–æ–º–∞–ª–∏–∏**, –æ—Ç –∫–æ—Ç–æ—Ä—ã—Ö –∑–∞—â–∏—â–∞—é—Ç —É—Ä–æ–≤–Ω–∏ –∏–∑–æ–ª—è—Ü–∏–∏:

**1. Dirty Read (–ì—Ä—è–∑–Ω–æ–µ —á—Ç–µ–Ω–∏–µ)**

–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è T1 **—á–∏—Ç–∞–µ—Ç –Ω–µ–∑–∞–∫–æ–º–º–∏—á–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è** –æ—Ç T2.

```sql
-- T1:
BEGIN TRANSACTION;
SELECT balance FROM accounts WHERE id = 'A'; -- —á–∏—Ç–∞–µ—Ç 1000

-- T2 (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ):
BEGIN TRANSACTION;
UPDATE accounts SET balance = 500 WHERE id = 'A';
-- T2 –ù–ï –ö–û–ú–ú–ò–¢–ò–õ–ê –µ—â—ë!

-- T1 (–ø–æ—Ç–æ–º):
SELECT balance FROM accounts WHERE id = 'A'; -- –≤–∏–¥–∏—Ç 500 (–ì–†–Ø–ó–ù–´–ï –¥–∞–Ω–Ω—ã–µ!)

-- –ï—Å–ª–∏ T2 –æ—Ç–∫–∞—Ç–∏—Ç—Å—è (ROLLBACK):
-- T1 —Å—á–∏—Ç–∞–ª–∞ —Ñ–∏–∫—Ç–∏–≤–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ 500, –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω–µ—Ç –≤ –ë–î!
```

**–†–µ—à–µ–Ω–∏–µ**: —É—Ä–æ–≤–Ω–∏ **Read Committed** –∏ –≤—ã—à–µ ‚Äî —á–∏—Ç–∞–µ—à—å —Ç–æ–ª—å–∫–æ –∑–∞–∫–æ–º–º–∏—á–µ–Ω–Ω—ã–µ.

---

**2. Non-Repeatable Read (–ù–µ–ø–æ–≤—Ç–æ—Ä—è–µ–º–æ–µ —á—Ç–µ–Ω–∏–µ)**

–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è T1 —á–∏—Ç–∞–µ—Ç –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ, –Ω–æ **–ø–æ–ª—É—á–∞–µ—Ç —Ä–∞–∑–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è**.

```sql
-- T1:
BEGIN TRANSACTION;
SELECT balance FROM accounts WHERE id = 'A'; -- —á–∏—Ç–∞–µ—Ç 1000

-- T2 (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ):
BEGIN TRANSACTION;
UPDATE accounts SET balance = 900 WHERE id = 'A';
COMMIT; -- –∑–∞–∫–æ–º–º–∏—Ç–∏–ª–∞!

-- T1 (–ø–æ—Ç–æ–º):
SELECT balance FROM accounts WHERE id = 'A'; -- –≤–∏–¥–∏—Ç 900, –∞ –Ω–µ 1000!
-- –•–æ—Ç—è –≤ –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã –≤–∏–¥–µ—Ç—å –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ!
```

**–†–µ—à–µ–Ω–∏–µ**: —É—Ä–æ–≤–µ–Ω—å **Repeatable Read** ‚Äî —Ç—ã —á–∏—Ç–∞–µ—à—å "—Å–Ω–∏–º–æ–∫" –Ω–∞ –Ω–∞—á–∞–ª–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –ø–æ—Ç–æ–º –≤–∏–¥–∏—à—å —Ç–æ–ª—å–∫–æ –µ–≥–æ.

---

**3. Phantom Read (–ü—Ä–∏–∑—Ä–∞—á–Ω–∞—è —Å—Ç—Ä–æ–∫–∞)**

–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è T1 —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç —Å—Ç—Ä–æ–∫–∏, –ø–æ—Ç–æ–º **–Ω–æ–≤—ã–µ —Å—Ç—Ä–æ–∫–∏ –ø–æ—è–≤–ª—è—é—Ç—Å—è/–∏—Å—á–µ–∑–∞—é—Ç**.

```sql
-- T1:
BEGIN TRANSACTION;
SELECT COUNT(*) FROM orders WHERE status = 'pending'; -- —Å—á–∏—Ç–∞–µ—Ç 5 –∑–∞–∫–∞–∑–æ–≤

-- T2 (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ):
BEGIN TRANSACTION;
INSERT INTO orders (id, user_id, status) VALUES (999, 123, 'pending');
COMMIT; -- –¥–æ–±–∞–≤–∏–ª–∞ –Ω–æ–≤—ã–π –∑–∞–∫–∞–∑

-- T1 (–ø–æ—Ç–æ–º):
SELECT COUNT(*) FROM orders WHERE status = 'pending'; -- —Ç–µ–ø–µ—Ä—å 6! ("–ø—Ä–∏–∑—Ä–∞–∫" –ø–æ—è–≤–∏–ª—Å—è!)
```

**–†–µ—à–µ–Ω–∏–µ**: —É—Ä–æ–≤–µ–Ω—å **Serializable** ‚Äî "–∑–∞–∫—Ä—ã–≤–∞–µ—à—å" –≤–µ—Å—å –¥–∏–∞–ø–∞–∑–æ–Ω, –Ω–∏–∫—Ç–æ –Ω–µ –º–æ–∂–µ—Ç –≤—Å—Ç–∞–≤–ª—è—Ç—å/—É–¥–∞–ª—è—Ç—å.

---

**–¢–∞–±–ª–∏—Ü–∞ –∞–Ω–æ–º–∞–ª–∏–π –∏ —É—Ä–æ–≤–Ω–µ–π –∏–∑–æ–ª—è—Ü–∏–∏:**

| –ê–Ω–æ–º–∞–ª–∏—è | Read Uncommitted | Read Committed | Repeatable Read | Serializable |
|----------|------------------|-----------------|-----------------|--------------|
| **Dirty Read** | ‚úÖ (–µ—Å—Ç—å!) | ‚ùå | ‚ùå | ‚ùå |
| **Non-Repeatable Read** | ‚úÖ | ‚úÖ | ‚ùå | ‚ùå |
| **Phantom Read** | ‚úÖ | ‚úÖ | ‚úÖ (–æ–±—ã—á–Ω–æ) | ‚ùå |
| **–°–∫–æ—Ä–æ—Å—Ç—å** | ‚ö°‚ö°‚ö° (–±—ã—Å—Ç—Ä–æ) | ‚ö°‚ö° | ‚ö° | üê¢ (–º–µ–¥–ª–µ–Ω–Ω–æ) |

**–ü—Ä–∞–∫—Ç–∏–∫–∞:**
- **–ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –°–£–ë–î –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é**: Read Committed
- **PostgreSQL –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é**: Read Committed
- **MySQL (InnoDB)**: Repeatable Read
- **–î–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π** (–ø–µ—Ä–µ–≤–æ–¥—ã, –ø–ª–∞—Ç–µ–∂–∏): Serializable –∏–ª–∏ —è–≤–Ω—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏

---

#### –í–æ–ø—Ä–æ—Å: MVCC ‚Äî —á—Ç–æ —ç—Ç–æ –∏ –ø–æ—á–µ–º—É –æ–Ω–æ —É—Å–∫–æ—Ä—è–µ—Ç —á—Ç–µ–Ω–∏–µ?

**–û—Ç–≤–µ—Ç:**
Multi-Version Concurrency Control —Ö—Ä–∞–Ω–∏—Ç –≤–µ—Ä—Å–∏–∏ —Å—Ç—Ä–æ–∫; —á–∏—Ç–∞—Ç–µ–ª–∏ –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç –ø–∏—Å–∞—Ç–µ–ª–µ–π (–∏ –Ω–∞–æ–±–æ—Ä–æ—Ç) –Ω–∞ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —É—Ä–æ–≤–Ω–µ–π. –¶–µ–Ω–∞ ‚Äî –≤–∞–∫—É—É–º/GC –≤–µ—Ä—Å–∏–π –∏ —Ä–æ—Å—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è.

**–¢–µ–æ—Ä–∏—è –∏ –ø–æ–Ω–∏–º–∞–Ω–∏–µ:**

**MVCC (Multi-Version Concurrency Control)** ‚Äî —ç—Ç–æ —Ç–µ—Ö–Ω–∏–∫–∞, –∫–æ—Ç–æ—Ä–∞—è **—Ö—Ä–∞–Ω–∏—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–µ—Ä—Å–∏–π –æ–¥–Ω–æ–π –∏ —Ç–æ–π –∂–µ —Å—Ç—Ä–æ–∫–∏**, —á—Ç–æ–±—ã —á–∏—Ç–∞—Ç–µ–ª–∏ –∏ –ø–∏—Å–∞—Ç–µ–ª–∏ **–Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∏ –¥—Ä—É–≥ –¥—Ä—É–≥–∞**.

**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

–ö–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ –∏–º–µ–µ—Ç **–≤–µ—Ä—Å–∏—é** (–≤–µ—Ä—Å–∏–æ–Ω–Ω–∞—è –º–µ—Ç–∫–∞):

```
–ò—Å—Ö–æ–¥–Ω–∞—è —Å—Ç—Ä–æ–∫–∞:
| id | name   | version | xmin | xmax |
|----|--------|---------|------|------|
| 1  | Ivan   | 1       | T1   | NULL | (—Ç–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è)

T1 —á–∏—Ç–∞–µ—Ç: –≤–∏–¥–∏—Ç (id=1, name=Ivan)
T2 –ø–∏—à–µ—Ç: UPDATE users SET name='John' WHERE id=1

–†–µ–∑—É–ª—å—Ç–∞—Ç:
| id | name   | version | xmin | xmax |
|----|--------|---------|------|------|
| 1  | Ivan   | 1       | T1   | T2   | (—Å—Ç–∞—Ä–∞—è –≤–µ—Ä—Å–∏—è, –≤–∏–¥–Ω–∞ T1)
| 1  | John   | 2       | T2   | NULL | (–Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è, –≤–∏–¥–Ω–∞ –æ—Å—Ç–∞–ª—å–Ω—ã–º)

T1 (started before T2) ‚Üí –≤–∏–¥–∏—Ç —Å—Ç–∞—Ä—É—é –≤–µ—Ä—Å–∏—é (Ivan)
T3 (started after T2) ‚Üí –≤–∏–¥–∏—Ç –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é (John)
```

**–ü–æ—á–µ–º—É —ç—Ç–æ —É—Å–∫–æ—Ä—è–µ—Ç —á—Ç–µ–Ω–∏–µ?**

1. **–ù–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏**:
   - T1 —á–∏—Ç–∞–µ—Ç ‚Üí –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç T2
   - T2 –ø–∏—à–µ—Ç ‚Üí –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç T1
   - –û–±–µ —Ä–∞–±–æ—Ç–∞—é—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ!

2. **–ë–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ ‚Üí –Ω–µ—Ç –¥–µ–¥–ª–æ–∫–æ–≤**:
   - –î–µ–¥–ª–æ–∫–∏ = T1 –∂–¥—ë—Ç T2, T2 –∂–¥—ë—Ç T1
   - MVCC ‚Üí –Ω–∏–∫—Ç–æ –Ω–µ –∂–¥—ë—Ç, –≤—Å–µ –∏–¥—É—Ç —Å–≤–æ–µ–π –¥–æ—Ä–æ–≥–æ–π

3. **–ë–æ–ª–µ–µ —Å–∏–ª—å–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è –±–µ–∑ —Ü–µ–Ω—ã**:
   - Repeatable Read –∏ Snapshot Isolation ‚Üí "–±–µ—Ä—ë—à—å —Å–Ω–∏–º–æ–∫" –ë–î –≤ –Ω–∞—á–∞–ª–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
   - –î–∞–∂–µ –µ—Å–ª–∏ T2 –º–µ–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ ‚Üí —Ç—ã –≤–∏–¥–∏—à—å —Å–≤–æ–π —Å–Ω–∏–º–æ–∫

**–ú–∏–Ω—É—Å—ã MVCC:**

1. **–ë–æ–ª—å—à–µ –ø–∞–º—è—Ç–∏**: –∫–∞–∂–¥–∞—è –≤–µ—Ä—Å–∏—è = –æ—Ç–¥–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞ –¥–∏—Å–∫–µ
2. **–í–∞–∫—É—É–º (garbage collection)**: —Å—Ç–∞—Ä—ã–µ –≤–µ—Ä—Å–∏–∏ –Ω—É–∂–Ω–æ —É–¥–∞–ª—è—Ç—å, —ç—Ç–æ —Ñ–æ–Ω–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å (–º–æ–∂–µ—Ç –±—ã—Ç—å –¥–æ—Ä–æ–≥–∏–º)
3. **–°–ª–æ–∂–Ω–æ—Å—Ç—å**: –∫–æ–¥ –°–£–ë–î —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Å–ª–æ–∂–Ω–µ–µ

**–ü—Ä–∏–º–µ—Ä –∏–∑ PostgreSQL:**

```sql
-- T1:
BEGIN TRANSACTION ISOLATION LEVEL REPEATABLE READ;
SELECT * FROM users WHERE id = 1; -- –≤–∏–¥–∏—Ç (id=1, name=Ivan)

-- T2 (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ):
BEGIN TRANSACTION;
UPDATE users SET name = 'John' WHERE id = 1;
COMMIT; -- T2 –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å

-- T1 (–≤—Å—ë –µ—â—ë —Ä–∞–±–æ—Ç–∞–µ—Ç):
SELECT * FROM users WHERE id = 1; -- –í–°–ï –ï–©–Å –≤–∏–¥–∏—Ç (id=1, name=Ivan)
-- –ü–æ—Ç–æ–º—É —á—Ç–æ MVCC "–∑–∞–º–æ—Ä–æ–∑–∏–ª" —Å–Ω–∏–º–æ–∫ –Ω–∞ –Ω–∞—á–∞–ª–æ T1
COMMIT;
```

–ë–µ–∑ MVCC ‚Üí T1 –±–ª–æ–∫–∏—Ä–æ–≤–∞–ª–∞—Å—å –±—ã –Ω–∞ `SELECT`, –ø–æ—Ç–æ–º –∂–¥–∞–ª–∞ T2, –ø–æ—Ç–æ–º —á–∏—Ç–∞–ª–∞ –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ.
–° MVCC ‚Üí T1 –∏ T2 —Ä–∞–±–æ—Ç–∞—é—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ, –Ω–µ –º–µ—à–∞—è –¥—Ä—É–≥ –¥—Ä—É–≥—É.

---

#### –í–æ–ø—Ä–æ—Å: WAL/Redo log: –∑–∞—á–µ–º –Ω—É–∂–µ–Ω write-ahead logging?

**–û—Ç–≤–µ—Ç:**
–°–Ω–∞—á–∞–ª–∞ –ø–∏—à–µ–º –∂—É—Ä–Ω–∞–ª –∏–∑–º–µ–Ω–µ–Ω–∏–π, –ø–æ—Ç–æ–º –¥–∞–Ω–Ω—ã–µ. –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç durability –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è –ø–æ—Å–ª–µ –ø–∞–¥–µ–Ω–∏—è, "–¥–æ–∫–∞—Ç–∏–≤" –∫–æ–º–º–∏—Ç—ã –∏–∑ –ª–æ–≥–∞.

**–¢–µ–æ—Ä–∏—è –∏ –ø–æ–Ω–∏–º–∞–Ω–∏–µ:**

**WAL (Write-Ahead Logging)** –∏–ª–∏ **Redo Log** ‚Äî —ç—Ç–æ **–∂—É—Ä–Ω–∞–ª –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π**, –∫–æ—Ç–æ—Ä—ã–π –ø–∏—à–µ—Ç—Å—è **–ø–µ—Ä–µ–¥** —Ç–µ–º, –∫–∞–∫ –º–µ–Ω—è—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ —Ç–∞–±–ª–∏—Ü–µ.

**–ü—Ä–æ–±–ª–µ–º–∞ –±–µ–∑ WAL:**

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–æ–º–º–∏—Ç–∏—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é (UPDATE balance = 500).
–°–£–ë–î:
1. –ú–µ–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ –ø–∞–º—è—Ç–∏ (RAM)
2. –ì–æ–≤–æ—Ä–∏—Ç "–∫–æ–º–º–∏—Ç —É—Å–ø–µ—à–µ–Ω" ‚úÖ

–ù–æ –ø–æ—Ç–æ–º –°–ï–†–í–ï–† –ü–ê–î–ê–ï–¢! ‚ö†Ô∏è
- –î–∞–Ω–Ω—ã–µ –≤ RAM —Ç–µ—Ä—è—é—Ç—Å—è
- –ù–∞ –¥–∏—Å–∫–µ —Å—Ç–∞—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (balance = 1000)
- –ö–ª–∏–µ–Ω—Ç –ø–æ—Ç–µ—Ä—è–ª 500! ‚ùå
```

**–†–µ—à–µ–Ω–∏–µ: WAL**

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–æ–º–º–∏—Ç–∏—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é.
–°–£–ë–î:
1. –ü–∏—à–µ—Ç –≤ –∂—É—Ä–Ω–∞–ª (WAL): "–±—ã–ª–∞ –∑–∞–ø–∏—Å—å (id=123, name=Ivan), —Å—Ç–∞–ª–∞ (id=123, name=John)" 
   ‚Üí —ç—Ç–∞ –∑–∞–ø–∏—Å—å –í–°–ï–ì–î–ê –∏–¥—ë—Ç –Ω–∞ –¥–∏—Å–∫ (—ç—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—è!)
2. –ü–∏—à–µ—Ç –≤ –ø–∞–º—è—Ç—å (RAM): (id=123, name=John)
3. –ì–æ–≤–æ—Ä–∏—Ç "–∫–æ–º–º–∏—Ç —É—Å–ø–µ—à–µ–Ω" ‚úÖ

–ü–æ—Ç–æ–º –°–ï–†–í–ï–† –ü–ê–î–ê–ï–¢! ‚ö†Ô∏è
–ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ:
- –°–£–ë–î —á–∏—Ç–∞–µ—Ç WAL —Å –¥–∏—Å–∫–∞
- "–í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç" –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã ‚Üí –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç (id=123, name=John)
- –ì–æ—Ç–æ–≤–æ! ‚úÖ
```

**–ö–∞–∫ WAL —Ä–∞–±–æ—Ç–∞–µ—Ç (–ø–æ–¥—Ä–æ–±–Ω–µ–µ):**

```
1. –ö–ª–∏–µ–Ω—Ç: "UPDATE users SET name='John' WHERE id=123"
2. –°–£–ë–î –ø–∞—Ä—Å–∏—Ç –∫–æ–º–∞–Ω–¥—É
3. –ò—â–µ—Ç —Å—Ç—Ä–æ–∫—É (123) –≤ –ø–∞–º—è—Ç–∏/–¥–∏—Å–∫–µ
4. **–ö–õ–Æ–ß–ï–í–û–ô –®–ê–ì: –ø–∏—à–µ—Ç –≤ WAL –Ω–∞ –¥–∏—Å–∫:**
   WAL: [txn_id=T5, op=UPDATE, table=users, id=123, old_value=Ivan, new_value=John]
   fsync() ‚Üê –í–ê–ñ–ù–û! –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –∑–∞–ø–∏—Å—å –Ω–∞ –¥–∏—Å–∫ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å
5. –ü–∏—à–µ—Ç –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –±—É—Ñ–µ—Ä –ø–∞–º—è—Ç–∏
6. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫–ª–∏–µ–Ω—Ç—É: "OK, –≥–æ—Ç–æ–≤–æ"
7. **–ü–æ–∑–∂–µ** (–∫–æ–≥–¥–∞ –ø—Ä–∏–¥—ë—Ç –≤—Ä–µ–º—è): –ø–∏—à–µ—Ç –±—É—Ñ–µ—Ä –Ω–∞ –¥–∏—Å–∫ (background flushing)
```

**–ï—Å–ª–∏ –ø–∞–¥–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç:**

- **–î–æ —à–∞–≥–∞ 4** (–¥–æ WAL): –∫–æ–º–∞–Ω–¥–∞ –æ—Ç–º–µ–Ω—è–µ—Ç—Å—è, –∫–ª–∏–µ–Ω—Ç –≤–∏–¥–∏—Ç –æ—à–∏–±–∫—É ‚úÖ
- **–ü–æ—Å–ª–µ —à–∞–≥–∞ 4 (WAL –Ω–∞ –¥–∏—Å–∫–µ)**: –¥–∞–∂–µ –µ—Å–ª–∏ –ø–∞–¥–µ–Ω–∏–µ ‚Üí WAL –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ WAL:**

```
WAL File (–Ω–∞ –¥–∏—Å–∫–µ, –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å):
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ [Transaction 1]                 ‚îÇ
‚îÇ - BEGIN                         ‚îÇ
‚îÇ - UPDATE table_a SET col=123    ‚îÇ
‚îÇ - INSERT INTO table_b VALUES... ‚îÇ
‚îÇ - COMMIT                        ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ [Transaction 2]                 ‚îÇ
‚îÇ - BEGIN                         ‚îÇ
‚îÇ - DELETE FROM table_c           ‚îÇ
‚îÇ - COMMIT                        ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ [Transaction 3 - INCOMPLETE]    ‚îÇ
‚îÇ - BEGIN                         ‚îÇ
‚îÇ - UPDATE table_a SET col=456    ‚îÇ
‚îÇ (—Å–µ—Ä–≤–µ—Ä —É–ø–∞–ª –ø–µ—Ä–µ–¥ COMMIT)      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

–ü—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏:
1. T1, T2 ‚Üí –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –ø–æ–ª–Ω–æ—Å—Ç—å—é (–µ—Å—Ç—å COMMIT)
2. T3 ‚Üí –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç—Å—è (–Ω–µ—Ç COMMIT) ‚Üí –∫–∞–∫ –±—É–¥—Ç–æ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –±—ã–ª–æ

**–¢—Ä—é–∫: fsync() –∏ –¥–æ–ª–≥–æ–≤–µ—á–Ω–æ—Å—Ç—å**

```c
// –ü—Å–µ–≤–¥–æ–∫–æ–¥
write_to_file(wal_buffer, log_file);  // –ø–∏—à–µ—Ç –≤ –±—É—Ñ–µ—Ä –û–°
fsync(log_file);  // ‚ö†Ô∏è –ñ–î–Å–¢, –ø–æ–∫–∞ –¥–∏—Å–∫ —Ñ–∏–∑–∏—á–µ—Å–∫–∏ –∑–∞–ø–∏—à–µ—Ç –±–∏—Ç—ã!
                  // –≠—Ç–æ –º–µ–¥–ª–µ–Ω–Ω–µ–µ, –Ω–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç durability
```

**–ö–æ–º–ø—Ä–æ–º–∏—Å—Å:**
- **fsync=on** (—Å—Ç—Ä–æ–≥–æ–µ): –æ—á–µ–Ω—å –Ω–∞–¥—ë–∂–Ω–æ, –Ω–æ –º–µ–¥–ª–µ–Ω–Ω–µ–µ (–¥–∏—Å–∫ –∂–¥—ë—Ç –æ–ø–µ—Ä–∞—Ü–∏–∏ I/O)
- **fsync=off** (—Ä–∏—Å–∫–æ–≤–∞–Ω–Ω–æ–µ): –±—ã—Å—Ç—Ä–µ–µ, –Ω–æ –µ—Å–ª–∏ –ø–∞–¥–µ–Ω–∏–µ ‚Üí –º–æ–∂–µ—Ç –ø–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö

---

### –ò–Ω–¥–µ–∫—Å—ã –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö

#### –í–æ–ø—Ä–æ—Å: –ü–æ—á–µ–º—É B+Tree –ø–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞ –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–µ–µ B-Tree –≤ –°–£–ë–î?

**–û—Ç–≤–µ—Ç:**
B+Tree —Ö—Ä–∞–Ω–∏—Ç –¥–∞–Ω–Ω—ã–µ/—Å—Å—ã–ª–∫–∏ –≤ –ª–∏—Å—Ç—å—è—Ö –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–π –ª–∏—Å—Ç–æ–≤–æ–π —É—Ä–æ–≤–µ–Ω—å ‚Äî —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ range scan –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞. –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —É–∑–ª—ã ‚Äî —Ç–æ–ª—å–∫–æ –∫–ª—é—á–∏, –º–µ–Ω—å—à–µ I/O.

**–¢–µ–æ—Ä–∏—è –∏ –ø–æ–Ω–∏–º–∞–Ω–∏–µ:**

–û–±–∞ ‚Äî —Å–∞–º–æ–±–∞–ª–∞–Ω—Å–∏—Ä—É—é—â–∏–µ—Å—è –¥–µ—Ä–µ–≤—å—è, –Ω–æ **B+Tree** –ª—É—á—à–µ –¥–ª—è –¥–∏—Å–∫–æ–≤—ã—Ö —Ö—Ä–∞–Ω–∏–ª–∏—â (–°–£–ë–î).

**B-Tree (–∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π):**

```
        [40, 80]  ‚Üê –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —É–∑–µ–ª: –∫–ª—é—á–∏ –∏ —É–∫–∞–∑–∞—Ç–µ–ª–∏
       /    |    \
  [10,20] [50,70] [90,100]  ‚Üê –ª–∏—Å—Ç—å—è: –∫–ª—é—á–∏ –ò –¥–∞–Ω–Ω—ã–µ
```

**–í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –≤ –∫–∞–∂–¥–æ–º —É–∑–ª–µ:**
- –ö–ª—é—á = 40: –≤–æ—Ç –æ–Ω + –µ–≥–æ –¥–∞–Ω–Ω—ã–µ (–ø–æ–ª–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã)
- –ù–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∏–¥—Ç–∏ –¥–∞–ª—å—à–µ –≤ –ª–∏—Å—Ç—å—è –¥–ª—è –¥–∞–Ω–Ω—ã—Ö

**–ú–∏–Ω—É—Å—ã:**
- –ö–∞–∂–¥—ã–π —É–∑–µ–ª –±–æ–ª—å—à–æ–π (–∫–ª—é—á + –¥–∞–Ω–Ω—ã–µ) ‚Üí –º–µ–Ω—å—à–µ –∫–ª—é—á–µ–π –≤ —É–∑–ª–µ
- Range query (–Ω–∞–π—Ç–∏ –≤—Å–µ –∫–ª—é—á–∏ –æ—Ç 40 –¥–æ 80): –Ω—É–∂–Ω–æ –∏–¥—Ç–∏ –≤–≤–µ—Ä—Ö/–≤–Ω–∏–∑, —Å–ª–æ–∂–Ω–µ–µ
- –õ–∏—Å—Ç—å—è –Ω–µ —Å–≤—è–∑–∞–Ω—ã ‚Üí –Ω–µ–ª—å–∑—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ

---

**B+Tree (—Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ –¥–ª—è –°–£–ë–î):**

```
        [40, 80]  ‚Üê –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —É–∑–µ–ª: –¢–û–õ–¨–ö–û –∫–ª—é—á–∏
       /    |    \
  [10,20] [40,70] [80,100]  ‚Üê –ª–∏—Å—Ç—å—è: –¥–∞–Ω–Ω—ã–µ + —Å—Å—ã–ª–∫–∞ –Ω–∞ —Å–æ—Å–µ–¥–µ–π
         ‚Üì      ‚Üì         ‚Üì
      data1   data2    data3
      
–õ–∏—Å—Ç—å—è —Å–≤—è–∑–∞–Ω—ã:
[10,20] ‚Üê‚Üí [40,70] ‚Üê‚Üí [80,100]  (—Å–≤—è–∑–Ω—ã–π —Å–ø–∏—Å–æ–∫)
```

**–ü–ª—é—Å—ã B+Tree:**

1. **–õ–∏—Å—Ç—å—è —Å–æ–¥–µ—Ä–∂–∞—Ç –¥–∞–Ω–Ω—ã–µ, –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —É–∑–ª—ã ‚Äî —Ç–æ–ª—å–∫–æ –∫–ª—é—á–∏**:
   - –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —É–∑–ª—ã –∫–æ–º–ø–∞–∫—Ç–Ω–µ–µ ‚Üí –±–æ–ª—å—à–µ –∫–ª—é—á–µ–π –≤ –ø–∞–º—è—Ç–∏
   - –ú–µ–Ω—å—à–µ I/O –æ–ø–µ—Ä–∞—Ü–∏–π

2. **–õ–∏—Å—Ç—å—è —Å–≤—è–∑–∞–Ω—ã (linked list)**:
   - Range query (–Ω–∞–π—Ç–∏ –æ—Ç A –¥–æ B): –∏–¥—ë—à—å –≤ –ª–∏—Å—Ç—å—è, –ø–æ—Ç–æ–º —Å–∫–∞–Ω –ø–æ —Å—Å—ã–ª–∫–∞–º
   - –û—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ, –≤—Å—ë –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ (linear read —Å –¥–∏—Å–∫–∞)

3. **–û—Ç–ª–∏—á–Ω–æ –¥–ª—è –¥–∏—Å–∫–æ–≤**:
   - –î–∏—Å–∫–æ–≤–∞—è I/O –æ—á–µ–Ω—å –º–µ–¥–ª–µ–Ω–Ω–∞
   - –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –∑–∞–ø–∏—Å—å ‚Üí —Ö–æ—Ä–æ—à–∞—è –ø—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å
   - B-Tree ‚Üí –º–Ω–æ–≥–æ –ø—Ä—ã–≥–∞–Ω–∏–π –≤ –ø–∞–º—è—Ç–∏ ‚Üí –º–µ–¥–ª–µ–Ω–Ω–µ–µ

**–ü—Ä–∏–º–µ—Ä: –¥–∏–∞–ø–∞–∑–æ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å "–≤—Å–µ —é–∑–µ—Ä—ã —Å ID –æ—Ç 100 –¥–æ 500"**

**B-Tree:**
```
1. –ù–∞–π–¥–∏ 100 –≤ –¥–µ—Ä–µ–≤–µ ‚Üí –∑–∞—à—ë–ª –≤ —É–∑–µ–ª [50, 150]
2. –í–æ–∑—å–º–∏ 100 + –µ–≥–æ –¥–∞–Ω–Ω—ã–µ
3. –ù–∞–π–¥–∏ 101 ‚Üí –º–æ–∂–µ—à—å –±—ã—Ç—å –≤ –¥—Ä—É–≥–æ–º —É–∑–ª–µ
4. –ü–æ–≤—Ç–æ—Ä—è–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª—é—á–∞
= –ú–Ω–æ–≥–æ —Å–∫–∞—á–∫–æ–≤ –≤ –ø–∞–º—è—Ç–∏, –º–Ω–æ–≥–æ I/O
```

**B+Tree:**
```
1. –ù–∞–π–¥–∏ 100 –≤ –ª–∏—Å—Ç—å—è—Ö (–∏–Ω–¥–µ–∫—Å —É–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ä–∞–∑—É)
2. –í–æ–∑—å–º–∏ 100 + –µ–≥–æ –¥–∞–Ω–Ω—ã–µ
3. –ü–µ—Ä–µ–π–¥–∏ –ø–æ —Å—Å—ã–ª–∫–µ –∫ 101 (–≤ –ø–∞–º—è—Ç–∏ –ª–∏—Å—Ç—å—è —Ä—è–¥–æ–º)
4. –ü–æ–≤—Ç–æ—Ä—è–π, –ø–æ–∫–∞ –Ω–µ –¥–æ–π–¥—ë—à—å –¥–æ 500
= –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π —Å–∫–∞–Ω, —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ!
```

**–†–µ–∞–ª—å–Ω—ã–µ —Ü–∏—Ñ—Ä—ã:**
- B-Tree: 1000 –æ–ø–µ—Ä–∞—Ü–∏–π I/O –Ω–∞ –¥–∏–∞–ø–∞–∑–æ–Ω –∏–∑ 100 000 —ç–ª–µ–º–µ–Ω—Ç–æ–≤
- B+Tree: 50 –æ–ø–µ—Ä–∞—Ü–∏–π I/O (20x –±—ã—Å—Ç—Ä–µ–µ!)

**–ü–æ—ç—Ç–æ–º—É –ø–æ—á—Ç–∏ –≤—Å–µ –°–£–ë–î –∏—Å–ø–æ–ª—å–∑—É—é—Ç B+Tree –¥–ª—è –∏–Ω–¥–µ–∫—Å–æ–≤:**
- PostgreSQL: B+Tree
- MySQL: B+Tree
- SQLite: B+Tree
- Oracle: B+Tree

---

#### –í–æ–ø—Ä–æ—Å: –ß—Ç–æ —Ç–∞–∫–æ–µ covering index –∏ –ø–æ—á–µ–º—É –æ–Ω —É—Å–∫–æ—Ä—è–µ—Ç –∑–∞–ø—Ä–æ—Å?

**–û—Ç–≤–µ—Ç:**
–ò–Ω–¥–µ–∫—Å "–ø–æ–∫—Ä—ã–≤–∞–µ—Ç" –∑–∞–ø—Ä–æ—Å, –µ—Å–ª–∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –Ω—É–∂–Ω—ã–µ –ø–æ–ª—è (—á–µ—Ä–µ–∑ INCLUDE/–∫–ª—é—á–∏) ‚Äî –º–æ–∂–Ω–æ –Ω–µ —Ö–æ–¥–∏—Ç—å –≤ —Ç–∞–±–ª–∏—Ü—É (index-only scan), –º–µ–Ω—å—à–µ random I/O.

**–¢–µ–æ—Ä–∏—è –∏ –ø–æ–Ω–∏–º–∞–Ω–∏–µ:**

**–û–±—ã—á–Ω—ã–π –∏–Ω–¥–µ–∫—Å:**

```sql
CREATE INDEX idx_users_name ON users(name);
```

–ò–Ω–¥–µ–∫—Å —Å–æ–¥–µ—Ä–∂–∏—Ç: `[name ‚Üí user_id]` (–∫–ª—é—á ‚Üí —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ —Å—Ç—Ä–æ–∫—É –≤ —Ç–∞–±–ª–∏—Ü–µ)

```
–ó–∞–ø—Ä–æ—Å: SELECT id, name FROM users WHERE name = 'Ivan'

–®–∞–≥–∏:
1. –ò—â—É –≤ –∏–Ω–¥–µ–∫—Å–µ idx_users_name ‚Üí –Ω–∞—à—ë–ª "Ivan"
2. –ò–Ω–¥–µ–∫—Å —Å–∫–∞–∂–µ—Ç: "—ç—Ç–æ user_id = 123"
3. –ò–¥—É –≤ —Ç–∞–±–ª–∏—Ü—É users –∑–∞ —Å—Ç—Ä–æ–∫–æ–π id=123 ‚Üí —á–∏—Ç–∞—é –≤—Å—ë (id, name, email, password, ...)
4. –í–æ–∑–≤—Ä–∞—â–∞—é (id=123, name=Ivan)

–ü—Ä–æ–±–ª–µ–º–∞: –Ω—É–∂–Ω—ã 2 I/O –æ–ø–µ—Ä–∞—Ü–∏–∏:
- 1 –∫ –∏–Ω–¥–µ–∫—Å—É (–±—ã—Å—Ç—Ä–æ)
- 1 –∫ —Ç–∞–±–ª–∏—Ü–µ (–º–µ–¥–ª–µ–Ω–Ω–µ–µ, random access)
```

---

**Covering Index:**

```sql
-- –î–æ–±–∞–≤–ª—è—é INCLUDE –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –¥–æ–±–∞–≤–ª—è—é –≤ –∏–Ω–¥–µ–∫—Å –Ω—É–∂–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏
CREATE INDEX idx_users_name_covering ON users(name) INCLUDE (id);
-- –ò–ª–∏ –≤ PostgreSQL:
CREATE INDEX idx_users_name_covering ON users(name) INCLUDE (id);
-- –ò–ª–∏ –ø—Ä–æ—Å—Ç–æ —Å–¥–µ–ª–∞—Ç—å (name, id) –≤ –¥—Ä—É–≥–∏—Ö –°–£–ë–î
```

–ò–Ω–¥–µ–∫—Å —Å–æ–¥–µ—Ä–∂–∏—Ç: `[name ‚Üí id, name]` (–∫–ª—é—á + –≤—Å–µ –Ω—É–∂–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)

```
–ó–∞–ø—Ä–æ—Å: SELECT id, name FROM users WHERE name = 'Ivan'

–®–∞–≥–∏:
1. –ò—â—É –≤ –∏–Ω–¥–µ–∫—Å–µ idx_users_name_covering ‚Üí –Ω–∞—à—ë–ª "Ivan"
2. –í –∏–Ω–¥–µ–∫—Å–µ –∂–µ –ï–°–¢–¨ id –∏ name! –ù–∏—á–µ–≥–æ –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω–æ
3. –í–æ–∑–≤—Ä–∞—â–∞—é —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏–∑ –∏–Ω–¥–µ–∫—Å–∞

–ü–ª—é—Å: —Ç–æ–ª—å–∫–æ 1 I/O –æ–ø–µ—Ä–∞—Ü–∏—è (–∫ –∏–Ω–¥–µ–∫—Å—É)
–ù–µ—Ç need –∏–¥—Ç–∏ –≤ —Ç–∞–±–ª–∏—Ü—É!
```

**–≠—Ç–æ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è "index-only scan"** –≤ –°–£–ë–î.

**–ö–æ–≥–¥–∞ —ç—Ç–æ –∏–º–µ–µ—Ç —Å–º—ã—Å–ª:**

1. **–ß–∞—Å—Ç—ã–µ –∑–∞–ø—Ä–æ—Å—ã, —á–∏—Ç–∞—é—â–∏–µ –º–∞–ª–æ –∫–æ–ª–æ–Ω–æ–∫**:
   ```sql
   -- –ß–∞—Å—Ç–æ —ç—Ç–æ —Å–ø—Ä–∞—à–∏–≤–∞—é—Ç:
   SELECT id, name FROM users WHERE email = 'ivan@example.com'
   
   -- –°–æ–∑–¥–∞—ë–º covering index:
   CREATE INDEX idx_email_covering ON users(email) INCLUDE (id, name);
   ```

2. **SELECT —Å few –ø–æ–ª–µ–π, WHERE —Å –¥—Ä—É–≥–∏–º –ø–æ–ª–µ–º**:
   ```sql
   SELECT name, email FROM users WHERE user_id = 123;
   
   -- –û–±—ã—á–Ω—ã–π –∏–Ω–¥–µ–∫—Å –Ω–∞ user_id ‚Üí –∏–¥—ë—à—å –≤ —Ç–∞–±–ª–∏—Ü—É –∑–∞ name, email
   -- Covering index: CREATE INDEX ... ON users(user_id) INCLUDE (name, email);
   ```

3. **–ë–æ–ª—å—à–∞—è —Ç–∞–±–ª–∏—Ü–∞, –Ω—É–∂–Ω—ã few –ø–æ–ª—è**:
   ```sql
   -- –¢–∞–±–ª–∏—Ü–∞ users: 1 –º–ª–Ω —Å—Ç—Ä–æ–∫, 30 –∫–æ–ª–æ–Ω–æ–∫, –∫–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ 10 KB
   -- –ò–Ω–¥–µ–∫—Å: 100 MB, covering index: 150 MB
   -- –¢–∞–±–ª–∏—Ü–∞: 10 GB
   -- –≠–∫–æ–Ω–æ–º–∏–º random access –≤ 10 GB —Ç–∞–±–ª–∏—Ü—É!
   ```

**–ú–∏–Ω—É—Å—ã covering index:**

1. **–ë–æ–ª—å—à–µ –º–µ—Å—Ç–∞**: –∏–Ω–¥–µ–∫—Å —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–æ–ø. –¥–∞–Ω–Ω—ã–µ ‚Üí –±–æ–ª—å—à–µ –¥–∏—Å–∫–æ–≤–æ–≥–æ –º–µ—Å—Ç–∞
2. **–ú–µ–¥–ª–µ–Ω–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**: –∏–∑–º–µ–Ω–∏–ª name ‚Üí –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å (–æ–±—ã—á–Ω–æ –±—ã—Å—Ç—Ä–æ) + covering –∏–Ω–¥–µ–∫—Å (—á—É—Ç—å –¥–æ–ª—å—à–µ)
3. **–ù—É–∂–Ω–æ –≤—ã–±–∏—Ä–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ**: –µ—Å–ª–∏ creating covering index –Ω–∞ 30 –ø–æ–ª–µ–π ‚Üí —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ copy —Ç–∞–±–ª–∏—Ü—ã, –±–µ—Å–ø–æ–ª–µ–∑–Ω–æ

**–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–º–µ—Ä (E-commerce):**

```sql
-- –¢–∞–±–ª–∏—Ü–∞ –∑–∞–∫–∞–∑–æ–≤: –æ—á–µ–Ω—å –±–æ–ª—å—à–∞—è, –º–Ω–æ–≥–æ –ø–æ–ª–µ–π
CREATE TABLE orders (
    id INT PRIMARY KEY,
    user_id INT,
    product_id INT,
    quantity INT,
    price DECIMAL,
    order_date TIMESTAMP,
    status VARCHAR,
    ... 50 –¥—Ä—É–≥–∏—Ö –ø–æ–ª–µ–π ...
);

-- –ß–∞—Å—Ç–æ —Å–ø—Ä–∞—à–∏–≤–∞–µ–º:
SELECT user_id, product_id, quantity, price 
FROM orders 
WHERE status = 'delivered' AND order_date > '2026-01-01';

-- –û–±—ã—á–Ω—ã–π –∏–Ω–¥–µ–∫—Å (–ø–ª–æ—Ö–æ):
CREATE INDEX idx_orders_status ON orders(status);
-- ‚Üí –∏—â–µ–º –≤—Å–µ delivered ‚Üí –∏–¥—ë–º –≤ —Ç–∞–±–ª–∏—Ü—É –∑–∞ product_id, quantity, price

-- Covering index (—Ö–æ—Ä–æ—à–æ):
CREATE INDEX idx_orders_status_covering 
  ON orders(status) 
  INCLUDE (product_id, quantity, price);
-- ‚Üí –∏—â–µ–º –≤ –∏–Ω–¥–µ–∫—Å–µ ‚Üí –≤—Å—ë —Ç–∞–º –µ—Å—Ç—å ‚Üí –Ω–µ—Ç –¥–æ–ø. I/O!
```

---

#### –í–æ–ø—Ä–æ—Å: –°–æ—Å—Ç–∞–≤–Ω–æ–π –∏–Ω–¥–µ–∫—Å: –ø–æ—á–µ–º—É –ø–æ—Ä—è–¥–æ–∫ –∫–æ–ª–æ–Ω–æ–∫ –≤–∞–∂–µ–Ω?

**–û—Ç–≤–µ—Ç:**
–†–∞–±–æ—Ç–∞–µ—Ç –ª–µ–≤—ã–π –ø—Ä–µ—Ñ–∏–∫—Å: (a,b,c) –ø–æ–º–æ–≥–∞–µ—Ç –ø–æ a, a+b, a+b+c; –Ω–æ –Ω–µ –ø–æ b –±–µ–∑ a. –ü–æ—Ä—è–¥–æ–∫ –≤—ã–±–∏—Ä–∞—é—Ç –ø–æ —Å–µ–ª–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏ —Ç–∏–ø–∏—á–Ω—ã–º —Ñ–∏–ª—å—Ç—Ä–∞–º.

**–¢–µ–æ—Ä–∏—è –∏ –ø–æ–Ω–∏–º–∞–Ω–∏–µ:**

**–°–æ—Å—Ç–∞–≤–Ω–æ–π –∏–Ω–¥–µ–∫—Å** ‚Äî –∏–Ω–¥–µ–∫—Å –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –∫–æ–ª–æ–Ω–∫–∞–º –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.

```sql
CREATE INDEX idx_composite ON users(name, email, age);
```

**–ü—Ä–∞–≤–∏–ª–æ: –ª–µ–≤—ã–π –ø—Ä–µ—Ñ–∏–∫—Å (leftmost prefix)**

–ò–Ω–¥–µ–∫—Å —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—à—å –∫–æ–ª–æ–Ω–∫–∏ **—Å–ª–µ–≤–∞ –Ω–∞–ø—Ä–∞–≤–æ** –±–µ–∑ –ø—Ä–æ–ø—É—Å–∫–æ–≤:

```
–ò–Ω–¥–µ–∫—Å: (name, email, age)

‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç (–ø–æ–¥—Ö–æ–¥–∏—Ç –∏–Ω–¥–µ–∫—Å):
- (name)                    ‚Äî –ª–µ–≤—ã–π –ø—Ä–µ—Ñ–∏–∫—Å
- (name, email)             ‚Äî –ª–µ–≤—ã–π –ø—Ä–µ—Ñ–∏–∫—Å
- (name, email, age)        ‚Äî –ø–æ–ª–Ω–æ—Å—Ç—å—é
- (name, age) ‚Üí ? –ú–û–ñ–ï–¢ –ë–´–¢–¨ (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –°–£–ë–î)

‚ùå –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç (—Å–∫–∏–ø –∏–Ω–¥–µ–∫—Å, sequential scan):
- (email)                   ‚Äî –ø—Ä–æ–ø—É—Å—Ç–∏–ª–∏ name!
- (email, age)              ‚Äî –ø—Ä–æ–ø—É—Å—Ç–∏–ª–∏ name!
- (age)                     ‚Äî –ø—Ä–æ–ø—É—Å—Ç–∏–ª–∏ name –∏ email!
```

**–ü–æ—á–µ–º—É —Ç–∞–∫?** –ü–æ—Ç–æ–º—É —á—Ç–æ –∏–Ω–¥–µ–∫—Å **–æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω** –ø–æ –ø–µ—Ä–≤–æ–π –∫–æ–ª–æ–Ω–∫–µ:

```
B+Tree –∏–Ω–¥–µ–∫—Å (name, email, age):

Level 1:  [A...G]  [G...M]  [M...Z]  ‚Üê –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ –ø–æ NAME
         /        |        \
       ...       ...       ...

–õ–∏—Å—Ç—å—è:
[Alice, a@...] [Alice, b@...] [Bob, x@...] [Bob, y@...] [Carol, ...]
     ‚Üë
–û—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ –ü–û NAME, –ø–æ—Ç–æ–º –ø–æ EMAIL –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–≥–æ NAME
```

–ï—Å–ª–∏ –∏—â–µ—à—å –ø–æ `email` –ë–ï–ó `name`:
- –ù–µ –∑–Ω–∞–µ—à—å, –≤ –∫–∞–∫–æ–π —á–∞—Å—Ç–∏ –¥–µ—Ä–µ–≤–∞ –Ω–∞—á–∏–Ω–∞—Ç—å
- –ù—É–∂–Ω–æ —Å–∫—ç–Ω–∏—Ä–æ–≤–∞—Ç—å –≤—Å—ë –¥–µ—Ä–µ–≤–æ
- –õ—É—á—à–µ –ø—Ä–æ—Å—Ç–æ sequential scan –≤ —Ç–∞–±–ª–∏—Ü–µ

---

**–ü–æ—Ä—è–¥–æ–∫ –∫–æ–ª–æ–Ω–æ–∫ –≤ –∏–Ω–¥–µ–∫—Å–µ:**

–í—ã–±–æ—Ä –º–µ–∂–¥—É `(a, b, c)` –∏ `(a, c, b)` –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∑–∞–ø—Ä–æ—Å–æ–≤:

**–°—Ü–µ–Ω–∞—Ä–∏–π 1: —á–∞—Å—Ç–æ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç–µ –ø–æ (name, email)**
```sql
SELECT * FROM users WHERE name = 'Alice' AND email = 'a@example.com';
```
–ò–Ω–¥–µ–∫—Å: `(name, email, age)` ‚Äî –∏–¥–µ–∞–ª—å–Ω–æ!
- –°–Ω–∞—á–∞–ª–∞ —Ñ–∏–ª—å—Ç—Ä –ø–æ name ‚Üí —Å—É–∂–∞–µ—Ç –¥–∏–∞–ø–∞–∑–æ–Ω
- –ü–æ—Ç–æ–º –ø–æ email ‚Üí –µ—â—ë —Å—É–∂–∞–µ—Ç
- age –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Ñ–∏–ª—å—Ç—Ä–µ, –Ω–æ –ø–æ–º–æ–≥–∞–µ—Ç –ø—Ä–∏ SELECT *

---

**–°—Ü–µ–Ω–∞—Ä–∏–π 2: —á–∞—Å—Ç–æ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç–µ –ø–æ (name) –∏ —Å–æ—Ä—Ç–∏—Ä—É–µ—Ç–µ –ø–æ (age)**
```sql
SELECT * FROM users WHERE name = 'Alice' ORDER BY age;
```
–ò–Ω–¥–µ–∫—Å: `(name, age)` ‚Äî –ª—É—á—à–µ!
- –§–∏–ª—å—Ç—Ä –ø–æ name
- age —É–∂–µ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –≤ –∏–Ω–¥–µ–∫—Å–µ ‚Üí ORDER BY "–±–µ—Å–ø–ª–∞—Ç–Ω—ã–π"

---

**–°—Ü–µ–Ω–∞—Ä–∏–π 3: —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ —Ä–∞–≤–µ–Ω—Å—Ç–≤–æ –∏ –¥–∏–∞–ø–∞–∑–æ–Ω**
```sql
SELECT * FROM users WHERE name = 'Alice' AND age > 30;
```
–ò–Ω–¥–µ–∫—Å: `(name, age)` ‚Äî –∏–¥–µ–∞–ª—å–Ω–æ!
- name = 'Alice' ‚Üí —Å—É–∂–∞–µ—Ç –∫ Alice'—Å–∞–º
- age > 30 ‚Üí range scan –≤ —ç—Ç–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ

–ï—Å–ª–∏ –∏–Ω–¥–µ–∫—Å `(age, name)`:
- –ù–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å age –¥–ª—è range, –µ—Å–ª–∏ —Å–Ω–∞—á–∞–ª–∞ –Ω–µ—Ç name
- –•—É–∂–µ

---

**–ü—Ä–∞–≤–∏–ª–æ –≤—ã–±–æ—Ä–∞ –ø–æ—Ä—è–¥–∫–∞ (ESR –ø—Ä–∞–≤–∏–ª–æ):**

**E**quality, **S**ort, **R**ange ‚Äî –ø–æ—Ä—è–¥–æ–∫ –∫–æ–ª–æ–Ω–æ–∫ –≤ –∏–Ω–¥–µ–∫—Å–µ:

1. **Equality** –∫–æ–ª–æ–Ω–∫–∏ (—á–∞—Å—Ç–æ –≤ WHERE —Å =):
   ```
   WHERE name = 'Alice'  ‚Üê —Ä–∞–≤–µ–Ω—Å—Ç–≤–æ
   ```

2. **Sort** –∫–æ–ª–æ–Ω–∫–∏ (–≤ ORDER BY):
   ```
   ORDER BY age  ‚Üê —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
   ```

3. **Range** –∫–æ–ª–æ–Ω–∫–∏ (–≤ WHERE —Å <, >, BETWEEN):
   ```
   WHERE salary > 100000  ‚Üê –¥–∏–∞–ø–∞–∑–æ–Ω
   ```

**–ü—Ä–∏–º–µ—Ä:**
```sql
-- –ó–∞–ø—Ä–æ—Å:
SELECT * FROM users 
WHERE name = 'Alice' 
  AND salary > 50000 
ORDER BY age;

-- –ò–Ω–¥–µ–∫—Å –ø–æ ESR –ø—Ä–∞–≤–∏–ª—É:
CREATE INDEX idx_esr ON users(
    name,        -- E (Equality)
    age,         -- S (Sort)
    salary       -- R (Range)
);
```

---

**–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–º–µ—Ä (E-commerce):**

```sql
-- –ß–∞—Å—Ç–æ —Å–ø—Ä–∞—à–∏–≤–∞–µ–º:
SELECT * FROM products 
WHERE category_id = 5 AND price > 1000 
ORDER BY popularity DESC;

-- –ù–µ—É–¥–∞—á–Ω—ã–π –∏–Ω–¥–µ–∫—Å:
CREATE INDEX bad_idx ON products(price, category_id, popularity);
-- ‚Üí price ‚Äî –¥–∏–∞–ø–∞–∑–æ–Ω, –Ω–æ –æ–Ω –ø–µ—Ä–≤—ã–π! –ù—É–∂–Ω–æ —Å–∫—ç–Ω–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Å—å –¥–∏–∞–ø–∞–∑–æ–Ω —Ü–µ–Ω

-- –•–æ—Ä–æ—à–∏–π –∏–Ω–¥–µ–∫—Å (ESR):
CREATE INDEX good_idx ON products(
    category_id,    -- E (category = 5)
    popularity,     -- S (ORDER BY)
    price           -- R (price > 1000)
);
-- ‚Üí —Å–Ω–∞—á–∞–ª–∞ —Å—É–∂–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é, –ø–æ—Ç–æ–º –∏—Å–ø–æ–ª—å–∑—É–µ–º sort, –ø–æ—Ç–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω

-- –ò–ª–∏ –µ—Å–ª–∏ range –≤–∞–∂–Ω–µ–µ sort:
CREATE INDEX alt_idx ON products(
    category_id,    -- E
    price,          -- R
    popularity      -- S (–ø–æ—Å–ª–µ range)
);
```

---

#### –í–æ–ø—Ä–æ—Å: –ö–æ–≥–¥–∞ hash-index –ø–æ–ª–µ–∑–µ–Ω, –∞ –∫–æ–≥–¥–∞ –≤—Ä–µ–¥–µ–Ω?

**–û—Ç–≤–µ—Ç:**
–ü–æ–ª–µ–∑–µ–Ω –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ —Ä–∞–≤–µ–Ω—Å—Ç–≤–∞ –ø–æ –∫–ª—é—á—É. –í—Ä–µ–¥–µ–Ω –¥–ª—è –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤/ORDER BY. –í –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –°–£–ë–î (–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è—Ö) –∏–º–µ–µ—Ç –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –ø–æ durability/—Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏.

**–¢–µ–æ—Ä–∏—è –∏ –ø–æ–Ω–∏–º–∞–Ω–∏–µ:**

**Hash –∏–Ω–¥–µ–∫—Å** ‚Äî –ø—Ä–æ—Å—Ç–æ–π –∏–Ω–¥–µ–∫—Å, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ö–µ—à-—Ç–∞–±–ª–∏—Ü—É –≤–º–µ—Å—Ç–æ –¥–µ—Ä–µ–≤–∞.

```
Hash —Ç–∞–±–ª–∏—Ü–∞:
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ hash(name) % size ‚Üí —É–∫–∞–∑–∞—Ç–µ–ª—å    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ 0:  ‚Üí (id=1, name='Alice')      ‚îÇ
‚îÇ 1:  ‚Üí (id=5, name='Bob')        ‚îÇ
‚îÇ 2:  ‚Üí (id=3, name='Carol')      ‚îÇ
‚îÇ 3:  ‚Üí NULL                      ‚îÇ
‚îÇ ...                             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ö–æ–≥–¥–∞ –ø–æ–ª–µ–∑–µ–Ω:**

1. **–¢–æ—á–Ω–æ–µ —Ä–∞–≤–µ–Ω—Å—Ç–≤–æ**:
   ```sql
   SELECT * FROM users WHERE name = 'Alice';
   -- hash('Alice') ‚Üí –ø–æ–∑–∏—Ü–∏—è –≤ —Ç–∞–±–ª–∏—Ü–µ ‚Üí O(1) –ø–æ –ø–∞–º—è—Ç–∏
   -- vs B+Tree ‚Üí O(log N)
   ```

2. **–û—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞**:
   ```sql
   SELECT * FROM sessions WHERE session_id = 'abc123xyz';
   -- Hash –∏–Ω–¥–µ–∫—Å: 1 –æ–ø–µ—Ä–∞—Ü–∏—è
   -- B+Tree –∏–Ω–¥–µ–∫—Å: log N –æ–ø–µ—Ä–∞—Ü–∏–π
   ```

**–ö–æ–≥–¥–∞ –≤—Ä–µ–¥–µ–Ω:**

1. **–î–∏–∞–ø–∞–∑–æ–Ω—ã –ù–ï —Ä–∞–±–æ—Ç–∞—é—Ç**:
   ```sql
   SELECT * FROM users WHERE age > 30 AND age < 40;
   -- Hash –∏–Ω–¥–µ–∫—Å ‚Üí ???
   -- –ö–∞–∫ –Ω–∞–π—Ç–∏ –≤—Å–µ —Ö–µ—à–∏ –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ [30, 40)? –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ!
   -- –ù—É–∂–Ω–æ sequential scan
   
   -- B+Tree ‚Üí range scan –≤ –ª–∏—Å—Ç—å—è—Ö ‚Üí –±—ã—Å—Ç—Ä–æ
   ```

2. **ORDER BY –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç**:
   ```sql
   SELECT * FROM users WHERE name = 'Alice' ORDER BY salary;
   -- Hash –∏–Ω–¥–µ–∫—Å ‚Üí –Ω–∞—à–ª–∏ Alice, –ø–æ—Ç–æ–º –Ω—É–∂–Ω–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
   -- B+Tree ‚Üí –Ω–∞—à–ª–∏ Alice, –¥–∞–Ω–Ω—ã–µ —É–∂–µ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã (–µ—Å–ª–∏ –∏–Ω–¥–µ–∫—Å (name, salary))
   ```

3. **IN –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ**:
   ```sql
   SELECT * FROM users WHERE name IN ('Alice', 'Bob', 'Carol');
   -- Hash –∏–Ω–¥–µ–∫—Å ‚Üí 3 –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ø–æ–∏—Å–∫–∞
   -- B+Tree ‚Üí 1 range scan (–µ—Å–ª–∏ –∏–º–µ–Ω–∞ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã)
   ```

4. **NULL –∑–Ω–∞—á–µ–Ω–∏—è —Å–ª–æ–∂–Ω–µ–µ**:
   ```sql
   SELECT * FROM users WHERE email IS NULL;
   -- Hash –∏–Ω–¥–µ–∫—Å ‚Üí hash(NULL) ‚Üí –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–æ–±–ª–µ–º–æ–π
   -- B+Tree ‚Üí NULL –∏–º–µ–µ—Ç –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–µ –º–µ—Å—Ç–æ –≤ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–µ
   ```

---

**–¢–∞–±–ª–∏—Ü–∞: Hash vs B+Tree**

| –û–ø–µ—Ä–∞—Ü–∏—è | Hash | B+Tree |
|----------|------|--------|
| **–¢–æ—á–Ω–æ–µ —Ä–∞–≤–µ–Ω—Å—Ç–≤–æ** `WHERE x = 5` | ‚ö° O(1) | ‚ö°‚ö° O(log N) |
| **–î–∏–∞–ø–∞–∑–æ–Ω** `WHERE x > 5 AND x < 10` | ‚ùå | ‚úÖ |
| **Prefix** `WHERE name LIKE 'A%'` | ‚ùå | ‚úÖ |
| **ORDER BY** | ‚ùå | ‚úÖ |
| **IN (a, b, c)** | ‚ö° (3 lookups) | ‚ö°‚ö° (1 scan) |
| **MIN/MAX** | ‚ùå | ‚úÖ |
| **Î≥µÌï© –∏–Ω–¥–µ–∫—Å (a, b)** | –°–ª–æ–∂–Ω–æ | ‚úÖ |

---

**Durability/—Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è –ø—Ä–æ–±–ª–µ–º—ã (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –°–£–ë–î):**

**PostgreSQL**: Hash –∏–Ω–¥–µ–∫—Å—ã —Ä–∞–Ω—å—à–µ –±—ã–ª–∏ –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω—ã –¥–ª—è WAL/—Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏
- –¢—Ä–µ–±–æ–≤–∞–ª–∏ full index rebuild –ø–æ—Å–ª–µ –∫—Ä–∞—à–∞
- –í –±–æ–ª–µ–µ –Ω–æ–≤—ã—Ö –≤–µ—Ä—Å–∏—è—Ö –∏—Å–ø—Ä–∞–≤–∏–ª–∏, –Ω–æ B+Tree –æ—Å—Ç–∞—ë—Ç—Å—è —Å—Ç–∞–±–∏–ª—å–Ω–µ–µ

**MySQL**: Hash –∏–Ω–¥–µ–∫—Å—ã (–ø–∞–º—è—Ç—å) vs B+Tree (–¥–∏—Å–∫)
- MEMORY storage engine –∏–º–µ–µ—Ç Hash –∏–Ω–¥–µ–∫—Å—ã
- InnoDB –∏—Å–ø–æ–ª—å–∑—É–µ—Ç B+Tree (–±–æ–ª–µ–µ –Ω–∞–¥—ë–∂–Ω–æ)

---

**–ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Hash –∏–Ω–¥–µ–∫—Å:**

- **–ö–æ–≥–¥–∞ –µ—Å—Ç—å —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å**: —Ç–æ–ª—å–∫–æ —Ç–æ—á–Ω—ã–µ –ø–æ–∏—Å–∫–∏ –ø–æ –æ–¥–Ω–æ–º—É –ø–æ–ª—é
- **–ö–æ–≥–¥–∞ –Ω—É–∂–Ω–∞ max —Å–∫–æ—Ä–æ—Å—Ç—å**: 1-2% —ç–∫–æ–Ω–æ–º–∏—è –≤ –æ–ø–µ—Ä–∞—Ü–∏—è—Ö –º–æ–∂–µ—Ç –±—ã—Ç—å –∫—Ä–∏—Ç–∏—á–Ω–∞
- **–ö–æ–≥–¥–∞ –Ω–µ—Ç ORDER BY, –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤**: –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ rare

**–ü—Ä–∞–∫—Ç–∏–∫–∞**: –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∏—Å–ø–æ–ª—å–∑—É—é—Ç B+Tree –≤–µ–∑–¥–µ –∏ –∑–∞–±—ã–≤–∞—é—Ç –æ Hash –∏–Ω–¥–µ–∫—Å–∞—Ö.

---

#### –í–æ–ø—Ä–æ—Å: Bitmap-–∏–Ω–¥–µ–∫—Å—ã ‚Äî –∫–æ–≥–¥–∞ —ç—Ç–æ "–∏–¥–µ–∞–ª—å–Ω–æ"?

**–û—Ç–≤–µ—Ç:**
OLAP, –Ω–∏–∑–∫–∞—è –∫–∞—Ä–¥–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å (—Å—Ç–∞—Ç—É—Å, —Ñ–ª–∞–≥–∏), –º–Ω–æ–≥–æ AND/OR —Ñ–∏–ª—å—Ç—Ä–æ–≤. –í OLTP –ø–ª–æ—Ö–æ –ø—Ä–∏ —á–∞—Å—Ç—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è—Ö –∏–∑-–∑–∞ –¥–æ—Ä–æ–≥–∏—Ö –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–π –±–∏—Ç–º–∞–ø–æ–≤.

**–¢–µ–æ—Ä–∏—è –∏ –ø–æ–Ω–∏–º–∞–Ω–∏–µ:**

**Bitmap –∏–Ω–¥–µ–∫—Å** ‚Äî —Ö—Ä–∞–Ω–∏—Ç –±–∏—Ç—ã (0 –∏–ª–∏ 1) –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –≤ –∫–æ–ª–æ–Ω–∫–µ.

**–ü—Ä–∏–º–µ—Ä: –∫–æ–ª–æ–Ω–∫–∞ status —Å 3 –∑–Ω–∞—á–µ–Ω–∏—è–º–∏**

```
–¢–∞–±–ª–∏—Ü–∞ orders (1 –º–ª–Ω —Å—Ç—Ä–æ–∫):

id  | status
----|----------
1   | pending
2   | shipped
3   | pending
4   | delivered
5   | pending
...

Bitmap –∏–Ω–¥–µ–∫—Å:
status = 'pending':    1 0 1 0 1 ... (1 –º–ª–Ω –±–∏—Ç)
status = 'shipped':    0 1 0 0 0 ...
status = 'delivered':  0 0 0 1 0 ...
```

**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

```
–ó–∞–ø—Ä–æ—Å: SELECT COUNT(*) FROM orders WHERE status IN ('pending', 'delivered');

1. –ë–µ—Ä—ë–º bitmap –¥–ª—è 'pending':   1 0 1 0 1 ...
2. –ë–µ—Ä—ë–º bitmap –¥–ª—è 'delivered': 0 0 0 1 0 ...
3. –î–µ–ª–∞–µ–º OR (–ø–æ–±–∏—Ç–æ–≤–æ–µ):        1 0 1 1 1 ...
4. –°—á–∏—Ç–∞–µ–º –µ–¥–∏–Ω–∏—Ü—ã:             = 4
5. –û—Ç–≤–µ—Ç: COUNT = 4

–í—Å—ë –±—ã—Å—Ç—Ä–æ! –ë–∏—Ç–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ ‚Äî —Å–∞–º—ã–µ –±—ã—Å—Ç—Ä—ã–µ –≤ CPU.
```

---

**–ö–æ–≥–¥–∞ –∏–¥–µ–∞–ª—å–Ω–æ (OLAP):**

1. **–ù–∏–∑–∫–∞—è –∫–∞—Ä–¥–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å** (few unique values):
   ```sql
   -- –ò–¥–µ–∞–ª—å–Ω–æ:
   status: 'pending', 'shipped', 'delivered' (3 –∑–Ω–∞—á–µ–Ω–∏—è)
   priority: 'low', 'medium', 'high' (3 –∑–Ω–∞—á–µ–Ω–∏—è)
   is_active: true, false (2 –∑–Ω–∞—á–µ–Ω–∏—è)
   
   -- –ü–ª–æ—Ö–æ:
   user_id: 1, 2, 3, ..., 1 –º–ª–Ω (1M –∑–Ω–∞—á–µ–Ω–∏–π)
   email: alice@..., bob@..., ... (unique, 1M –∑–Ω–∞—á–µ–Ω–∏–π)
   ```

2. **–ú–Ω–æ–≥–æ AND/OR —Ñ–∏–ª—å—Ç—Ä–æ–≤**:
   ```sql
   SELECT * FROM orders 
   WHERE status = 'pending' 
     AND priority = 'high'
     AND is_active = true
     AND region IN ('US', 'EU', 'Asia');
   
   -- Bitmap –æ–ø–µ—Ä–∞—Ü–∏–∏:
   bitmap_status & bitmap_priority & bitmap_is_active & (...OR –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è region)
   ```

3. **–ë–æ–ª—å—à–∏–µ —Ç–∞–±–ª–∏—Ü—ã, few –∫–æ–ª–æ–Ω–æ–∫ –≤ SELECT**:
   ```
   100 –º–ª–Ω —Å—Ç—Ä–æ–∫ √ó 2 –º–ª–Ω –±–∏—Ç –¥–ª—è –æ–¥–Ω–æ–π –∫–æ–ª–æ–Ω–∫–∏ = 250 MB (—Å –∫–æ–º–ø—Ä–µ—Å—Å–∏–µ–π)
   B+Tree –∏–Ω–¥–µ–∫—Å = 10 GB
   –≠–∫–æ–Ω–æ–º–∏—è: –≤ 40 —Ä–∞–∑!
   ```

4. **–ê–≥—Ä–µ–≥–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤**:
   ```sql
   SELECT status, COUNT(*) FROM orders GROUP BY status;
   
   -- Bitmap –∏–Ω–¥–µ–∫—Å ‚Üí –±—ã—Å—Ç—Ä–æ, –ø–æ—Ç–æ–º—É —á—Ç–æ –ø–æ–¥—Å—á—ë—Ç –±–∏—Ç = –±—ã—Å—Ç—Ä–æ
   ```

---

**–ö–æ–≥–¥–∞ –ø–ª–æ—Ö–æ (OLTP):**

1. **–ß–∞—Å—Ç—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**:
   ```sql
   -- OLTP: 1000 updates/sec
   UPDATE orders SET status = 'shipped' WHERE id = 123;
   
   -- Bitmap –∏–Ω–¥–µ–∫—Å ‚Üí –Ω—É–∂–Ω–æ –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –í–°–ï –±–∏—Ç—ã!
   -- –ë—ã–ª: 0 0 1 0 0 (status[2] = 'pending')
   -- –°—Ç–∞–ª: 0 0 0 0 0 (—É–¥–∞–ª–∏–ª–∏ –∏–∑ pending)
   -- –ò –æ–±–Ω–æ–≤–∏—Ç—å 'shipped': 1 0 0 0 0 ‚Üí 1 0 0 0 1
   
   -- B+Tree –∏–Ω–¥–µ–∫—Å ‚Üí –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å —É–∫–∞–∑–∞—Ç–µ–ª—å (–¥–µ—à–µ–≤–ª–µ)
   ```

2. **–ú–Ω–æ–≥–æ –≤—Å—Ç–∞–≤–æ–∫/—É–¥–∞–ª–µ–Ω–∏–π**:
   ```sql
   INSERT INTO orders ... -- –∫–∞–∂–¥—ã–π INSERT –º–µ–Ω—è–µ—Ç –±–∏—Ç—ã –≤—Å–µ—Ö –∏–Ω–¥–µ–∫—Å–æ–≤
   ```

3. **–í—ã—Å–æ–∫–∞—è –∫–∞—Ä–¥–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å**:
   ```sql
   –ï—Å–ª–∏ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π = 1M, —Ç–æ 1M –±–∏—Ç-–º–∞—Å—Å–∏–≤–æ–≤
   –ö–∞–∂–¥—ã–π = 125 KB
   –í—Å–µ–≥–æ: 125 GB bitmap –∏–Ω–¥–µ–∫—Å–æ–≤ (–≤–º–µ—Å—Ç–æ 10 GB B+Tree)
   ```

---

**–¢–∞–±–ª–∏—Ü–∞: Bitmap vs B+Tree**

| –°—Ü–µ–Ω–∞—Ä–∏–π | Bitmap | B+Tree |
|----------|--------|--------|
| **–ù–∏–∑–∫–∞—è –∫–∞—Ä–¥–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å** | ‚ö°‚ö°‚ö° | ‚ö° |
| **–í—ã—Å–æ–∫–∞—è –∫–∞—Ä–¥–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å** | üê¢ | ‚ö° |
| **AND/OR —Ñ–∏–ª—å—Ç—Ä—ã** | ‚ö°‚ö°‚ö° (–ø–æ–±–∏—Ç–æ–≤—ã–µ) | ‚ö°‚ö° (intersect) |
| **–ß–∞—Å—Ç—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** | üê¢ | ‚ö°‚ö° |
| **–î–∏–∞–ø–∞–∑–æ–Ω—ã (>/<)** | ‚ùå | ‚úÖ |
| **–ú–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ** | üíæ (low card: –º–∞–ª–æ) | üíæ (norm) |

---

**–†–µ–∞–ª—å–Ω—ã–π –ø—Ä–∏–º–µ—Ä (E-commerce OLAP):**

```sql
-- –¢–∞–±–ª–∏—Ü–∞ —Ñ–∞–∫—Ç–æ–≤: 100 –º–ª–Ω –∑–∞–∫–∞–∑–æ–≤
CREATE TABLE order_facts (
    order_id BIGINT,
    product_id INT,
    status VARCHAR(20),        -- low card: 5 –∑–Ω–∞—á–µ–Ω–∏–π
    priority VARCHAR(10),      -- low card: 3 –∑–Ω–∞—á–µ–Ω–∏—è
    region VARCHAR(20),        -- low card: 10 –∑–Ω–∞—á–µ–Ω–∏–π
    is_premium BOOLEAN,        -- low card: 2 –∑–Ω–∞—á–µ–Ω–∏—è
    user_age_group VARCHAR(10) -- low card: 10 –∑–Ω–∞—á–µ–Ω–∏–π
);

-- –ò–Ω–¥–µ–∫—Å—ã:
CREATE BITMAP INDEX idx_status ON order_facts(status);
CREATE BITMAP INDEX idx_priority ON order_facts(priority);
CREATE BITMAP INDEX idx_region ON order_facts(region);
CREATE BITMAP INDEX idx_premium ON order_facts(is_premium);

-- –ó–∞–ø—Ä–æ—Å:
SELECT status, COUNT(*) 
FROM order_facts 
WHERE region IN ('US', 'EU', 'Asia')
  AND is_premium = true
  AND priority = 'high'
GROUP BY status;

-- Bitmap –∏–Ω–¥–µ–∫—Å—ã —É—Å–∫–æ—Ä—è—é—Ç:
-- bitmap_region & bitmap_premium & bitmap_priority ‚Üí 1 —Å–µ–∫—É–Ω–¥–∞
-- –ë–µ–∑ –Ω–∏—Ö ‚Üí 10+ —Å–µ–∫—É–Ω–¥ (full scan –Ω–∞ 100M —Å—Ç—Ä–æ–∫)
```

---

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –ø–ª–∞–Ω—ã

#### –í–æ–ø—Ä–æ—Å: Cost-based optimizer ‚Äî –∫–∞–∫–∏–µ –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –µ–º—É –∫—Ä–∏—Ç–∏—á–Ω—ã?

**–û—Ç–≤–µ—Ç:**
–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏: —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è, –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã, –∫–∞—Ä–¥–∏–Ω–∞–ª—å–Ω–æ—Å—Ç–∏, –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏. –ë–µ–∑ –∞–∫—Ç—É–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä –≤—ã–±–∏—Ä–∞–µ—Ç –ø–ª–æ—Ö–∏–µ –ø–ª–∞–Ω—ã.

**–¢–µ–æ—Ä–∏—è –∏ –ø–æ–Ω–∏–º–∞–Ω–∏–µ:**

**Cost-based optimizer (CBO)** ‚Äî —ç—Ç–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –°–£–ë–î, –∫–æ—Ç–æ—Ä—ã–π **–≤—ã–±–∏—Ä–∞–µ—Ç –ª—É—á—à–∏–π –ø–ª–∞–Ω –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–∞**, –æ—Å–Ω–æ–≤—ã–≤–∞—è—Å—å –Ω–∞ **—Å—Ç–æ–∏–º–æ—Å—Ç–∏** (cost).

```
–ó–∞–ø—Ä–æ—Å: SELECT * FROM users WHERE age > 30 AND city = 'Moscow'

–í–æ–∑–º–æ–∂–Ω—ã–µ –ø–ª–∞–Ω—ã:
–ü–ª–∞–Ω 1: Sequential scan —Ç–∞–±–ª–∏—Ü—ã ‚Üí filter age > 30 ‚Üí filter city = 'Moscow'
–ü–ª–∞–Ω 2: Index scan –Ω–∞ (age) ‚Üí filter city = 'Moscow'
–ü–ª–∞–Ω 3: Index scan –Ω–∞ (city) ‚Üí filter age > 30
–ü–ª–∞–Ω 4: Index scan –Ω–∞ (city, age) ‚Üí –≥–æ—Ç–æ–≤–æ

CBO —Å—á–∏—Ç–∞–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç—å –∫–∞–∂–¥–æ–≥–æ –ø–ª–∞–Ω–∞ –∏ –≤—ã–±–∏—Ä–∞–µ—Ç –º–∏–Ω–∏–º–∞–ª—å–Ω—É—é.
```

**–ö–∞–∫–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –Ω—É–∂–Ω—ã:**

1. **–ö–∞—Ä–¥–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å (cardinality)**: —Å–∫–æ–ª—å–∫–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π

```sql
-- –ü—Ä–∏–º–µ—Ä:
–¢–∞–±–ª–∏—Ü–∞ users: 1 –º–ª–Ω —Å—Ç—Ä–æ–∫

–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:
- age: 100 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π (1-100)
- city: 50 —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π (Moscow, SPB, ...)

–ó–∞–ø—Ä–æ—Å: WHERE age > 30 AND city = 'Moscow'
- age > 30 ‚Üí ~70% —Å—Ç—Ä–æ–∫ = 700 000 —Å—Ç—Ä–æ–∫ (—Ñ–∏–ª—å—Ç—Ä —Å–ª–∞–±—ã–π)
- city = 'Moscow' ‚Üí ~2% —Å—Ç—Ä–æ–∫ = 20 000 —Å—Ç—Ä–æ–∫ (—Ñ–∏–ª—å—Ç—Ä —Å–∏–ª—å–Ω—ã–π)

–ü–æ—Ä—è–¥–æ–∫ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –≤–∞–∂–µ–Ω:
- –°–Ω–∞—á–∞–ª–∞ city (20K) ‚Üí –ø–æ—Ç–æ–º age > 30 –∏–∑ 20K (–±—ã—Å—Ç—Ä–æ)
- –°–Ω–∞—á–∞–ª–∞ age > 30 (700K) ‚Üí –ø–æ—Ç–æ–º city –∏–∑ 700K (–º–µ–¥–ª–µ–Ω–Ω–µ–µ)

CBO –≤–∏–¥–∏—Ç —ç—Ç–æ –∏–∑ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏ –≤—ã–±–∏—Ä–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫.
```

2. **–ì–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã (histograms)**: —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π

```sql
–ö–æ–ª–æ–Ω–∫–∞ age (—Ä–µ–∞–ª—å–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ):
- [1-10]:    50 000 —Å—Ç—Ä–æ–∫
- [11-20]:   100 000 —Å—Ç—Ä–æ–∫
- [21-30]:   200 000 —Å—Ç—Ä–æ–∫
- [31-40]:   250 000 —Å—Ç—Ä–æ–∫
- [41-50]:   200 000 —Å—Ç—Ä–æ–∫
- [51-100]:  200 000 —Å—Ç—Ä–æ–∫

–ó–∞–ø—Ä–æ—Å: WHERE age > 30
–ì–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞ –≥–æ–≤–æ—Ä–∏—Ç: [31-40]: 250K, [41-50]: 200K, [51-100]: 200K
–ò—Ç–æ–≥–æ: 650K —Å—Ç—Ä–æ–∫ = 65% (—Ñ–∏–ª—å—Ç—Ä —Å–ª–∞–±—ã–π)

–ë–µ–∑ –≥–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã CBO –º–æ–∂–µ—Ç –ø–æ–¥—É–º–∞—Ç—å: 50% —Å—Ç—Ä–æ–∫ (–Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ)
```

3. **–ö–æ—Ä—Ä–µ–ª—è—Ü–∏–∏ –º–µ–∂–¥—É –∫–æ–ª–æ–Ω–∫–∞–º–∏**: –∑–∞–≤–∏—Å—è—Ç –ª–∏ –∫–æ–ª–æ–Ω–∫–∏ –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞

```sql
–¢–∞–±–ª–∏—Ü–∞ orders:
- user_country: ('Russia', 'USA', 'EU')
- user_city: ('Moscow', 'SPB', ..., 'NYC', 'LA', ..., 'Paris', ...)

–ö–æ—Ä—Ä–µ–ª—è—Ü–∏—è:
- –ï—Å–ª–∏ country = 'Russia' ‚Üí city –≤ –æ—Å–Ω–æ–≤–Ω–æ–º ('Moscow', 'SPB')
- –ï—Å–ª–∏ country = 'USA' ‚Üí city –≤ –æ—Å–Ω–æ–≤–Ω–æ–º ('NYC', 'LA')

–ó–∞–ø—Ä–æ—Å: WHERE country = 'Russia' AND city = 'Moscow'
- –ë–µ–∑ –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–∏: 1M * (3 –≥–æ—Ä–æ–¥–∞) * (10 –≥–æ—Ä–æ–¥–æ–≤) = ~100K —Å—Ç—Ä–æ–∫
- –° –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–µ–π: 1M * 0.3 (Russia) * 0.5 (Moscow –∏–∑ Russia) = ~150K —Å—Ç—Ä–æ–∫

CBO —Å –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–µ–π ‚Üí –ª—É—á—à–µ –≤—ã–±–∏—Ä–∞–µ—Ç –∏–Ω–¥–µ–∫—Å—ã –∏ –ø–æ—Ä—è–¥–æ–∫.
```

4. **–†–∞–∑–º–µ—Ä —Ç–∞–±–ª–∏—Ü—ã**: —Å–∫–æ–ª—å–∫–æ —Ñ–∏–∑–∏—á–µ—Å–∫–∏—Ö –±–ª–æ–∫–æ–≤ –Ω–∞ –¥–∏—Å–∫–µ

```sql
–¢–∞–±–ª–∏—Ü–∞ users: 1 –º–ª–Ω —Å—Ç—Ä–æ–∫
- –†–∞–∑–º–µ—Ä –≤ –ø–∞–º—è—Ç–∏: ~1 GB
- –ù–∞ –¥–∏—Å–∫–µ: ~10 GB (—Å –∏–Ω–¥–µ–∫—Å–∞–º–∏)

Sequential scan: 1 –º–∏–Ω (–Ω—É–∂–Ω–æ –ø—Ä–æ—á–∏—Ç–∞—Ç—å 10 GB)
Index scan: 1 —Å–µ–∫ (–∏–Ω–¥–µ–∫—Å = 100 MB, –ø–æ—Ç–æ–º random access –≤ —Ç–∞–±–ª–∏—Ü–µ)

CBO —ç—Ç–æ –∑–Ω–∞–µ—Ç –∏ –≤—ã–±–∏—Ä–∞–µ—Ç –ø–ª–∞–Ω.
```

---

**–ü—Ä–æ–±–ª–µ–º—ã –±–µ–∑ –∞–∫—Ç—É–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:**

```sql
-- –î–∞–≤–∞–π—Ç–µ —Å–æ–∑–¥–∞–ª–∏ —Ç–∞–±–ª–∏—Ü—É:
CREATE TABLE orders (user_id, amount);
INSERT INTO orders SELECT ... (–¥–æ–±–∞–≤–∏–ª–∏ 1M —Å—Ç—Ä–æ–∫);
CREATE INDEX idx_user ON orders(user_id);

-- –ë–ï–ó ANALYZE:
ANALYZE orders; -- ‚Üê –ó–ê–ë–´–õ–ò –í–´–ü–û–õ–ù–ò–¢–¨!

-- –¢–µ–ø–µ—Ä—å:
SELECT * FROM orders WHERE user_id = 123;

-- CBO –¥—É–º–∞–µ—Ç:
-- "–ù–µ –∑–Ω–∞—é, —Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫, –±—É–¥—É —Å—á–∏—Ç–∞—Ç—å 50/50"
-- –ú–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å: Sequential scan (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ!)
-- –ò–ª–∏: Index scan (–ø—Ä–∞–≤–∏–ª—å–Ω–æ, –Ω–æ —Å–ª—É—á–∞–π–Ω–æ!)

-- –ï—Å–ª–∏ –æ–Ω–∏:
ANALYZE orders;
-- CBO –∑–Ω–∞–µ—Ç: user_id = 123 ‚Üí 1 —Å—Ç—Ä–æ–∫–∞ (–∏–ª–∏ 100 —Å—Ç—Ä–æ–∫?)
-- –í—ã–±–∏—Ä–∞–µ—Ç: Index scan (–≤–µ—Ä–Ω–æ!)
```

---

**–ö–∞–∫ –°–£–ë–î —Å–æ–±–∏—Ä–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É:**

```sql
-- PostgreSQL:
ANALYZE orders;  -- —Å–æ–±–∏—Ä–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
ANALYZE orders (user_id, amount);  -- –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –∫–æ–ª–æ–Ω–∫–∞–º

-- MySQL:
ANALYZE TABLE orders;

-- Oracle:
BEGIN
  DBMS_STATS.GATHER_TABLE_STATS('schema_name', 'orders');
END;

-- –í—Å—ë —ç—Ç–æ –¥–æ–ª–∂–Ω–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è:
-- - –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–∞–±–ª–∏—Ü—ã
-- - –ü–æ—Å–ª–µ –±–æ–ª—å—à–∏—Ö INSERT/UPDATE/DELETE (–±–∞—Ç—á–µ–π)
-- - –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ (—Ä–∞–∑ –≤ –¥–µ–Ω—å –¥–ª—è prod)
```

---

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:**

```
–ë–µ–∑ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:
SELECT * FROM orders WHERE user_id = 123 AND amount > 1000;
CBO ‚Üí "–ù–µ –∑–Ω–∞—é" ‚Üí –≤—ã–±–∏—Ä–∞–µ—Ç random –ø–ª–∞–Ω ‚Üí –º–æ–∂–µ—Ç –±—ã—Ç—å 10x –º–µ–¥–ª–µ–Ω–Ω–µ–µ

–° –∞–∫—Ç—É–∞–ª—å–Ω–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π:
CBO ‚Üí "user_id = 123: 100 —Å—Ç—Ä–æ–∫, –∏–∑ –Ω–∏—Ö amount > 1000: 50 —Å—Ç—Ä–æ–∫"
‚Üí –≤—ã–±–∏—Ä–∞–µ—Ç optimal –ø–ª–∞–Ω ‚Üí –±—ã—Å—Ç—Ä–æ
```

---

#### –í–æ–ø—Ä–æ—Å: –ü–æ—á–µ–º—É `WHERE f(col)=...` —á–∞—Å—Ç–æ –ª–æ–º–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞?

**–û—Ç–≤–µ—Ç:**
–§—É–Ω–∫—Ü–∏—è –º–µ–Ω—è–µ—Ç –≤—ã—Ä–∞–∂–µ–Ω–∏–µ: –∏–Ω–¥–µ–∫—Å –ø–æ col –Ω–µ –ø—Ä–∏–º–µ–Ω–∏–º –Ω–∞–ø—Ä—è–º—É—é. –†–µ—à–µ–Ω–∏—è: –≤—ã—á–∏—Å–ª—è–µ–º—ã–π/functional index –∏–ª–∏ –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å —É—Å–ª–æ–≤–∏–µ.

**–¢–µ–æ—Ä–∏—è –∏ –ø–æ–Ω–∏–º–∞–Ω–∏–µ:**

**–ü—Ä–æ–±–ª–µ–º–∞:**

```sql
-- –ò–Ω–¥–µ–∫—Å:
CREATE INDEX idx_email ON users(email);

-- –ó–∞–ø—Ä–æ—Å:
SELECT * FROM users WHERE LOWER(email) = 'ivan@example.com';

-- –ü—Ä–æ–±–ª–µ–º–∞:
-- –ò–Ω–¥–µ–∫—Å –Ω–∞ email: ('Ivan@example.com', 'Bob@Example.com', ...)
-- –ó–∞–ø—Ä–æ—Å –∏—â–µ—Ç: LOWER(email) = 'ivan@example.com'
-- 
-- –ï—Å—Ç—å –ª–∏ –≤ –∏–Ω–¥–µ–∫—Å–µ LOWER(email)?
-- –ù–µ—Ç! –ò–Ω–¥–µ–∫—Å —Ö—Ä–∞–Ω–∏—Ç –∑–Ω–∞—á–µ–Ω–∏—è –ë–ï–ó —Ñ—É–Ω–∫—Ü–∏–∏!
-- 
-- –†–µ–∑—É–ª—å—Ç–∞—Ç: Sequential scan –ø–æ –≤—Å–µ–º 1M —Å—Ç—Ä–æ–∫, –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ LOWER –∫ –∫–∞–∂–¥–æ–π
```

**–ü–æ—á–µ–º—É —ç—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:**

–ò–Ω–¥–µ–∫—Å –ø–æ—Å—Ç—Ä–æ–µ–Ω –Ω–∞ **—Ä–µ–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏—è—Ö** –∫–æ–ª–æ–Ω–∫–∏:
```
B+Tree –∏–Ω–¥–µ–∫—Å –Ω–∞ email:
[Alice@example.com] ‚Üí row1
[Bob@Example.com] ‚Üí row2
[Ivan@EXAMPLE.COM] ‚Üí row3
[Ivan@example.com] ‚Üí row4
```

–ö–æ–≥–¥–∞ –ø—Ä–∏–º–µ–Ω—è–µ—à—å —Ñ—É–Ω–∫—Ü–∏—é `LOWER(email)`, **–∏–Ω–¥–µ–∫—Å —É–∂–µ –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç**, –ø–æ—Ç–æ–º—É —á—Ç–æ:
1. –ò–Ω–¥–µ–∫—Å –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –ø–æ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏—è–º (—Å –±–æ–ª—å—à–∏–º–∏ –±—É–∫–≤–∞–º–∏)
2. LOWER() **–∏–∑–º–µ–Ω—è–µ—Ç –ø–æ—Ä—è–¥–æ–∫ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏**
3. –°–£–ë–î –Ω–µ –º–æ–∂–µ—Ç –±—ã—Å—Ç—Ä–æ –Ω–∞–π—Ç–∏ LOWER(email) = 'ivan...' –≤ –¥–µ—Ä–µ–≤–µ

---

**–†–µ—à–µ–Ω–∏–µ 1: Functional (Computed) Index**

```sql
-- –°–æ–∑–¥–∞—ë–º –∏–Ω–¥–µ–∫—Å –Ω–∞ –†–ï–ó–£–õ–¨–¢–ê–¢ —Ñ—É–Ω–∫—Ü–∏–∏:
CREATE INDEX idx_email_lower ON users(LOWER(email));

-- –¢–µ–ø–µ—Ä—å –∑–∞–ø—Ä–æ—Å:
SELECT * FROM users WHERE LOWER(email) = 'ivan@example.com';

-- –†–∞–±–æ—Ç–∞–µ—Ç –±—ã—Å—Ç—Ä–æ!
-- –ò–Ω–¥–µ–∫—Å —Ö—Ä–∞–Ω–∏—Ç —É–∂–µ LOWER-–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
-- [alice@example.com] ‚Üí row1
-- [bob@example.com] ‚Üí row2
-- [ivan@example.com] ‚Üí row3 AND row4
```

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç functional index:**

```sql
-- PostgreSQL:
CREATE INDEX idx_user_lower ON users(LOWER(username));

-- MySQL:
CREATE INDEX idx_user_lower ON users((LOWER(username)));

-- Oracle:
CREATE INDEX idx_user_lower ON users(LOWER(username));
```

–¢–µ–ø–µ—Ä—å –°–£–ë–î:
1. –í—ã—á–∏—Å–ª—è–µ—Ç LOWER(username) –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–∏
2. –•—Ä–∞–Ω–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –∏–Ω–¥–µ–∫—Å–µ
3. –ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ `WHERE LOWER(username) = 'ivan'` ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∏–Ω–¥–µ–∫—Å

---

**–†–µ—à–µ–Ω–∏–µ 2: –ü–µ—Ä–µ–ø–∏—Å–∞—Ç—å —É—Å–ª–æ–≤–∏–µ (–µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ)**

–ù–µ –≤—Å–µ–≥–¥–∞ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å functional index (–º–µ–¥–ª–µ–Ω–Ω–æ, –±–æ–ª—å—à–æ–π —Ä–∞–∑–º–µ—Ä). –ò–Ω–æ–≥–¥–∞ –ø—Ä–æ—â–µ –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å:

```sql
-- –ü–ª–æ—Ö–æ (–ª–æ–º–∞–µ—Ç –∏–Ω–¥–µ–∫—Å):
SELECT * FROM users WHERE LOWER(email) = 'ivan@example.com';

-- –•–æ—Ä–æ—à–æ (–µ—Å–ª–∏ –∑–Ω–∞–µ—à—å —Ç–æ—á–Ω—ã–µ boundaries):
SELECT * FROM users 
WHERE email >= 'ivan@example.com' 
  AND email < 'ivan@example.com' + char(255)
  AND LOWER(email) = 'ivan@example.com';
```

–ù–æ —ç—Ç–æ —Å–ª–æ–∂–Ω–æ –∏ –Ω–µ—è–≤–Ω–æ. –õ—É—á—à–µ functional index.

---

**–î—Ä—É–≥–∏–µ –ø—Ä–∏–º–µ—Ä—ã, –≥–¥–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ª–æ–º–∞—é—Ç –∏–Ω–¥–µ–∫—Å—ã:**

```sql
-- 1. SUBSTRING –ª–æ–º–∞–µ—Ç –∏–Ω–¥–µ–∫—Å:
CREATE INDEX idx_phone ON users(phone);

SELECT * FROM users WHERE SUBSTRING(phone, 1, 3) = '812';
-- ‚ùå –ò–Ω–¥–µ–∫—Å –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç

-- –†–µ—à–µ–Ω–∏–µ:
CREATE INDEX idx_phone_prefix ON users(SUBSTRING(phone, 1, 3));

---

-- 2. –ê—Ä–∏—Ñ–º–µ—Ç–∏–∫–∞ –ª–æ–º–∞–µ—Ç –∏–Ω–¥–µ–∫—Å:
CREATE INDEX idx_age ON users(age);

SELECT * FROM users WHERE age + 5 > 30;
-- ‚ùå –ò–Ω–¥–µ–∫—Å –Ω–∞ age –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç (–Ω—É–∂–Ω–æ age > 25, –Ω–æ —ç—Ç–æ —Ä—É—á–Ω–∞—è —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ—Å—Ç—å)

-- –†–µ—à–µ–Ω–∏–µ: –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å –≤—Ä—É—á–Ω—É—é
SELECT * FROM users WHERE age > 25;  -- —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ age + 5 > 30
-- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∏–Ω–¥–µ–∫—Å

---

-- 3. DATE —Ñ—É–Ω–∫—Ü–∏–∏ –ª–æ–º–∞—é—Ç –∏–Ω–¥–µ–∫—Å:
CREATE INDEX idx_created_at ON users(created_at);

SELECT * FROM users WHERE YEAR(created_at) = 2025;
-- ‚ùå –ò–Ω–¥–µ–∫—Å –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç

-- –†–µ—à–µ–Ω–∏–µ:
CREATE INDEX idx_created_year ON users(YEAR(created_at));
-- –ò–ª–∏ –ø–µ—Ä–µ–ø–∏—Å–∞—Ç—å:
SELECT * FROM users 
WHERE created_at >= '2025-01-01' AND created_at < '2026-01-01';
-- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∏–Ω–¥–µ–∫—Å –Ω–∞ created_at
```

---

**–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**

```
–¢–∞–±–ª–∏—Ü–∞ users: 1M —Å—Ç—Ä–æ–∫

–ë–µ–∑ functional index:
SELECT * FROM users WHERE LOWER(email) = 'ivan@example.com';
Time: 5 seconds (sequential scan, –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ LOWER –∫ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–µ)

–° functional index:
SELECT * FROM users WHERE LOWER(email) = 'ivan@example.com';
Time: 1 ms (–∏–Ω–¥–µ–∫—Å –Ω–∞ LOWER(email))

–£–ª—É—á—à–µ–Ω–∏–µ: 5000x!
```

---

**–ú–∏–Ω—É—Å—ã functional index:**

1. **–ú–µ—Å—Ç–æ –Ω–∞ –¥–∏—Å–∫–µ**: –µ—â–µ –æ–¥–∏–Ω –∏–Ω–¥–µ–∫—Å = –±–æ–ª—å—à–µ –ø–∞–º—è—Ç–∏
2. **–ú–µ–¥–ª–µ–Ω–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**: INSERT/UPDATE = –æ–±–Ω–æ–≤–∏—Ç—å –æ–±–∞ –∏–Ω–¥–µ–∫—Å–∞
3. **–ù—É–∂–Ω–æ –≤—ã–±–∏—Ä–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ**: –Ω–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å functional index –¥–ª—è –∫–∞–∂–¥–æ–π —Ñ—É–Ω–∫—Ü–∏–∏

**–ü—Ä–∞–≤–∏–ª–æ: —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ functional index –µ—Å–ª–∏:**
- –§—É–Ω–∫—Ü–∏—è —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ WHERE
- –¢–∞–±–ª–∏—Ü–∞ –±–æ–ª—å—à–∞—è (> 100K —Å—Ç—Ä–æ–∫)
- –§—É–Ω–∫—Ü–∏—è –¥–æ—Ä–æ–≥–∞ (LOWER, SUBSTRING –∏ —Ç.–¥.)

---

#### –í–æ–ø—Ä–æ—Å: Join –∞–ª–≥–æ—Ä–∏—Ç–º—ã: nested loop vs hash join vs merge join ‚Äî –∫–æ–≥–¥–∞ —á—Ç–æ?

**–û—Ç–≤–µ—Ç:**
Nested loop ‚Äî –º–∞–ª–µ–Ω—å–∫–∏–π –≤–Ω–µ—à–Ω–∏–π –Ω–∞–±–æ—Ä + –∏–Ω–¥–µ–∫—Å –Ω–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–º. Hash join ‚Äî –±–æ–ª—å—à–∏–µ –Ω–∞–±–æ—Ä—ã –±–µ–∑ —É–ø–æ—Ä—è–¥–æ—á–µ–Ω–Ω–æ—Å—Ç–∏ (–Ω—É–∂–Ω–∞ –ø–∞–º—è—Ç—å). Merge join ‚Äî –æ–±–∞ –≤—Ö–æ–¥–∞ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã/–ø–æ –∏–Ω–¥–µ–∫—Å–∞–º, —Ö–æ—Ä–æ—à –¥–ª—è range.

**–¢–µ–æ—Ä–∏—è –∏ –ø–æ–Ω–∏–º–∞–Ω–∏–µ:**

–¢—Ä–∏ –≥–ª–∞–≤–Ω—ã—Ö –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –¥–ª—è JOIN:

---

**1. Nested Loop Join (–≤–ª–æ–∂–µ–Ω–Ω—ã–µ —Ü–∏–∫–ª—ã)**

```
FOR EACH row in table A:
    FOR EACH row in table B:
        IF A.key = B.key: output
```

**–ü—Ä–∏–º–µ—Ä:**

```sql
SELECT * FROM orders o 
JOIN customers c ON o.customer_id = c.id
```

–ü—Å–µ–≤–¥–æ–∫–æ–¥:
```python
for order in orders:            # 1M –∏—Ç–µ—Ä–∞—Ü–∏–π
    for customer in customers:  # 1M –∏—Ç–µ—Ä–∞—Ü–∏–π
        if order.customer_id == customer.id:
            output row
# Total: 1M √ó 1M = 1 —Ç—Ä–∏–ª–ª–∏–æ–Ω —Å—Ä–∞–≤–Ω–µ–Ω–∏–π! üî•
```

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è: –∏–Ω–¥–µ–∫—Å –Ω–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–º JOIN**

```sql
CREATE INDEX idx_customer_id ON customers(id);

-- –¢–µ–ø–µ—Ä—å:
for order in orders:            # 1M –∏—Ç–µ—Ä–∞—Ü–∏–π
    customer = lookup(order.customer_id in idx)  # O(log N) —á–µ—Ä–µ–∑ –∏–Ω–¥–µ–∫—Å
    if customer exists:
        output row
# Total: 1M √ó log(1M) ‚âà 20M –æ–ø–µ—Ä–∞—Ü–∏–π ‚úÖ
```

**–ö–æ–≥–¥–∞ –ø–æ–ª–µ–∑–µ–Ω:**

- **–ú–∞–ª–µ–Ω—å–∫–∏–π –≤–Ω–µ—à–Ω–∏–π –Ω–∞–±–æ—Ä** (< 1000 —Å—Ç—Ä–æ–∫) + –∏–Ω–¥–µ–∫—Å –Ω–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–º
- **Selective —Ñ–∏–ª—å—Ç—Ä—ã**: –Ω–∞–ø—Ä–∏–º–µ—Ä, WHERE customer_id = 123 ‚Üí 1 –∑–∞–∫–∞–∑

```sql
SELECT * FROM orders o 
JOIN customers c ON o.customer_id = c.id
WHERE o.customer_id = 123;
-- –í–Ω–µ—à–Ω–∏–π –Ω–∞–±–æ—Ä: 1 –∑–∞–∫–∞–∑
-- Nested loop: 1 iteration √ó log(1M) ‚âà 20 –æ–ø–µ—Ä–∞—Ü–∏–π ‚úÖ
```

**–ö–æ–≥–¥–∞ –ø–ª–æ—Ö–æ:**

- –ë–æ–ª—å—à–∏–µ –Ω–∞–±–æ—Ä—ã –±–µ–∑ –∏–Ω–¥–µ–∫—Å–∞ ‚Üí –∫–≤–∞–¥—Ä–∞—Ç–∏—á–Ω–∞—è —Å–ª–æ–∂–Ω–æ—Å—Ç—å

---

**2. Hash Join**

–•–µ—à-—Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞:

```
–®–∞–≥ 1: BUILD —Ñ–∞–∑–∞ (build hash table from smaller input)
FOR EACH row in customers:
    hash_table[customer.id] = customer

–®–∞–≥ 2: PROBE —Ñ–∞–∑–∞ (probe hash table with larger input)
FOR EACH row in orders:
    customer = hash_table.lookup(order.customer_id)
    if found:
        output row
```

**–ü—Ä–∏–º–µ—Ä:**

```
Customers: 100K —Å—Ç—Ä–æ–∫
Orders: 1M —Å—Ç—Ä–æ–∫

–®–∞–≥ 1: BUILD
–°–æ–∑–¥–∞—ë–º hash_table –∏–∑ customers (100K) ‚Üí 100K * 10 –æ–ø–µ—Ä–∞—Ü–∏–π = 1M

–®–∞–≥ 2: PROBE
–î–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–∫–∞–∑–∞ (1M) ‚Üí 1 –æ–ø–µ—Ä–∞—Ü–∏—è (hash lookup = O(1))
1M √ó 1 = 1M –æ–ø–µ—Ä–∞—Ü–∏–π

Total: 1M + 1M = 2M –æ–ø–µ—Ä–∞—Ü–∏–π ‚úÖ (vs Nested loop: 1M √ó log(100K) ‚âà 17M)
```

**–ö–æ–≥–¥–∞ –ø–æ–ª–µ–∑–µ–Ω:**

- **–ë–æ–ª—å—à–∏–µ –Ω–∞–±–æ—Ä—ã** (–æ–±–∞ > 100K —Å—Ç—Ä–æ–∫)
- **–ù–µ—Ç –∏–Ω–¥–µ–∫—Å–∞** –Ω–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–º JOIN
- **–†–∞–≤–µ–Ω—Å—Ç–≤–æ JOIN** (=), –Ω–µ –¥–∏–∞–ø–∞–∑–æ–Ω—ã

```sql
SELECT * FROM orders o 
JOIN customers c ON o.customer_id = c.id
-- –û–±–∞ –Ω–∞–±–æ—Ä–∞ –±–æ–ª—å—à–∏–µ, –Ω–µ—Ç –∏–Ω–¥–µ–∫—Å–∞ ‚Üí hash join

-- vs:
SELECT * FROM orders o 
JOIN customers c ON o.customer_id = c.id AND c.age > 30
-- –ï—Å—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä ‚Üí hash join
```

**–ö–æ–≥–¥–∞ –ø–ª–æ—Ö–æ:**

- **JOIN —Å –¥–∏–∞–ø–∞–∑–æ–Ω–æ–º**: `WHERE a > b` ‚Üí hash join –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç
- **ORDER BY**: —Ä–µ–∑—É–ª—å—Ç–∞—Ç –Ω–µ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω, –Ω—É–∂–Ω–∞ –¥–æ–ø. —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
- **–ú–Ω–æ–≥–æ –ø–∞–º—è—Ç–∏**: hash_table –º–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª—å—à–µ —á–µ–º RAM

---

**3. Merge Join**

–û–±–∞ –≤—Ö–æ–¥–∞ —É–∂–µ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã (–∏–ª–∏ —á–µ—Ä–µ–∑ –∏–Ω–¥–µ–∫—Å—ã):

```
–®–∞–≥ 1: Sort (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
orders.sort_by(customer_id)
customers.sort_by(id)

–®–∞–≥ 2: MERGE (–∫–∞–∫ —Å–ª–∏—è–Ω–∏–µ –¥–≤—É—Ö –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–∞—Å—Å–∏–≤–æ–≤)
ptr_orders = 0
ptr_customers = 0

while ptr_orders < len(orders) and ptr_customers < len(customers):
    if orders[ptr_orders].customer_id == customers[ptr_customers].id:
        output row
        ptr_orders++
    elif orders[ptr_orders].customer_id < customers[ptr_customers].id:
        ptr_orders++
    else:
        ptr_customers++
```

**–ü—Ä–∏–º–µ—Ä:**

```
Orders (–æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø–æ customer_id):
[customer_id: 1, 1, 3, 5, 7, 7, 7, 9, ...]

Customers (–æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø–æ id):
[id: 1, 2, 3, 4, 5, 6, 7, 8, ...]

Merge:
1 (order) == 1 (customer) ‚Üí output
1 (order) == 1 (customer) ‚Üí output
3 (order) == 3 (customer) ‚Üí output
5 (order) == 5 (customer) ‚Üí output
7 (order) == 7 (customer) ‚Üí output
... (–≤—Å–µ–≥–æ 1M + 100K = 1.1M –æ–ø–µ—Ä–∞—Ü–∏–π)
```

**–ö–æ–≥–¥–∞ –ø–æ–ª–µ–∑–µ–Ω:**

- **–û–±–∞ –≤—Ö–æ–¥–∞ —É–∂–µ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã**
  ```sql
  SELECT * FROM orders o 
  JOIN customers c ON o.customer_id = c.id
  WHERE 1=1
  ORDER BY o.customer_id;  -- —É–∂–µ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω JOIN key
  ```

- **–î–∏–∞–ø–∞–∑–æ–Ω JOIN**
  ```sql
  SELECT * FROM events e
  JOIN timelines t ON e.time >= t.start AND e.time < t.end
  -- Merge join –º–æ–∂–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –¥–∏–∞–ø–∞–∑–æ–Ω–∞–º–∏
  ```

- **–û–±–∞ –∏–Ω–¥–µ–∫—Å–∞ –¥–æ—Å—Ç—É–ø–Ω—ã**
  ```
  CREATE INDEX idx_orders_customer ON orders(customer_id);
  CREATE INDEX idx_customers_id ON customers(id);
  -- –û–±–µ —Ç–∞–±–ª–∏—Ü—ã —É–∂–µ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø–æ JOIN key (—á–µ—Ä–µ–∑ –∏–Ω–¥–µ–∫—Å—ã)
  -- Merge join –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
  ```

---

**–¢–∞–±–ª–∏—Ü–∞: Nested Loop vs Hash Join vs Merge Join**

| –°—Ü–µ–Ω–∞—Ä–∏–π | Nested Loop | Hash Join | Merge Join |
|----------|-------------|-----------|-----------|
| **–ú–∞–ª–µ–Ω—å–∫–∏–π + –∏–Ω–¥–µ–∫—Å** | ‚ö°‚ö°‚ö° | ‚ö° | ‚ö°‚ö° |
| **–ë–æ–ª—å—à–∏–µ –Ω–∞–±–æ—Ä—ã** | üê¢ | ‚ö°‚ö°‚ö° | ‚ö°‚ö° |
| **–ë–µ–∑ –∏–Ω–¥–µ–∫—Å–∞** | üê¢ | ‚ö°‚ö°‚ö° | ‚ö° (–Ω—É–∂–Ω–∞ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞) |
| **–†–∞–≤–µ–Ω—Å—Ç–≤–æ JOIN** | ‚ö° (—Å –∏–Ω–¥–µ–∫—Å–æ–º) | ‚ö°‚ö°‚ö° | ‚ö°‚ö° |
| **–î–∏–∞–ø–∞–∑–æ–Ω JOIN** | ‚ö°‚ö° | ‚ùå | ‚ö°‚ö°‚ö° |
| **ORDER BY** | ‚ö°‚ö° (–µ—Å–ª–∏ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ) | ‚ùå (–Ω—É–∂–Ω–∞ –¥–æ–ø. —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞) | ‚ö°‚ö°‚ö° |
| **–ü–∞–º—è—Ç—å** | üíæ (–Ω–∏–∑–∫–æ) | üíæ (–≤—ã—Å–æ–∫–æ, hash table) | üíæ (–Ω–∏–∑–∫–æ) |

---

**–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–º–µ—Ä (E-commerce):**

```sql
-- –ó–∞–ø—Ä–æ—Å: –ù–∞–π—Ç–∏ –≤—Å–µ –∑–∞–∫–∞–∑—ã —Å –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–∫—É–ø–∞—Ç–µ–ª—è
SELECT o.id, o.amount, c.name, c.email
FROM orders o
JOIN customers c ON o.customer_id = c.id;

-- –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ú–∞–ª–µ–Ω—å–∫–∏–π –∑–∞–∫–∞–∑ (10 —Å—Ç—Ä–æ–∫)
-- –ò–Ω–¥–µ–∫—Å: CREATE INDEX idx_customer_id ON customers(id);
-- ‚Üí Nested Loop (–º–∞–ª–µ–Ω—å–∫–∏–π √ó –∏–Ω–¥–µ–∫—Å = –±—ã—Å—Ç—Ä–æ)

-- –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ö—Ä—É–ø–Ω—ã–π –æ–ø–µ—Ä–∞—Ç–æ—Ä (1M –∑–∞–∫–∞–∑–æ–≤)
-- –ò–Ω–¥–µ–∫—Å: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
-- ‚Üí Hash Join (–Ω–µ—Ç –∏–Ω–¥–µ–∫—Å–∞, –±–æ–ª—å—à–∏–µ –Ω–∞–±–æ—Ä—ã = hash table)

-- –°—Ü–µ–Ω–∞—Ä–∏–π 3: –î–∏–∞–ø–∞–∑–æ–Ω–Ω—ã–π JOIN
-- WHERE o.order_date >= c.created_at AND o.order_date < c.created_at + INTERVAL 30 days
-- ‚Üí Merge Join (–µ—Å–ª–∏ –æ–±–µ —Ç–∞–±–ª–∏—Ü—ã –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –ø–æ –¥–∞—Ç–∞–º)
```

---

#### –í–æ–ø—Ä–æ—Å: –ß—Ç–æ —Ç–∞–∫–æ–µ "selectivity" –∏ –ø–æ—á–µ–º—É –æ–Ω–∞ –≤–∞–∂–Ω–µ–µ "–∫–æ–ª-–≤–∞ —Å—Ç—Ä–æ–∫"?

**–û—Ç–≤–µ—Ç:**
–°–µ–ª–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å ‚Äî –¥–æ–ª—è —Å—Ç—Ä–æ–∫, –ø—Ä–æ—Ö–æ–¥—è—â–∏—Ö —Ñ–∏–ª—å—Ç—Ä. –í—ã—Å–æ–∫–æ—Å–µ–ª–µ–∫—Ç–∏–≤–Ω—ã–π —Ñ–∏–ª—å—Ç—Ä –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∏–Ω–¥–µ–∫—Å; –Ω–∏–∑–∫–æ—Å–µ–ª–µ–∫—Ç–∏–≤–Ω—ã–π –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ seq scan –∫–∞–∫ –±–æ–ª–µ–µ –¥–µ—à—ë–≤–æ–º—É.

**–¢–µ–æ—Ä–∏—è –∏ –ø–æ–Ω–∏–º–∞–Ω–∏–µ:**

**Selectivity (—Å–µ–ª–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å)** ‚Äî —ç—Ç–æ **–ø—Ä–æ—Ü–µ–Ω—Ç —Å—Ç—Ä–æ–∫**, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ–π–¥—É—Ç —Ñ–∏–ª—å—Ç—Ä.

```
–°–µ–ª–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å = (—Å—Ç—Ä–æ–∫–∏ –ø–æ—Å–ª–µ WHERE) / (–≤—Å–µ–≥–æ —Å—Ç—Ä–æ–∫) √ó 100%
```

**–ü—Ä–∏–º–µ—Ä—ã:**

```sql
–¢–∞–±–ª–∏—Ü–∞ users: 1M —Å—Ç—Ä–æ–∫

-- –ó–∞–ø—Ä–æ—Å 1:
WHERE user_id = 123
‚Üí –†–µ–∑—É–ª—å—Ç–∞—Ç: 1 —Å—Ç—Ä–æ–∫–∞ (—Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ)
‚Üí –°–µ–ª–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: 1 / 1M = 0.0001% (–æ—á–µ–Ω—å —Å–µ–ª–µ–∫—Ç–∏–≤–Ω—ã–π!)

-- –ó–∞–ø—Ä–æ—Å 2:
WHERE country = 'Russia'
‚Üí –†–µ–∑—É–ª—å—Ç–∞—Ç: 300K —Å—Ç—Ä–æ–∫ (30% –æ—Ç –≤—Å–µ—Ö)
‚Üí –°–µ–ª–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: 300K / 1M = 30% (–Ω–∏–∑–∫–æ—Å–µ–ª–µ–∫—Ç–∏–≤–Ω—ã–π)

-- –ó–∞–ø—Ä–æ—Å 3:
WHERE age > 30
‚Üí –†–µ–∑—É–ª—å—Ç–∞—Ç: 500K —Å—Ç—Ä–æ–∫ (50% –æ—Ç –≤—Å–µ—Ö)
‚Üí –°–µ–ª–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: 500K / 1M = 50% (–æ—á–µ–Ω—å –Ω–∏–∑–∫–æ—Å–µ–ª–µ–∫—Ç–∏–≤–Ω—ã–π)

-- –ó–∞–ø—Ä–æ—Å 4:
WHERE is_premium = true
‚Üí –†–µ–∑—É–ª—å—Ç–∞—Ç: 50K —Å—Ç—Ä–æ–∫ (5% –æ—Ç –≤—Å–µ—Ö)
‚Üí –°–µ–ª–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: 50K / 1M = 5% (—Å–µ–ª–µ–∫—Ç–∏–≤–Ω—ã–π)
```

---

**–ü–æ—á–µ–º—É —Å–µ–ª–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –≤–∞–∂–Ω–µ–µ, —á–µ–º –∫–æ–ª-–≤–æ —Å—Ç—Ä–æ–∫:**

```
–¢–∞–±–ª–∏—Ü–∞: 1M —Å—Ç—Ä–æ–∫

–ò–Ω–¥–µ–∫—Å –Ω–∞ user_id: 100 MB (–º–∞–ª–æ)
–¢–∞–±–ª–∏—Ü–∞ –Ω–∞ –¥–∏—Å–∫–µ: 10 GB (–º–Ω–æ–≥–æ)

–ó–∞–ø—Ä–æ—Å: WHERE user_id = 123
–†–µ–∑—É–ª—å—Ç–∞—Ç: 1 —Å—Ç—Ä–æ–∫–∞

–í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–Ω–¥–µ–∫—Å
1. –ò—â–µ–º –≤ –∏–Ω–¥–µ–∫—Å–µ (100 MB) ‚Üí –Ω–∞—Ö–æ–¥–∏–º –±—ã—Å—Ç—Ä–æ (1 –æ–ø–µ—Ä–∞—Ü–∏—è)
2. –ò–¥—ë–º –≤ —Ç–∞–±–ª–∏—Ü—É –∑–∞ 1 —Å—Ç—Ä–æ–∫–æ–π (1 —Å–ª—É—á–∞–π–Ω—ã–π –¥–æ—Å—Ç—É–ø)
3. –í—Ä–µ–º—è: 1 –º—Å

–í–∞—Ä–∏–∞–Ω—Ç 2: Sequential scan —Ç–∞–±–ª–∏—Ü—ã
1. –ß–∏—Ç–∞–µ–º –≤—Å—é —Ç–∞–±–ª–∏—Ü—É (10 GB) –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
2. –î–ª—è –∫–∞–∂–¥–æ–π –∏–∑ 1M —Å—Ç—Ä–æ–∫ –ø—Ä–æ–≤–µ—Ä—è–µ–º user_id = 123
3. –í—Ä–µ–º—è: 10 —Å–µ–∫—É–Ω–¥

–î–∞–∂–µ —Ö–æ—Ç—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ú–ê–õ–ï–ù–¨–ö–ò–ô (1 —Å—Ç—Ä–æ–∫–∞), –∏–Ω–¥–µ–∫—Å –ù–ê–ú–ù–û–ì–û –±—ã—Å—Ç—Ä–µ–µ!
–ü–æ—Ç–æ–º—É —á—Ç–æ —Å–µ–ª–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –í–´–°–û–ö–ê–Ø (0.0001%).
```

---

**–ö–æ–≥–¥–∞ —Å–µ–ª–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø—Ä–æ–±–ª–µ–º–æ–π –¥–ª—è –∏–Ω–¥–µ–∫—Å–∞:**

```
–¢–∞–±–ª–∏—Ü–∞: 1M —Å—Ç—Ä–æ–∫
–ò–Ω–¥–µ–∫—Å –Ω–∞ is_premium: 100 MB

–ó–∞–ø—Ä–æ—Å: WHERE is_premium = true
–†–µ–∑—É–ª—å—Ç–∞—Ç: 500K —Å—Ç—Ä–æ–∫ (50%!)

–í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–Ω–¥–µ–∫—Å
1. –ò—â–µ–º –≤ –∏–Ω–¥–µ–∫—Å–µ –≤—Å–µ is_premium = true
2. –ò–Ω–¥–µ–∫—Å –¥–∞—ë—Ç 500K —É–∫–∞–∑–∞—Ç–µ–ª–µ–π –Ω–∞ —Å—Ç—Ä–æ–∫–∏
3. –ò–¥—ë–º –≤ —Ç–∞–±–ª–∏—Ü—É –∑–∞ –∫–∞–∂–¥–æ–π –∏–∑ 500K —Å—Ç—Ä–æ–∫ (500K —Å–ª—É—á–∞–π–Ω—ã—Ö –¥–æ—Å—Ç—É–ø–æ–≤)
4. –í—Ä–µ–º—è: 500K √ó (10 –º—Å –∑–∞ random access) = 5000 —Å–µ–∫—É–Ω–¥! üí•

–í–∞—Ä–∏–∞–Ω—Ç 2: Sequential scan —Ç–∞–±–ª–∏—Ü—ã
1. –ß–∏—Ç–∞–µ–º –≤—Å—é —Ç–∞–±–ª–∏—Ü—É (10 GB) –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
2. –î–ª—è –∫–∞–∂–¥–æ–π –∏–∑ 1M —Å—Ç—Ä–æ–∫ –ø—Ä–æ–≤–µ—Ä—è–µ–º is_premium = true
3. –§–∏–ª—å—Ç—Ä—É–µ–º: 500K —Å—Ç—Ä–æ–∫ –æ—Å—Ç–∞—é—Ç—Å—è
4. –í—Ä–µ–º—è: 10 GB / (100 MB/s) = 100 —Å–µ–∫—É–Ω–¥

Sequential scan –≤ 50x –ë–´–°–¢–†–ï–ï!
–ü–æ—Ç–æ–º—É —á—Ç–æ —Å–µ–ª–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –ù–ò–ó–ö–ê–Ø (50%).
```

---

**–¢–µ–æ—Ä–∏—è: –¢–æ—á–∫–∞ –ø–µ—Ä–µ–ª–æ–º–∞ (Tipping Point)**

–°—É—â–µ—Å—Ç–≤—É–µ—Ç **–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è —Å–µ–ª–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å**, –ø–æ—Å–ª–µ –∫–æ—Ç–æ—Ä–æ–π sequential scan –ª—É—á—à–µ –∏–Ω–¥–µ–∫—Å–∞.

```
–î–ª—è —Ç–∏–ø–∏—á–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã:

–°–µ–ª–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å < 1%  ‚Üí –∏–Ω–¥–µ–∫—Å –±—ã—Å—Ç—Ä–µ–µ
–°–µ–ª–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å 1-5%  ‚Üí –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–±–∞ –ø—Ä–∏–º–µ—Ä–Ω–æ –æ–¥–∏–Ω–∞–∫–æ–≤–æ
–°–µ–ª–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å > 5%  ‚Üí sequential scan –æ–±—ã—á–Ω–æ –±—ã—Å—Ç—Ä–µ–µ
```

**–ü–æ—á–µ–º—É:**

```
–ò–Ω–¥–µ–∫—Å: 1 –æ–ø–µ—Ä–∞—Ü–∏—è + K —Å–ª—É—á–∞–π–Ω—ã—Ö –¥–æ—Å—Ç—É–ø–æ–≤ (K = —Ä–µ–∑—É–ª—å—Ç–∞—Ç)
Sequential scan: 1 –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Ö–æ–¥

–í—Ä–µ–º—è –∏–Ω–¥–µ–∫—Å–∞:  t_index = 1 ms + K √ó 10 ms
–í—Ä–µ–º—è seq scan: t_seq    = (N / scan_speed) ms

–ü—Ä–∏ K = 0.01N (1% —Å–µ–ª–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å):
t_index = 1 + 100 = 101 ms
t_seq = 10000 ms
–ò–Ω–¥–µ–∫—Å –ª—É—á—à–µ ‚úÖ

–ü—Ä–∏ K = 0.5N (50% —Å–µ–ª–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å):
t_index = 1 + 5000 = 5001 ms
t_seq = 10000 ms
–ò–Ω–¥–µ–∫—Å –≤—Å—ë –µ—â—ë –ª—É—á—à–µ, –Ω–æ –±–ª–∏–∑–∫–æ

–ü—Ä–∏ K = 1.0N (100% —Å–µ–ª–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å):
t_index = 1 + 10000 = 10001 ms
t_seq = 10000 ms
Sequential scan –ª—É—á—à–µ!
```

---

**–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–º–µ—Ä (E-commerce):**

```sql
-- –°—Ü–µ–Ω–∞—Ä–∏–π 1: –í—ã—Å–æ–∫–∞—è —Å–µ–ª–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
SELECT * FROM orders WHERE order_id = 12345;
-- –†–µ–∑—É–ª—å—Ç–∞—Ç: 1 —Å—Ç—Ä–æ–∫–∞ –∏–∑ 10M
-- –°–µ–ª–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: 0.00001%
-- ‚Üí –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∏–Ω–¥–µ–∫—Å –Ω–∞ order_id ‚ö°

-- –°—Ü–µ–Ω–∞—Ä–∏–π 2: –°—Ä–µ–¥–Ω—è—è —Å–µ–ª–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
SELECT * FROM orders WHERE customer_id = 123;
-- –†–µ–∑—É–ª—å—Ç–∞—Ç: ~100 —Å—Ç—Ä–æ–∫ –∏–∑ 10M (—ç—Ç–æ—Ç –∫–ª–∏–µ–Ω—Ç –º–Ω–æ–≥–æ –∑–∞–∫–∞–∑–æ–≤)
-- –°–µ–ª–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: 0.001%
-- ‚Üí –ú–æ–∂–µ—Ç –±—ã—Ç—å –∏–Ω–¥–µ–∫—Å, –º–æ–∂–µ—Ç –±—ã—Ç—å seq scan (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ç–æ—Ä–∞) ‚ö°‚ö°

-- –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ù–∏–∑–∫–∞—è —Å–µ–ª–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
SELECT * FROM orders WHERE status = 'pending';
-- –†–µ–∑—É–ª—å—Ç–∞—Ç: 1M —Å—Ç—Ä–æ–∫ –∏–∑ 10M (–º–Ω–æ–≥–æ pending –∑–∞–∫–∞–∑–æ–≤)
-- –°–µ–ª–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: 10%
-- ‚Üí Sequential scan –ª—É—á—à–µ (–∏–Ω–¥–µ–∫—Å –Ω–∞ status –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è) üê¢

-- –°—Ü–µ–Ω–∞—Ä–∏–π 4: –û—á–µ–Ω—å –Ω–∏–∑–∫–∞—è —Å–µ–ª–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
SELECT * FROM orders WHERE is_active = true;
-- –†–µ–∑—É–ª—å—Ç–∞—Ç: 8M —Å—Ç—Ä–æ–∫ –∏–∑ 10M
-- –°–µ–ª–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: 80%
-- ‚Üí Sequential scan –¢–û–ß–ù–û –ª—É—á—à–µ (–¥–∞–∂–µ –Ω–µ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–µ–º –∏–Ω–¥–µ–∫—Å) üê¢
```

---

**–ö–∞–∫ –°–£–ë–î —Ä–µ—à–∞–µ—Ç —ç—Ç–∏ –≤–æ–ø—Ä–æ—Å—ã:**

–°–£–ë–î –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **cost estimator** –¥–ª—è –≤—ã–±–æ—Ä–∞ –ø–ª–∞–Ω–∞:

```sql
-- –î–ª—è –∑–∞–ø—Ä–æ—Å–∞:
SELECT * FROM orders WHERE status = 'pending';

-- CBO (Cost-Based Optimizer) —Å—á–∏—Ç–∞–µ—Ç:
Cost_index = 1 (–ø–æ–∏—Å–∫ –≤ –∏–Ω–¥–µ–∫—Å–µ) + 1000000 √ó 10 (random access –∫ 1M —Å—Ç—Ä–æ–∫–∞–º)
           = 10 000 001

Cost_seq_scan = 10 GB / 100 MB/s
              = 100 000 ms

-- 10 000 001 >> 100 000
-- ‚Üí –í—ã–±–∏—Ä–∞–µ—Ç seq scan ‚úÖ
```

---

**–¢–∞–±–ª–∏—Ü–∞: –°–µ–ª–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ –≤—ã–±–æ—Ä –ø–ª–∞–Ω–∞**

| –°–µ–ª–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å | –†–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ | –ò–Ω–¥–µ–∫—Å | Seq Scan | –í—ã–±–æ—Ä –°–£–ë–î |
|---------------|-------------|--------|----------|-----------|
| < 0.1% | < 1000 | ‚ö° | üê¢ | –ò–Ω–¥–µ–∫—Å |
| 0.1% - 1% | 1K - 10K | ‚ö° | ‚ö° | –ó–∞–≤–∏—Å–∏—Ç |
| 1% - 5% | 10K - 50K | ‚ö° | ‚ö°‚ö° | –ó–∞–≤–∏—Å–∏—Ç |
| 5% - 10% | 50K - 100K | ‚ö°‚ö° | ‚ö°‚ö° | –ó–∞–≤–∏—Å–∏—Ç |
| > 10% | > 100K | üê¢ | ‚ö°‚ö°‚ö° | Seq Scan |

---

#### –í–æ–ø—Ä–æ—Å: N+1 –≤ –ë–î ‚Äî –∫–∞–∫ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ —á–∏–Ω–∏—Ç—å?

**–û—Ç–≤–µ—Ç:**
–í –ª–æ–≥–∞—Ö/—Ç—Ä–µ–π—Å–∏–Ω–≥–µ –≤–∏–¥–Ω–æ –º–Ω–æ–≥–æ –æ–¥–Ω–æ—Ç–∏–ø–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤. –õ–µ—á–∏—Ç—Å—è JOIN/IN batch, prefetch, –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –º–æ–¥–µ–ª—å—é –¥–∞–Ω–Ω—ã—Ö, –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º.

**–¢–µ–æ—Ä–∏—è –∏ –ø–æ–Ω–∏–º–∞–Ω–∏–µ:**

**N+1 –ø—Ä–æ–±–ª–µ–º–∞** ‚Äî –∫–æ–≥–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–µ–ª–∞–µ—Ç 1 –∑–∞–ø—Ä–æ—Å + N –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –≤–º–µ—Å—Ç–æ 1 –±–æ–ª—å—à–æ–≥–æ.

**–ü—Ä–∏–º–µ—Ä –ø—Ä–æ–±–ª–µ–º—ã:**

```python
# –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
users = db.query("SELECT * FROM users")  # 1 –∑–∞–ø—Ä–æ—Å

# –ü–æ—Ç–æ–º –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ–ª—É—á–∞–µ–º –µ–≥–æ –∑–∞–∫–∞–∑—ã
for user in users:
    orders = db.query(f"SELECT * FROM orders WHERE user_id = {user.id}")
    user.orders = orders
# ‚Üê –ï—â—ë N –∑–∞–ø—Ä–æ—Å–æ–≤ (–≥–¥–µ N = –∫–æ–ª-–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)

# –í—Å–µ–≥–æ: 1 + N –∑–∞–ø—Ä–æ—Å–æ–≤ (–µ—Å–ª–∏ 1000 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π ‚Üí 1001 –∑–∞–ø—Ä–æ—Å!)
```

**–ü–æ—á–µ–º—É —ç—Ç–æ –ø–ª–æ—Ö–æ:**

```
1. –ú–µ–¥–ª–µ–Ω–Ω–æ: –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å = round trip –Ω–∞ —Å–µ—Ä–≤–µ—Ä –ë–î
2. –ù–∞–≥—Ä—É–∑–∫–∞: 1000 –∑–∞–ø—Ä–æ—Å–æ–≤ –≤–º–µ—Å—Ç–æ 1-2 ‚Üí –ë–î –ø–µ—Ä–µ–≥—Ä—É–∂–µ–Ω–∞
3. –ó–∞–¥–µ—Ä–∂–∫–∞: 1000 √ó (10 –º—Å –Ω–∞ –∑–∞–ø—Ä–æ—Å) = 10 —Å–µ–∫ –≤–º–µ—Å—Ç–æ 100 –º—Å

–†–µ–∑—É–ª—å—Ç–∞—Ç: –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã 100x –º–µ–¥–ª–µ–Ω–Ω–µ–µ!
```

---

**–°–ø–æ—Å–æ–± 1: JOIN –≤ –æ–¥–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ**

```sql
-- –ü–ª–æ—Ö–æ (N+1):
SELECT * FROM users;  -- 1 –∑–∞–ø—Ä–æ—Å
-- –ø–æ—Ç–æ–º –≤ —Ü–∏–∫–ª–µ:
SELECT * FROM orders WHERE user_id = ?;  -- N –∑–∞–ø—Ä–æ—Å–æ–≤

-- –•–æ—Ä–æ—à–æ (1 –∑–∞–ø—Ä–æ—Å):
SELECT u.*, o.* 
FROM users u 
LEFT JOIN orders o ON u.id = o.user_id;
-- 1 –∑–∞–ø—Ä–æ—Å, –≤—Å—ë –≤ –ø–∞–º—è—Ç–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
```

**–ö–æ–≥–¥–∞ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

- –ù—É–∂–Ω—ã –¥–∞–Ω–Ω—ã–µ –∏–∑ –æ–¥–Ω–æ–π –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ç–∞–±–ª–∏—Ü
- –°–≤—è–∑—å 1-–∫–æ-–º–Ω–æ–≥–∏–º (1 —é–∑–µ—Ä ‚Üí –º–Ω–æ–≥–æ –∑–∞–∫–∞–∑–æ–≤)

**–ö–æ–≥–¥–∞ —ç—Ç–æ —Å–ª–æ–∂–Ω–µ–µ:**

```python
# –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –≤–ª–æ–∂–µ–Ω—ã:
users = [{
    id: 1,
    name: 'Alice',
    orders: [  # ‚Üê —ç—Ç–æ –º–Ω–æ–≥–∏–µ –∑–∞–∫–∞–∑—ã
        { id: 1, product: {...} },  # ‚Üê –≤–ª–æ–∂–µ–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã!
        { id: 2, product: {...} }
    ]
}]

# 1 JOIN (users ‚Üê orders):
SELECT u.*, o.* FROM users u LEFT JOIN orders o ON u.id = o.user_id;

# –ü–æ—Ç–æ–º –Ω—É–∂–Ω—ã —Ç–æ–≤–∞—Ä—ã ‚Üí –µ—â—ë 1 JOIN:
SELECT u.*, o.*, p.* 
FROM users u 
LEFT JOIN orders o ON u.id = o.user_id
LEFT JOIN products p ON o.product_id = p.id;
```

---

**–°–ø–æ—Å–æ–± 2: IN batch / –º–Ω–æ–≥–æ–∑–Ω–∞—á–Ω—ã–π –∑–∞–ø—Ä–æ—Å**

```python
# –ü–ª–æ—Ö–æ (N+1):
orders = []
for user in users:
    user_orders = db.query(f"SELECT * FROM orders WHERE user_id = {user.id}")
    orders.extend(user_orders)
# N –∑–∞–ø—Ä–æ—Å–æ–≤

# –•–æ—Ä–æ—à–æ (1 –∑–∞–ø—Ä–æ—Å):
user_ids = [u.id for u in users]  # [1, 2, 3, ..., 1000]
orders = db.query(f"SELECT * FROM orders WHERE user_id IN ({','.join(user_ids)})")
# 1 –∑–∞–ø—Ä–æ—Å, –≤—Å—ë —Å—Ä–∞–∑—É
```

**–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è: batch —Ä–∞–∑–º–µ—Ä**

```python
# –ï—Å–ª–∏ 1M user_ids ‚Üí –≤—Å—è –æ–Ω–∏ –º–æ–≥—É—Ç –Ω–µ –≤–ª–µ–∑—Ç—å –≤ 1 –∑–∞–ø—Ä–æ—Å

# –•–æ—Ä–æ—à–æ (–Ω–µ—Å–∫–æ–ª—å–∫–æ –±–æ–ª—å—à–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –≤–º–µ—Å—Ç–æ N):
batch_size = 1000
for i in range(0, len(user_ids), batch_size):
    batch = user_ids[i:i+batch_size]
    orders = db.query(f"SELECT * FROM orders WHERE user_id IN ({','.join(batch)})")
    # 1000 –∑–∞–ø—Ä–æ—Å–æ–≤ ‚Üí ~1 –∑–∞–ø—Ä–æ—Å (–≤–º–µ—Å—Ç–æ 1M)
```

---

**–°–ø–æ—Å–æ–± 3: Prefetch / lazy loading**

–ú–Ω–æ–≥–æ frameworks –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫—É:

```python
# Django ORM:
users = User.objects.prefetch_related('orders')  # 2 –∑–∞–ø—Ä–æ—Å–∞ (1 users + 1 orders)
for user in users:
    print(user.orders)  # –ù–ï –¥–µ–ª–∞–µ—Ç –¥–æ–ø. –∑–∞–ø—Ä–æ—Å!

# SQLAlchemy:
from sqlalchemy.orm import joinedload
users = db.query(User).options(joinedload(User.orders))
for user in users:
    print(user.orders)  # —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ
```

**–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

```
1. SELECT * FROM users;  # 1 –∑–∞–ø—Ä–æ—Å ‚Üí –ø–æ–ª—É—á–∏—Ç 1000 users
2. SELECT * FROM orders WHERE user_id IN (select distinct user_id from users);
   # 1 –∑–∞–ø—Ä–æ—Å ‚Üí –ø–æ–ª—É—á–∏—Ç –í–°–ï –∑–∞–∫–∞–∑—ã –¥–ª—è —ç—Ç–∏—Ö —é–∑–µ—Ä–æ–≤
3. Python: –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ –ø–∞–º—è—Ç–∏

–í—Å–µ–≥–æ: 2 –∑–∞–ø—Ä–æ—Å–∞ –≤–º–µ—Å—Ç–æ 1001!
```

---

**–°–ø–æ—Å–æ–± 4: –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ (–¥–ª—è –µ—â—ë –±–æ–ª—å—à–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏)**

```python
# –ï—Å–ª–∏ –æ–¥–Ω–∏ –∏ —Ç–µ –∂–µ –∑–∞–∫–∞–∑—ã –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—Ç—Å—è —á–∞—Å—Ç–æ:
cache = {}

def get_user_orders(user_id):
    if user_id in cache:
        return cache[user_id]  # –∏–∑ –ø–∞–º—è—Ç–∏ (0 –º—Å)
    
    orders = db.query(f"SELECT * FROM orders WHERE user_id = {user_id}")
    cache[user_id] = orders
    return orders

# –ü–µ—Ä–≤—ã–π –≤—ã–∑–æ–≤: –∑–∞–ø—Ä–æ—Å –≤ –ë–î
get_user_orders(123)  # ‚Üí –ë–î, 10 –º—Å

# –í—Ç–æ—Ä–æ–π –≤—ã–∑–æ–≤: –∏–∑ –∫—ç—à–∞
get_user_orders(123)  # ‚Üí –∫—ç—à, 0.1 –º—Å
```

---

**–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ N+1 –ø—Ä–æ–±–ª–µ–º—ã:**

```
–°–ø–æ—Å–æ–± 1: –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
–ü–æ—Å–º–æ—Ç—Ä–∏, –∫–∞–∫ –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –æ–¥–Ω–æ–≥–æ —Ç–∏–ø–∞:
SELECT * FROM orders WHERE user_id = ?  -- –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è 1000x!

–°–ø–æ—Å–æ–± 2: –¢—Ä–µ–π—Å–∏–Ω–≥ (Django debug toolbar, etc)
Shows all queries + stack trace
–í–∏–¥–∏—à—å –º–Ω–æ–≥–æ –ø–æ—Ö–æ–∂–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ ‚Üí N+1!

–°–ø–æ—Å–æ–± 3: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ë–î
SELECT * FROM mysql.slow_query_log
–ú–Ω–æ–≥–æ –ø–æ—Ö–æ–∂–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ —Å ms —Ä–∞–∑–Ω–∏—Ü–µ–π ‚Üí –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–µ–ª–∞–µ—Ç N+1
```

---

**–¢–∞–±–ª–∏—Ü–∞: –ú–µ—Ç–æ–¥—ã —Ä–µ—à–µ–Ω–∏—è N+1**

| –ú–µ—Ç–æ–¥ | –°–ª–æ–∂–Ω–æ—Å—Ç—å | –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å | –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å |
|-------|-----------|-------------------|-------------------|
| **JOIN –≤ SQL** | ‚≠ê | ‚ö°‚ö°‚ö° | –ü—Ä–æ—Å—Ç—ã–µ 1-–∫–æ-–º–Ω–æ–≥–∏–º –æ—Ç–Ω–æ—à–µ–Ω–∏—è |
| **IN batch** | ‚≠ê‚≠ê | ‚ö°‚ö° | –ú–Ω–æ–≥–æ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ |
| **Prefetch ORM** | ‚≠ê | ‚ö°‚ö°‚ö° | Framework –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç (Django, SQLAlchemy) |
| **–ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ** | ‚≠ê‚≠ê‚≠ê | ‚ö°‚ö°‚ö° (–µ—Å–ª–∏ hit) | –ß–∞—Å—Ç–æ –ø–æ–≤—Ç–æ—Ä—è–µ–º—ã–µ –∑–∞–ø—Ä–æ—Å—ã |
| **–î–µ–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è** | ‚≠ê‚≠ê‚≠ê‚≠ê | ‚ö°‚ö°‚ö° | –ö–æ–≥–¥–∞ JOIN —Å–ª–∏—à–∫–æ–º –¥–æ—Ä–æ–≥ |

---


### –†–µ–ø–ª–∏–∫–∞—Ü–∏—è, —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ, CAP, –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å

#### –í–æ–ø—Ä–æ—Å: CAP ‚Äî —á—Ç–æ —Ä–µ–∞–ª—å–Ω–æ –æ–∑–Ω–∞—á–∞–µ—Ç ‚ÄúPartition tolerance must-have‚Äù?

**–û—Ç–≤–µ—Ç:**  
–í —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Å–µ—Ç–∏ –Ω–µ–∏–∑–±–µ–∂–Ω–æ, –ø–æ—ç—Ç–æ–º—É P –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –≤—Å–µ–≥–¥–∞ –ø—Ä–∏–Ω–∏–º–∞—é—Ç –∫–∞–∫ –¥–∞–Ω–Ω–æ—Å—Ç—å. –í—ã–±–æ—Ä –æ–±—ã—á–Ω–æ –º–µ–∂–¥—É C –∏ A –≤ —É—Å–ª–æ–≤–∏—è—Ö partition.

**–¢–µ–æ—Ä–∏—è –∏ –ø–æ–Ω–∏–º–∞–Ω–∏–µ:**

CAP –≥–æ–≤–æ—Ä–∏—Ç: –ø—Ä–∏¬†**—Å–µ—Ç–µ–≤–æ–º —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–∏ (Partition)**¬†—Å–∏—Å—Ç–µ–º–∞ –Ω–µ –º–æ–∂–µ—Ç –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞—Ç—å –∏¬†**—Å—Ç—Ä–æ–≥—É—é –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å (C)**, –∏¬†**–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å (A)**. –í —Ä–µ–∞–ª—å–Ω–æ–π –∂–∏–∑–Ω–∏:

- P (partition tolerance) ‚Äî –Ω–µ –æ–ø—Ü–∏—è, –∞ –¥–∞–Ω–Ω–æ—Å—Ç—å: —Å–µ—Ç—å –∏–Ω–æ–≥–¥–∞ —Ä–≤—ë—Ç—Å—è.
    
- –í –Ω–æ—Ä–º–∞–ª—å–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏ —Å–∏—Å—Ç–µ–º–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏ C, –∏ A.
    
- **–ö–æ–º–ø—Ä–æ–º–∏—Å—Å –ø—Ä–æ—è–≤–ª—è–µ—Ç—Å—è –∏–º–µ–Ω–Ω–æ –≤ –º–æ–º–µ–Ω—Ç partition**:
    
    - –õ–∏–±–æ –∂—ë—Å—Ç–∫–æ –ø—Ä–∏–¥–µ—Ä–∂–∏–≤–∞–µ–º—Å—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏: —á–∞—Å—Ç—å –∑–∞–ø—Ä–æ—Å–æ–≤ –±—É–¥–µ—Ç –ø–∞–¥–∞—Ç—å/–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å—Å—è (–ø–æ—Ç–µ—Ä—è A).
        
    - –õ–∏–±–æ –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –∑–∞–ø—Ä–æ—Å—ã —Å –ª–æ–∫–∞–ª—å–Ω—ã—Ö —Ä–µ–ø–ª–∏–∫, —Ä–∏—Å–∫—É—è –æ—Ç–¥–∞–≤–∞—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –¥–∞–Ω–Ω—ã–µ (–ø–æ—Ç–µ—Ä—è C).
        

–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏:

- –ë–∞–Ω–∫–æ–≤—Å–∫–∏–π –ø–µ—Ä–µ–≤–æ–¥: –ª—É—á—à–µ –æ—Ç–∫–∞–∑–∞—Ç—å –≤ –æ–ø–µ—Ä–∞—Ü–∏–∏, —á–µ–º –ø—Ä–æ–≤–µ—Å—Ç–∏ –µ—ë –¥–≤–∞–∂–¥—ã ‚Üí –±–ª–∏–∂–µ –∫ CP.
    
- –õ–µ–Ω—Ç–∞ —Å–æ—Ü—Å–µ—Ç–∏: –ª—É—á—à–µ –ø–æ–∫–∞–∑–∞—Ç—å –Ω–µ–º–Ω–æ–≥–æ —É—Å—Ç–∞—Ä–µ–≤—à–∏–π —Ñ–∏–¥, —á–µ–º 500/timeout ‚Üí –±–ª–∏–∂–µ –∫ AP.
    

–í–∞–∂–Ω–æ: CAP ‚Äî –æ—á–µ–Ω—å —É–ø—Ä–æ—â—ë–Ω–Ω–∞—è –º–æ–¥–µ–ª—å. –í —Ä–µ–∞–ª—å–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö –∏—Å–ø–æ–ª—å–∑—É—é—Ç:

- **Tunable consistency**¬†(–∫–∞–∫ –≤ Cassandra): –≤—ã–±–∏—Ä–∞—é—Ç —É—Ä–æ–≤–µ–Ω—å –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –Ω–∞ –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å.
    
- **PACELC**: –µ—Å–ª–∏ Partition (P) ‚Äî –≤—ã–±–∏—Ä–∞–µ—à—å –º–µ–∂–¥—É A –∏ C, Else (–Ω–µ—Ç P) ‚Äî –≤—ã–±–∏—Ä–∞–µ—à—å –º–µ–∂–¥—É Latency –∏ Consistency.
    

---

#### –í–æ–ø—Ä–æ—Å: Strong vs eventual consistency ‚Äî –∫–∞–∫ –æ–±—ä—è—Å–Ω–∏—Ç—å –±–∏–∑–Ω–µ—Å—É?

**–û—Ç–≤–µ—Ç:**  
Strong: —á—Ç–µ–Ω–∏—è –≤—Å–µ–≥–¥–∞ –≤–∏–¥—è—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω–æ–µ. Eventual: –∏–∑–º–µ–Ω–µ–Ω–∏—è ‚Äú–¥–æ–π–¥—É—Ç‚Äù –¥–æ –≤—Å–µ—Ö, –Ω–æ –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è –≤–æ–∑–º–æ–∂–Ω—ã —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ. –¶–µ–Ω–∞ strong ‚Äî latency/–æ—Ç–∫–∞–∑—ã –ø—Ä–∏ –∫–≤–æ—Ä—É–º–µ.

**–¢–µ–æ—Ä–∏—è –∏ –ø–æ–Ω–∏–º–∞–Ω–∏–µ:**

–ú–æ–∂–Ω–æ –æ–±—ä—è—Å–Ω–∏—Ç—å –±–∏–∑–Ω–µ—Å—É —á–µ—Ä–µ–∑ –ø—Ä–∏–º–µ—Ä—ã.

**Strong consistency (—Å—Ç—Ä–æ–≥–∞—è):**

- –ö–∞–∫ ¬´–µ–¥–∏–Ω–∞—è –∏—Å—Ç–∏–Ω–∞¬ª: –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∑–∞–ø–∏—Å–∏¬†**–≤—Å–µ**¬†–ø–æ—Å–ª–µ–¥—É—é—â–∏–µ —á—Ç–µ–Ω–∏—è (–Ω–∞ –ª—é–±—ã—Ö —Ä–µ–ø–ª–∏–∫–∞—Ö) –≤–∏–¥—è—Ç –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.
    
- –ß–∞—Å—Ç–æ —Ç—Ä–µ–±—É–µ—Ç:
    
    - –ö–≤–æ—Ä—É–º –∑–∞–ø–∏—Å–∏ (–Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–µ–ø–ª–∏–∫ –¥–æ–ª–∂–Ω—ã –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å) ‚Üí —Ä–∞—Å—Ç—ë—Ç –∑–∞–¥–µ—Ä–∂–∫–∞.
        
    - –ë–ª–æ–∫–∏—Ä–æ–≤–∫—É —á—Ç–µ–Ω–∏–π, –ø–æ–∫–∞ –Ω–µ –±—É–¥–µ—Ç —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏, —á—Ç–æ –≤—Å–µ —Ä–µ–ø–ª–∏–∫–∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω—ã.
        
- –ü—Ä–∏–º–µ—Ä –∏–∑ –∂–∏–∑–Ω–∏: –±–∞–Ω–∫–æ–º–∞—Ç –∏ –±–∞–ª–∞–Ω—Å –∫–∞—Ä—Ç—ã ‚Äî –Ω–µ–ª—å–∑—è —É–≤–∏–¥–µ—Ç—å —Å—Ç–∞—Ä—ã–π –±–∞–ª–∞–Ω—Å –ø–æ—Å–ª–µ —Å–ø–∏—Å–∞–Ω–∏—è.
    

**Eventual consistency (–≤ –∫–æ–Ω–µ—á–Ω–æ–º —Å—á—ë—Ç–µ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–∞—è):**

- –ü–æ—Å–ª–µ –∑–∞–ø–∏—Å–∏ —Ä–∞–∑–Ω—ã–µ —Ä–µ–ø–ª–∏–∫–∏ –º–æ–≥—É—Ç¬†**–∫–∞–∫–æ–µ-—Ç–æ –≤—Ä–µ–º—è**¬†–ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è.
    
- –ß–µ—Ä–µ–∑ –Ω–µ–±–æ–ª—å—à–æ–π –∏–Ω—Ç–µ—Ä–≤–∞–ª (—Å–µ–∫—É–Ω–¥—ã/–¥–µ—Å—è—Ç–∫–∏ —Å–µ–∫—É–Ω–¥) –≤—Å–µ —Ä–µ–ø–ª–∏–∫–∏ —Å—Ö–æ–¥—è—Ç—Å—è –∫ –æ–¥–Ω–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é.
    
- –û—á–µ–Ω—å –±—ã—Å—Ç—Ä–æ, –≤—ã—Å–æ–∫–∏–π –∞–ø—Ç–∞–π–º, –ª–µ–≥–∫–æ —Å–∫–µ–π–ª–∏—Ç—Å—è.
    
- –ü—Ä–∏–º–µ—Ä: —Å—á—ë—Ç—á–∏–∫ –ª–∞–π–∫–æ–≤ –≤ —Å–æ—Ü—Å–µ—Ç–∏ ‚Äî –Ω–µ —Å—Ç—Ä–∞—à–Ω–æ, –µ—Å–ª–∏ –ø–∞—Ä—É —Å–µ–∫—É–Ω–¥ –æ–Ω –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ä–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.
    

**–ö–æ–º–ø—Ä–æ–º–∏—Å—Å—ã:**

- Strong:
    
    - - –ù–µ—Ç —Å—é—Ä–ø—Ä–∏–∑–æ–≤ –≤ –¥–∞–Ω–Ω—ã—Ö.
            
    - ‚àí –í—ã—à–µ latency, –±–æ–ª—å—à–µ –æ—à–∏–±–æ–∫ –ø—Ä–∏ partial outage (–Ω–µ—Ç –∫–≤–æ—Ä—É–º–∞ ‚Üí –æ—à–∏–±–∫–∞).
        
- Eventual:
    
    - - –ë—ã—Å—Ç—Ä–æ, —É—Å—Ç–æ–π—á–∏–≤–æ –∫ –ø–∞–¥–µ–Ω–∏—è–º —É–∑–ª–æ–≤.
            
    - ‚àí –í—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–æ—Å–æ–±–µ–Ω–Ω–æ –≤–∏–¥–Ω–æ –ø—Ä–∏ –∫—Ä–æ—Å—Å-–∑–∞–ø—Ä–æ—Å–∞—Ö).
        

–¢–∏–ø–∏—á–Ω–æ:

- **–î–µ–Ω—å–≥–∏, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, –∏–Ω–≤–µ–Ω—Ç–æ—Ä–∏ –Ω–∞ —Å–∫–ª–∞–¥–µ**¬†‚Äî strong (–ª–∏–±–æ near-strong —Å–æ —Å–ª–æ–∂–Ω–æ–π –ª–æ–≥–∏–∫–æ–π).
    
- **–õ–µ–Ω—Ç—ã, –ª–∞–π–∫–∏, –ø—Ä–æ—Å–º–æ—Ç—Ä—ã, –º–µ—Ç—Ä–∏–∫–∏**¬†‚Äî eventual.
    

---

#### –í–æ–ø—Ä–æ—Å: –ß—Ç–æ —Ç–∞–∫–æ–µ quorum reads/writes (R/W/N) –∏ –∫–∞–∫ —ç—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç?

**–û—Ç–≤–µ—Ç:**  
–ü—Ä–∏ N —Ä–µ–ø–ª–∏–∫–∞—Ö: –∑–∞–ø–∏—Å—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç—Å—è W —Ä–µ–ø–ª–∏–∫–∞–º–∏, —á—Ç–µ–Ω–∏–µ ‚Äî —Å R. –ï—Å–ª–∏ R+W>N, –ø–æ–≤—ã—à–∞–µ–º —à–∞–Ω—Å –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ, –±–∞–ª–∞–Ω—Å–∏—Ä—É—è latency/–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å.

**–¢–µ–æ—Ä–∏—è –∏ –ø–æ–Ω–∏–º–∞–Ω–∏–µ:**

–°—Ö–µ–º–∞:

- **N**¬†‚Äî —Å–∫–æ–ª—å–∫–æ –≤—Å–µ–≥–æ —Ä–µ–ø–ª–∏–∫ —Ö—Ä–∞–Ω–∏—Ç –¥–∞–Ω–Ω—ã–µ.
    
- **W**¬†‚Äî —Å–∫–æ–ª—å–∫–æ —Ä–µ–ø–ª–∏–∫ –¥–æ–ª–∂–Ω—ã –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞–ø–∏—Å—å, —á—Ç–æ–±—ã –æ–Ω–∞ —Å—á–∏—Ç–∞–ª–∞—Å—å —É—Å–ø–µ—à–Ω–æ–π.
    
- **R**¬†‚Äî —Å–∫–æ–ª—å–∫–æ —Ä–µ–ø–ª–∏–∫ –Ω—É–∂–Ω–æ –æ–ø—Ä–æ—Å–∏—Ç—å –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏.
    

**–ò–¥–µ—è –∫–≤–æ—Ä—É–º–∞:**

–ï—Å–ª–∏ –≤—ã–±—Ä–∞—Ç—å R –∏ W —Ç–∞–∫, —á—Ç–æ¬†**R + W > N**, —Ç–æ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ —á–∏—Ç–∞—é—â–∏—Ö –∏ –ø–∏—à—É—â–∏—Ö —Ä–µ–ø–ª–∏–∫ –ø–µ—Ä–µ—Å–µ–∫–∞—é—Ç—Å—è —Ö–æ—Ç—è –±—ã –≤ –æ–¥–Ω–æ–π:

- –≠—Ç–∞ –æ–±—â–∞—è —Ä–µ–ø–ª–∏–∫–∞¬†**–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ**¬†–≤–∏–¥–∏—Ç –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é ‚Üí —á–∏—Ç–∞—é—â–∏–π —Å –±–æ–ª—å—à–æ–π –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é –ø–æ–ª—É—á–∏—Ç —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ.
    

–ü—Ä–∏–º–µ—Ä—ã:

- N=3:
    
    - W=2, R=2 ‚Üí 2+2=4 > 3 ‚Üí –∫–≤–æ—Ä—É–º (typical).
        
    - W=1, R=3 ‚Üí 1+3=4 > 3 ‚Üí –∫–≤–æ—Ä—É–º, –±—ã—Å—Ç—Ä—ã–µ –∑–∞–ø–∏—Å–∏, –¥–æ—Ä–æ–≥–∏–µ —á—Ç–µ–Ω–∏—è.
        
    - W=3, R=1 ‚Üí 3+1=4 > 3 ‚Üí –º–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏, –±—ã—Å—Ç—Ä—ã–µ —á—Ç–µ–Ω–∏—è.
        
    - W=1, R=1 ‚Üí 1+1=2 ‚â§ 3 ‚Üí –≤–æ–∑–º–æ–∂–Ω–æ –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Å—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ.
        

–ö–æ–º–ø—Ä–æ–º–∏—Å—Å—ã:

- –£–≤–µ–ª–∏—á–µ–Ω–∏–µ W:
    
    - - –ë–æ–ª—å—à–µ –≥–∞—Ä–∞–Ω—Ç–∏–π, —á—Ç–æ –∑–∞–ø–∏—Å—å –¥–æ—à–ª–∞ –¥–æ –º–Ω–æ–≥–∏—Ö —Ä–µ–ø–ª–∏–∫.
            
    - ‚àí –ó–∞–ø–∏—Å—å –º–µ–¥–ª–µ–Ω–Ω–µ–µ, —Ö—É–∂–µ –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏—è—Ö.
        
- –£–≤–µ–ª–∏—á–µ–Ω–∏–µ R:
    
    - - –ß—Ç–µ–Ω–∏—è —á–∞—â–µ –≤–∏–¥—è—Ç —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ.
            
    - ‚àí –ß—Ç–µ–Ω–∏—è –º–µ–¥–ª–µ–Ω–Ω–µ–µ, –±–æ–ª—å—à–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ —Ä–µ–ø–ª–∏–∫–∞–º.
        

–ü—Ä–∞–∫—Ç–∏–∫–∞:

- –í Cassandra/Scylla –∏ –ø–æ–¥–æ–±–Ω—ã—Ö: –Ω–∞ –∑–∞–ø—Ä–æ—Å –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å —É—Ä–æ–≤–µ–Ω—å –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ (ONE/QUORUM/ALL).
    
- –î–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (–¥–µ–Ω–µ–∂–Ω—ã–µ) ‚Äî QUORUM/ALL.
    
- –î–ª—è –º–µ–Ω–µ–µ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö ‚Äî ONE/LOCAL_QUORUM.
    

---

#### –í–æ–ø—Ä–æ—Å: –®–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ: range vs hash ‚Äî –ø–ª—é—Å—ã/–º–∏–Ω—É—Å—ã?

**–û—Ç–≤–µ—Ç:**  
Range ‚Äî —É–¥–æ–±–Ω–æ –¥–ª—è –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤, –Ω–æ hot shard. Hash ‚Äî —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ, –Ω–æ –¥–∏–∞–ø–∞–∑–æ–Ω—ã —Ä–∞—Å–ø–æ–ª–∑–∞—é—Ç—Å—è –ø–æ —à–∞—Ä–¥–∞–º, —Å–ª–æ–∂–Ω–µ–µ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏.

**–¢–µ–æ—Ä–∏—è –∏ –ø–æ–Ω–∏–º–∞–Ω–∏–µ:**

**Range sharding (–ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞–º –∫–ª—é—á–µ–π):**

- –ö–ª—é—á–∏ –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ —Ä–∞–∑–±–∏—Ç—ã –Ω–∞ –¥–∏–∞–ø–∞–∑–æ–Ω—ã:
    
    - –®–∞—Ä–¥ 1: id 1‚Äì1M
        
    - –®–∞—Ä–¥ 2: id 1M‚Äì2M
        
    - –®–∞—Ä–¥ 3: id 2M‚Äì3M
        

–ü–ª—é—Å—ã:

- –û—Ç–ª–∏—á–µ–Ω –¥–ª—è –¥–∏–∞–ø–∞–∑–æ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤:
    
    - `WHERE created_at BETWEEN ...`¬†‚Üí –≤—Å—ë –Ω–∞ 1‚Äì2 —à–∞—Ä–¥–∞—Ö.
        
    - `WHERE user_id BETWEEN 100 AND 200`¬†‚Üí —Ç–µ –∂–µ.
        
- –£–¥–æ–±–Ω–æ –¥–µ–ª–∞—Ç—å¬†**–ª–æ–∫–∞–ª—å–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –∏ —Å–∫–∞–Ω—ã**.
    
- –•–æ—Ä–æ—à–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å time-series (–µ—Å–ª–∏ –≥—Ä–∞–º–æ—Ç–Ω–æ –≤—ã–±–∏—Ä–∞—Ç—å –∫–ª—é—á).
    

–ú–∏–Ω—É—Å—ã:

- –†–∏—Å–∫¬†**hot shard**:
    
    - –ï—Å–ª–∏ —à–∞—Ä–¥–∏—Ä—É—é—Ç –ø–æ –∞–≤—Ç–æ–Ω—É–º–µ—Ä—É—é—â–µ–º—É—Å—è ID –∏–ª–∏ timestamp (–º–æ–Ω–æ—Ç–æ–Ω–Ω—ã–π), –≤–µ—Å—å –Ω–æ–≤—ã–π —Ç—Ä–∞—Ñ–∏–∫ –∏–¥—ë—Ç –≤ –ø–æ—Å–ª–µ–¥–Ω–∏–π —à–∞—Ä–¥.
        
- –ù—É–∂–µ–Ω¬†**rebalancing**:
    
    - –î–∏–∞–ø–∞–∑–æ–Ω—ã —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º –Ω–µ—Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ –Ω–∞–≥—Ä—É–∂–∞—é—Ç—Å—è ‚Üí –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –ø–µ—Ä–µ—Å–µ–∫–∞—Ç—å –≥—Ä–∞–Ω–∏—Ü—ã —à–∞—Ä–¥–∞ –∏ –º–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ.
        

---

**Hash sharding:**

- –í–º–µ—Å—Ç–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞:¬†`shard = hash(key) % num_shards`.
    
- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ—á—Ç–∏ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ.
    

–ü–ª—é—Å—ã:

- –ü–æ—á—Ç–∏ –Ω–µ—Ç hot shard (–µ—Å–ª–∏ hash —Ö–æ—Ä–æ—à –∏ –∫–ª—é—á —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω—ã–π).
    
- –ü—Ä–æ—Å—Ç–∞—è –ª–æ–≥–∏–∫–∞ –≥—Ä—É–±–æ–≥–æ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–∏—è ‚Äî –¥–æ–±–∞–≤–ª—è—Ç—å —à–∞—Ä–¥—ã –º–æ–∂–Ω–æ —á–µ—Ä–µ–∑ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–π hashing.
    

–ú–∏–Ω—É—Å—ã:

- –î–∏–∞–ø–∞–∑–æ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã:
    
    - `WHERE created_at BETWEEN ...`¬†‚Üí –¥–∞–Ω–Ω—ã–µ —Ä–∞–∑–º–∞–∑–∞–Ω—ã –ø–æ –≤—Å–µ–º —à–∞—Ä–¥–∞–º.
        
    - –ù—É–∂–Ω–æ –¥–µ—Ä–≥–∞—Ç—å –∫–∞–∂–¥—ã–π —à–∞—Ä–¥ ‚Üí fan-out –∑–∞–ø—Ä–æ—Å.
        
- –°–ª–æ–∂–Ω–µ–µ –¥–µ–ª–∞—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –∏ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏:
    
    - –ù—É–∂–Ω–∞ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–∞—è –∞–≥—Ä–µ–≥–∞—Ü–∏—è, merge –Ω–∞ –≤–µ—Ä—Ö–Ω–µ–º —É—Ä–æ–≤–Ω–µ.
        

---

**–ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å—Ö–µ–º—ã:**

- Hash –æ—Ç —á–∞—Å—Ç–∏ –∫–ª—é—á–∞ + range –ø–æ –≤—Ä–µ–º–µ–Ω–∏:
    
    - –ù–∞–ø—Ä–∏–º–µ—Ä, —à–∞—Ä–¥ –ø–æ¬†`hash(user_id) % K`, –∞ –≤–Ω—É—Ç—Ä–∏ ‚Äî range –ø–æ –¥–∞—Ç–µ.
        
- –®–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ¬†**bucket-–∫–ª—é—á—É**¬†(user_id_bucket), –≥–¥–µ bucket ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç hash/user_id, –Ω–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –µ—Å—Ç—å –ª–æ–≥–∏–∫–∞ time-based –ø–∞—Ä—Ç–∏—Ü–∏–π.
    

---

#### –í–æ–ø—Ä–æ—Å: –ü–æ—á–µ–º—É distributed transactions (2PC) —á–∞—Å—Ç–æ –∏–∑–±–µ–≥–∞—é—Ç?

**–û—Ç–≤–µ—Ç:**  
2PC –¥–æ–±–∞–≤–ª—è–µ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç—å, –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏, —É—Ö—É–¥—à–∞–µ—Ç availability –ø—Ä–∏ —Å–±–æ—è—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä–∞. –ß–∞—Å—Ç–æ –≤—ã–±–∏—Ä–∞—é—Ç —Å–∞–≥–∏, –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å, outbox/patterns.

**–¢–µ–æ—Ä–∏—è –∏ –ø–æ–Ω–∏–º–∞–Ω–∏–µ:**

**Two-Phase Commit (2PC):**

- –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä ‚Üí –Ω–µ—Å–∫–æ–ª—å–∫–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ (–ë–î/—Å–µ—Ä–≤–∏—Å—ã).
    
- –§–∞–∑–∞ 1 (prepare): –≤—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ —Ä–µ–∑–µ—Ä–≤–∏—Ä—É—é—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏ –≥–æ–≤–æ—Ä—è—Ç ‚Äú–≥–æ—Ç–æ–≤ / –Ω–µ –≥–æ—Ç–æ–≤‚Äù.
    
- –§–∞–∑–∞ 2 (commit/rollback): –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ—Ç–≤–µ—Ç–æ–≤ —Ä–µ—à–∞–µ—Ç, –∫–æ–º–º–∏—Ç–∏—Ç—å –∏–ª–∏ –æ—Ç–∫–∞—Ç—ã–≤–∞—Ç—å.
    

–ü–ª—é—Å—ã:

- –î–∞–µ—Ç –∏–ª–ª—é–∑–∏—é –æ–¥–Ω–æ–π –±–æ–ª—å—à–æ–π ACID-—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –º–µ–∂–¥—É –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Ä–µ—Å—É—Ä—Å–∞–º–∏.
    

–ú–∏–Ω—É—Å—ã:

- **–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä ‚Äî single point of failure**:
    
    - –ï—Å–ª–∏ –æ–Ω –ø–∞–¥–∞–µ—Ç –º–µ–∂–¥—É prepare –∏ commit, —É—á–∞—Å—Ç–Ω–∏–∫–∏ –º–æ–≥—É—Ç –∑–∞–≤–∏—Å–Ω—É—Ç—å –≤ –Ω–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ—Å—Ç–∏.
        
- –¢—Ä–µ–±—É—é—Ç—Å—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Ä–µ—Å—É—Ä—Å–æ–≤ –¥–æ –∫–æ–Ω—Ü–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:
    
    - –≠—Ç–æ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –≤—Ä–µ–º—è —É–¥–µ—Ä–∂–∞–Ω–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ ‚Üí –∫–æ–Ω—Ñ–ª–∏–∫—Ç, –¥–µ–¥–ª–æ–∫–∏, –ø–æ—Ç–µ—Ä–∏ throughput.
        
- –ü–ª–æ—Ö–æ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è –≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö —Å –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–æ–π.
    

–ü–æ—ç—Ç–æ–º—É –≤ –ø—Ä–æ–¥–µ —á–∞—â–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç¬†**—Å–∞–≥–∞-–ø–∞—Ç—Ç–µ—Ä–Ω**:

- –ù–∞–±–æ—Ä –ª–æ–∫–∞–ª—å–Ω—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π + –∫–æ–º–ø–µ–Ω—Å–∏—Ä—É—é—â–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏.
    
- –í–º–µ—Å—Ç–æ –æ–¥–Ω–æ–π –≥–ª–æ–±–∞–ª—å–Ω–æ–π ACID-—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ ‚Äî –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —à–∞–≥–æ–≤:
    
    - –£—Å–ø–µ—Ö ‚Üí –∏–¥—ë–º –¥–∞–ª—å—à–µ.
        
    - –ù–µ—É—Å–ø–µ—Ö ‚Üí –æ—Ç–∫–∞—Ç—ã–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —à–∞–≥–∏ –∫–æ–º–ø–µ–Ω—Å–∏—Ä—É—é—â–∏–º–∏ –¥–µ–π—Å—Ç–≤–∏—è–º–∏.
        

–ò –µ—â—ë:

- **Outbox pattern**: –∑–∞–ø–∏—Å—å —Å–æ–±—ã—Ç–∏–π –≤ –ª–æ–∫–∞–ª—å–Ω—É—é —Ç–∞–±–ª–∏—Ü—É –∏ –∏—Ö –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞.
    
- **–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å**¬†–º–µ—Ç–æ–¥–æ–≤: –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –≤—ã–∑–æ–≤ –Ω–µ –ª–æ–º–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ.
    

---

### OLTP vs OLAP –∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞

#### –í–æ–ø—Ä–æ—Å: –ü–æ—á–µ–º—É column-store –≤—ã–∏–≥—Ä—ã–≤–∞–µ—Ç –≤ –∞–Ω–∞–ª–∏—Ç–∏–∫–µ?

**–û—Ç–≤–µ—Ç:**  
–ß–∏—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω—É–∂–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏, –ª—É—á—à–µ —Å–∂–∏–º–∞–µ—Ç, –≤–µ–∫—Ç–æ—Ä–∏–∑—É–µ—Ç –≤—ã—á–∏—Å–ª–µ–Ω–∏—è (SIMD), —É—Å–∫–æ—Ä—è–µ—Ç –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ –Ω–∞ –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö.

**–¢–µ–æ—Ä–∏—è –∏ –ø–æ–Ω–∏–º–∞–Ω–∏–µ:**

**Row-store (—Å—Ç—Ä–æ—á–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ):**

- –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —Ñ–æ—Ä–º–∞—Ç (PostgreSQL, MySQL).
    
- –°—Ç—Ä–æ–∫–∞ —Ö—Ä–∞–Ω–∏—Ç—Å—è —Ü–µ–ª–∏–∫–æ–º:¬†`[id, user_id, product_id, price, status, created_at, ...]`.
    
- –ü—Ä–∏ —á—Ç–µ–Ω–∏–∏¬†`SELECT SUM(price) FROM orders`:
    
    - –°—á–∏—Ç—ã–≤–∞—é—Ç—Å—è¬†**–≤—Å–µ –ø–æ–ª—è –≤—Å–µ—Ö —Å—Ç—Ä–æ–∫**, –¥–∞–∂–µ –µ—Å–ª–∏ –Ω—É–∂–µ–Ω —Ç–æ–ª—å–∫–æ¬†`price`.
        
    - –î–∏—Å–∫–æ–≤—ã–π I/O –æ—á–µ–Ω—å –±–æ–ª—å—à–æ–π.
        

**Column-store (–∫–æ–ª–æ–Ω–æ—á–Ω–æ–µ):**

- –î–∞–Ω–Ω—ã–µ –ø–æ –∫–∞–∂–¥–æ–π –∫–æ–ª–æ–Ω–∫–µ –ª–µ–∂–∞—Ç –æ—Ç–¥–µ–ª—å–Ω–æ:
    
    - –§–∞–π–ª¬†`price`:¬†`[10, 20, 30, 40, ...]`
        
    - –§–∞–π–ª¬†`user_id`:¬†`[1, 2, 3, 4, ...]`
        
- –ü—Ä–∏¬†`SELECT SUM(price)`:
    
    - –ß–∏—Ç–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–æ–ª–æ–Ω–∫–∞¬†`price`.
        
    - –ù–∞–º–Ω–æ–≥–æ –º–µ–Ω—å—à–µ –¥–∞–Ω–Ω—ã—Ö —Å –¥–∏—Å–∫–∞.
        

–ü–ª—é—Å—ã column-store:

1. **–ú–µ–Ω—å—à–µ I/O**:
    
    - –î–ª—è –∑–∞–ø—Ä–æ—Å–∞, –∏—Å–ø–æ–ª—å–∑—É—é—â–µ–≥–æ 3 –∫–æ–ª–æ–Ω–∫–∏ –∏–∑ 50 ‚Äî —á–∏—Ç–∞—é—Ç—Å—è 3, –∞ –Ω–µ 50.
        
2. **–°–∂–∞—Ç–∏–µ**:
    
    - –í –∫–æ–ª–æ–Ω–∫–µ –ø–æ–¥—Ä—è–¥ —á–∞—Å—Ç–æ –æ–¥–Ω–æ—Ç–∏–ø–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è ‚Üí –æ—Ç–ª–∏—á–Ω–∞—è –∫–æ–º–ø—Ä–µ—Å—Å–∏—è (RLE, dictionary, etc.).
        
3. **SIMD –∏ –≤–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—è**:
    
    - –û–ø–µ—Ä–∞—Ü–∏–∏ –ø–æ –∫–æ–ª–æ–Ω–∫–µ (`SUM`,¬†`AVG`,¬†`COUNT`) –æ—á–µ–Ω—å —Ö–æ—Ä–æ—à–æ –ª–æ–∂–∞—Ç—Å—è –Ω–∞ CPU-–≤–µ–∫—Ç–æ—Ä–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏.
        
4. **–ë—ã—Å—Ç—Ä—ã–π scan + –∞–≥—Ä–µ–≥–∞—Ç—ã**:
    
    - –¢–∏–ø–∏—á–Ω—ã–π OLAP-–∑–∞–ø—Ä–æ—Å:¬†`GROUP BY`, –∞–≥—Ä–µ–≥–∞—Ç—ã –Ω–∞ 100M+ —Å—Ç—Ä–æ–∫ ‚Üí –∫–∞–∫ —Ä–∞–∑ —Å–∏–ª—å–Ω–∞—è —Å—Ç–æ—Ä–æ–Ω–∞ column-store.
        

–ú–∏–Ω—É—Å—ã:

- –ù–µ—É–¥–æ–±–µ–Ω –¥–ª—è OLTP (–º–Ω–æ–≥–æ insert/update –ø–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º —Å—Ç—Ä–æ–∫–∞–º).
    
- –í—Å—Ç–∞–≤–∫–∞ —Å—Ç—Ä–æ–∫ —á–∞—Å—Ç–æ –±—É—Ñ–µ—Ä–∏–∑—É–µ—Ç—Å—è –≤ row-—Ñ–æ—Ä–º–∞—Ç–µ, –∑–∞—Ç–µ–º –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –∫–æ–º–ø–∞–∫—Ç–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç—Å—è –≤ –∫–æ–ª–æ–Ω–∫–∞—Ö.
    

–ü–æ—ç—Ç–æ–º—É:

- OLTP: row-store (PostgreSQL, MySQL).
    
- OLAP: column-store (ClickHouse, Snowflake, BigQuery, Redshift).
    

---

#### –í–æ–ø—Ä–æ—Å: –ß—Ç–æ —Ç–∞–∫–æ–µ data lake vs data warehouse —Å –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–π —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è?

**–û—Ç–≤–µ—Ç:**  
Lake ‚Äî –¥–µ—à—ë–≤–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ ‚Äú—Å—ã—Ä—å—è‚Äù (—á–∞—Å—Ç–æ object storage), schema-on-read. Warehouse ‚Äî –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –ø–æ–¥ –∑–∞–ø—Ä–æ—Å—ã/SLAs, schema-on-write, –∏–Ω–¥–µ–∫—Å—ã/–º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏.

**–¢–µ–æ—Ä–∏—è –∏ –ø–æ–Ω–∏–º–∞–Ω–∏–µ:**

**Data Lake:**

- –•—Ä–∞–Ω–∏–ª–∏—â–µ ¬´—Å—ã—Ä—ã—Ö¬ª –¥–∞–Ω–Ω—ã—Ö –≤ –∏—Å—Ö–æ–¥–Ω–æ–º –≤–∏–¥–µ:
    
    - –õ–æ–≥–∏, JSON, CSV, –ø–∞—Ä–∫–µ—Ç, –∞—É–¥–∏–æ, –≤–∏–¥–µ–æ.
        
- –ß–∞—Å—Ç–æ ‚Äî¬†**–æ–±—ä–µ–∫—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ**¬†(S3, HDFS, MinIO).
    
- **Schema-on-read**:
    
    - –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö ¬´–Ω–∞–≤–µ—à–∏–≤–∞–µ—Ç—Å—è¬ª –≤ –º–æ–º–µ–Ω—Ç —á—Ç–µ–Ω–∏—è (Spark, Presto, Trino).
        
- –î—ë—à–µ–≤–æ, –≥–∏–±–∫–æ, –º–æ–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –≤—Å—ë –ø–æ–¥—Ä—è–¥.
    
- –ú–∏–Ω—É—Å—ã:
    
    - –ë–µ–∑ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã –ª–µ–≥–∫–æ –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å –≤ ‚Äúdata swamp‚Äù (–±–æ–ª–æ—Ç–æ).
        
    - –ù–µ—Ç —Å—Ç—Ä–æ–≥–∏—Ö –≥–∞—Ä–∞–Ω—Ç–∏–π –∫–∞—á–µ—Å—Ç–≤–∞, –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏, —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç–∏ —Å—Ö–µ–º.
        

**Data Warehouse:**

- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏:
    
    - –°—Ç—Ä–æ–≥–∞—è —Å—Ö–µ–º–∞ (–∑–≤–µ–∑–¥–∞/—Å–Ω–µ–∂–∏–Ω–∫–∞: fact + dimension).
        
    - –ü—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–æ –¥–ª—è BI, –æ—Ç—á—ë—Ç–Ω–æ—Å—Ç–∏, SLA –ø–æ –∑–∞–ø—Ä–æ—Å–∞–º.
        
- **Schema-on-write**:
    
    - –ù—É–∂–µ–Ω ETL/ELT pipeline ‚Äî –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏–≤–æ–¥—è—Ç—Å—è –∫ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–π —Å—Ö–µ–º–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ.
        
- –°–ª–æ–∂–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã, –ø–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ, –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è.
    
- –ü—Ä–∏–º–µ—Ä—ã: Snowflake, BigQuery, Redshift, ClickHouse (–≤ —Ä–æ–ª–∏ DWH).
    

–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏:

- Lake ‚Äî –º–µ—Å—Ç–æ, –∫—É–¥–∞ –≤—Å—ë –ø–∞–¥–∞–µ—Ç –∏–∑ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ (raw zone).
    
- Warehouse ‚Äî curated —Å–ª–æ–π, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º —Å–∏–¥—è—Ç –∞–Ω–∞–ª–∏—Ç–∏–∫–∏, BI, –æ—Ç—á—ë—Ç—ã.
    

---

## –í–µ–∫—Ç–æ—Ä–Ω—ã–µ –ë–î

### –ë–∞–∑–æ–≤—ã–µ –ø–æ–Ω—è—Ç–∏—è

#### –í–æ–ø—Ä–æ—Å: –ß—Ç–æ —Ç–∞–∫–æ–µ embedding –∏ –ø–æ—á–µ–º—É ‚Äú—Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å‚Äù –≤–∞–∂–Ω–∞?

**–û—Ç–≤–µ—Ç:**  
Embedding ‚Äî –≤–µ–∫—Ç–æ—Ä –ø—Ä–∏–∑–Ω–∞–∫–æ–≤. –†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å –≤–ª–∏—è–µ—Ç –Ω–∞ –ø–∞–º—è—Ç—å, —Å–∫–æ—Ä–æ—Å—Ç—å, –∫–∞—á–µ—Å—Ç–≤–æ. –°–ª–∏—à–∫–æ–º –º–∞–ª–µ–Ω—å–∫–∞—è ‚Äî —Ç–µ—Ä—è–µ–º —Å–µ–º–∞–Ω—Ç–∏–∫—É, —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–∞—è ‚Äî –¥–æ—Ä–æ–∂–µ ANN –∏ –≤—ã—à–µ —Ä–∏—Å–∫ ‚Äúcurse of dimensionality‚Äù.

**–¢–µ–æ—Ä–∏—è –∏ –ø–æ–Ω–∏–º–∞–Ω–∏–µ:**

- Embedding ‚Äî —ç—Ç–æ¬†**–ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞**¬†(—Ç–µ–∫—Å—Ç–∞, –∫–∞—Ä—Ç–∏–Ω–∫–∏, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è) –∫–∞–∫ –≤–µ–∫—Ç–æ—Ä–∞ –≤–µ—â–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —á–∏—Å–µ–ª:  
    `x ‚àà R^d`, –≥–¥–µ d ‚Äî —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å.
    
- –ù–æ—Ä–º–∞–ª—å–Ω–æ –≤–∏–¥–µ—Ç—å —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–∏ 128, 256, 768, 1024, 2048.
    

–ö–æ–º–ø—Ä–æ–º–∏—Å—Å—ã:

- –ú–∞–ª–∞—è —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, 64‚Äì128):
    
    - - –î–µ—à–µ–≤–ª–µ —Ö—Ä–∞–Ω–∏—Ç—å (`N*d`¬†float‚Äô–æ–≤).
            
    - - –ë—ã—Å—Ç—Ä–µ–µ —Å—á–∏—Ç–∞—Ç—å —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è.
            
    - ‚àí –ú–µ–Ω—å—à–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ ‚Üí —Ö—É–∂–µ –∫–∞—á–µ—Å—Ç–≤–æ –ø–æ–∏—Å–∫–∞/—Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏—è.
        
- –ë–æ–ª—å—à–∞—è —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, 1024‚Äì4096):
    
    - - –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –ª—É—á—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ.
            
    - ‚àí –ë–æ–ª—å—à–µ –ø–∞–º—è—Ç–∏.
        
    - ‚àí –î–æ—Ä–æ–∂–µ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è –∏ –ø–æ–∏—Å–∫.
        
    - ‚àí –≠—Ñ—Ñ–µ–∫—Ç—ã ¬´curse of dimensionality¬ª (—Ç–æ—á–Ω–æ–µ kNN —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ø–æ—á—Ç–∏ –±–µ—Å—Å–º—ã—Å–ª–µ–Ω–Ω—ã–º).
        

–ü–æ—ç—Ç–æ–º—É –ø—Ä–∞–∫—Ç–∏—á–Ω–æ:

- –ü–æ–¥–±–∏—Ä–∞—Ç—å —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å, –∏—Å—Ö–æ–¥—è –∏–∑ –º–æ–¥–µ–ª–∏ –∏ –∑–∞–¥–∞—á.
    
- –í –ø—Ä–æ–¥–µ —á–∞—â–µ 256‚Äì1024.
    

---

#### –í–æ–ø—Ä–æ—Å: –ö–æ—Å–∏–Ω—É—Å–Ω–∞—è –±–ª–∏–∑–æ—Å—Ç—å vs L2 ‚Äî –∫–æ–≥–¥–∞ —á—Ç–æ?

**–û—Ç–≤–µ—Ç:**  
–ö–æ—Å–∏–Ω—É—Å ‚Äî —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π (—á–∞—Å—Ç–æ –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤, –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö). L2 ‚Äî –≥–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ, —á–∞—Å—Ç–æ –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö CV/–º–µ—Ç—Ä–∏–∫. –í–∞–∂–Ω–æ —Å–æ–≥–ª–∞—Å–æ–≤–∞—Ç—å —Å –º–æ–¥–µ–ª—å—é –∏ –Ω–æ—Ä–º–∏—Ä–æ–≤–∫–æ–π.

**–¢–µ–æ—Ä–∏—è –∏ –ø–æ–Ω–∏–º–∞–Ω–∏–µ:**

- **L2 (–µ–≤–∫–ª–∏–¥–æ–≤–æ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ)**:
    
    - `‚Äñx - y‚Äñ‚ÇÇ`
        
    - –ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω –∫ –º–∞—Å—à—Ç–∞–±—É.
        
- **Cosine similarity**:
    
    - `cos(x, y) = (x¬∑y) / (‚Äñx‚Äñ‚Äñy‚Äñ)`
        
    - –°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç¬†**—É–≥–æ–ª**¬†–º–µ–∂–¥—É –≤–µ–∫—Ç–æ—Ä–∞–º–∏ (–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ), –∞ –Ω–µ –¥–ª–∏–Ω—É.
        

–ï—Å–ª–∏ embeddings¬†**–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω—ã**¬†(‚Äñx‚Äñ=1):

- L2 –∏ cosine —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω—ã —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é –¥–æ –º–æ–Ω–æ—Ç–æ–Ω–Ω–æ–≥–æ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è.
    
- –ü–æ—ç—Ç–æ–º—É –º–Ω–æ–≥–∏–µ –≤–µ–∫—Ç–æ—Ä–Ω—ã–µ –ë–î –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç –æ–±–∞, –Ω–æ –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º –ø—Ä–∏–≤–æ–¥—è—Ç –∫ –æ–¥–Ω–æ–º—É.
    

–ü—Ä–∞–∫—Ç–∏–∫–∞:

- –¢–µ–∫—Å—Ç–æ–≤—ã–µ –º–æ–¥–µ–ª–∏ (BERT-like, CLIP —Ç–µ–∫—Å—Ç–æ–≤–∞—è —á–∞—Å—Ç—å):
    
    - –û–±—ã—á–Ω–æ cosine.
        
- –ù–µ–∫–æ—Ç–æ—Ä—ã–µ CV –∏–ª–∏ —Ç–∞–±–ª–∏—á–Ω—ã–µ –∑–∞–¥–∞—á–∏:
    
    - L2 –∏–ª–∏ –¥–∞–∂–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ.
        

–ì–ª–∞–≤–Ω–æ–µ: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç—É –º–µ—Ç—Ä–∏–∫—É, –Ω–∞ –∫–æ—Ç–æ—Ä—É—é –æ–±—É—á–∞–ª–∞—Å—å –º–æ–¥–µ–ª—å (—Å–º–æ—Ç—Ä–∏–º –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é).

---

#### –í–æ–ø—Ä–æ—Å: –ü–æ—á–µ–º—É exact kNN –ø–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞ –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –≤ –ø—Ä–æ–¥–µ?

**–û—Ç–≤–µ—Ç:**  
O(N¬∑d) –ø–æ –≤—Å–µ–º –≤–µ–∫—Ç–æ—Ä–∞–º, –ø–ª–æ—Ö–∞—è –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å –∏ latency. ANN –¥–∞—ë—Ç –∫–æ–Ω—Ç—Ä–æ–ª—å —Å–∫–æ—Ä–æ—Å—Ç–∏/recall.

**–¢–µ–æ—Ä–∏—è –∏ –ø–æ–Ω–∏–º–∞–Ω–∏–µ:**

Exact kNN:

- –î–ª—è –∑–∞–ø—Ä–æ—Å–∞ q –ø–µ—Ä–µ–±–∏—Ä–∞—é—Ç—Å—è¬†**–≤—Å–µ**¬†N –≤–µ–∫—Ç–æ—Ä–æ–≤, —Å—á–∏—Ç–∞–µ—Ç—Å—è —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ (–∏–ª–∏ similarity), –≤—ã–±–∏—Ä–∞—é—Ç—Å—è top-k.
    
- –°–ª–æ–∂–Ω–æ—Å—Ç—å:¬†`O(N¬∑d)`¬†–æ–ø–µ—Ä–∞—Ü–∏–π.
    
- –î–ª—è N=10‚Å∂, d=768:
    
    - 10‚Å∂ * 768 ‚âà 7.6e8 –æ–ø–µ—Ä–∞—Ü–∏–π –Ω–∞ –∑–∞–ø—Ä–æ—Å ‚Üí –¥–æ—Ä–æ–≥–æ –ø—Ä–∏ –æ–Ω–ª–∞–π–Ω-—Ä–µ–∂–∏–º–µ.
        

ANN (Approximate Nearest Neighbors):

- –°—Ç—Ä–æ—è—Ç—Å—è –∏–Ω–¥–µ–∫—Å—ã (HNSW, IVF, PQ –∏ —Ç.–¥).
    
- –í—Ä–µ–º—è –ø–æ–∏—Å–∫–∞¬†`O(log N)`¬†–∏–ª–∏¬†`O(N^Œ±)`¬†—Å Œ±<1 –∏ –º–∞–ª—ã–º –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–º.
    
- –í–∑–∞–º–µ–Ω –ø–æ–ª—É—á–∞–µ–º¬†**–Ω–µ 100% —Ç–æ—á–Ω–æ—Å—Ç—å**, –∞¬†`recall < 1`¬†(–Ω–∞–ø—Ä–∏–º–µ—Ä, 0.95‚Äì0.99).
    

–í –ø—Ä–æ–¥–µ:

- –ü–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞ –Ω—É–∂–µ–Ω –ª–∞—Ç–µ–Ω—Ç—Å–∏ p95 < 100ms –∏ —Å–∫–µ–π–ª –¥–æ ‚â•10‚Å∂‚Äì10‚Åπ –≤–µ–∫—Ç–æ—Ä–æ–≤.
    
- Exact kNN —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ–ø—Ä–∞–∫—Ç–∏—á–Ω—ã–º.
    
- ANN –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ç—Ä–æ–≥–∞—Ç—å¬†`efSearch`,¬†`nprobe`¬†–∏ –¥—Ä., –±–∞–ª–∞–Ω—Å–∏—Ä—É—è –≤—Ä–µ–º—è vs –∫–∞—á–µ—Å—Ç–≤–æ.
    

---

### –ò–Ω–¥–µ–∫—Å—ã ANN

#### –í–æ–ø—Ä–æ—Å: HNSW ‚Äî –∫—Ä–∞—Ç–∫–æ: –∫–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω –∏ —á–µ–º —Ö–æ—Ä–æ—à?

**–û—Ç–≤–µ—Ç:**  
–ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π –≥—Ä–∞—Ñ ‚Äú–º–∞–ª–æ–≥–æ –º–∏—Ä–∞‚Äù: —Å–≤–µ—Ä—Ö—É —Ä–∞–∑—Ä–µ–∂–µ–Ω–Ω–æ, —Å–Ω–∏–∑—É –ø–ª–æ—Ç–Ω–æ. –ü–æ–∏—Å–∫ ‚Äî –∂–∞–¥–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è —Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑. –û—Ç–ª–∏—á–Ω—ã–π –±–∞–ª–∞–Ω—Å recall/latency, –Ω–æ –ø–∞–º—è—Ç—å –∏ –≤—Ä–µ–º—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –∑–∞–º–µ—Ç–Ω—ã–µ.

**–¢–µ–æ—Ä–∏—è –∏ –ø–æ–Ω–∏–º–∞–Ω–∏–µ:**

–ò–¥–µ—è:

- –°—Ç—Ä–æ–∏—Ç—Å—è –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏–π –≥—Ä–∞—Ñ:
    
    - –í–µ—Ä—Ö–Ω–∏–µ —É—Ä–æ–≤–Ω–∏: –º–∞–ª–æ —Ç–æ—á–µ–∫, –≥—Ä—É–±–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è.
        
    - –ù–∏–∂–Ω–∏–µ —É—Ä–æ–≤–Ω–∏: –º–Ω–æ–≥–æ —Ç–æ—á–µ–∫, —Ç–æ—á–Ω—ã–π –ª–æ–∫–∞–ª—å–Ω—ã–π –ø–æ–∏—Å–∫.
        

–ü–æ–∏—Å–∫:

1. –°—Ç–∞—Ä—Ç —Å –≤–µ—Ä—Ö–Ω–µ–≥–æ —É—Ä–æ–≤–Ω—è, —Å —Ä–∞–Ω–¥–æ–º–Ω–æ–≥–æ entry-point.
    
2. –ñ–∞–¥–Ω–æ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –±–ª–∏–∂–∞–π—à–µ–º—É —Å–æ—Å–µ–¥–∞, –ø–æ–∫–∞ –Ω–µ –Ω–∞–π–¥—ë–º –ª–æ–∫–∞–ª—å–Ω–æ –ª—É—á—à–∏–π.
    
3. –°–ø—É—Å–∫–∞–µ–º—Å—è —É—Ä–æ–≤–Ω–µ–º –Ω–∏–∂–µ, –ø–æ–≤—Ç–æ—Ä—è–µ–º, –ø–æ–∫–∞ –Ω–µ –æ–∫–∞–∂–µ–º—Å—è –Ω–∞ –±–∞–∑–æ–≤–æ–º —É—Ä–æ–≤–Ω–µ.
    
4. –ù–∞ –±–∞–∑–æ–≤–æ–º —É—Ä–æ–≤–Ω–µ —Ä–∞—Å—à–∏—Ä—è–µ–º –ø–æ–∏—Å–∫ (–ø–∞—Ä–∞–º–µ—Ç—Ä¬†`efSearch`).
    

–ü–ª—é—Å—ã:

- –í—ã—Å–æ–∫–∏–π recall –ø—Ä–∏ –Ω–∏–∑–∫–æ–º latency.
    
- –•–æ—Ä–æ—à–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏—Ö –Ω–∞–≥—Ä—É–∑–∫–∞—Ö (insert –≤ –æ–Ω–ª–∞–π–Ω–µ –≤–æ–∑–º–æ–∂–µ–Ω, –Ω–æ –Ω–µ –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π).
    
- –®–∏—Ä–æ–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è (FAISS, nmslib, Qdrant, Milvus).


–ú–∏–Ω—É—Å—ã:

- –ü–∞–º—è—Ç—å: —Ö—Ä–∞–Ω–∏—Ç—Å—è –º–Ω–æ–≥–æ —Ä–µ–±–µ—Ä/—Å–æ—Å–µ–¥–µ–π.
    
- –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–æ–ª–≥–∏–º –ø—Ä–∏ N¬ª (–Ω—É–∂–Ω–æ —Ç—é–Ω–∏—Ç—å¬†`M`,¬†`efConstruction`).


---

#### –í–æ–ø—Ä–æ—Å: –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã HNSW –∏ –∏—Ö —ç—Ñ—Ñ–µ–∫—Ç?

**–û—Ç–≤–µ—Ç:**  
M (—á–∏—Å–ª–æ —Ä–µ–±–µ—Ä) ‚Üë ‚Üí –ª—É—á—à–µ recall, –±–æ–ª—å—à–µ –ø–∞–º—è—Ç—å. efConstruction ‚Üë ‚Üí –ª—É—á—à–µ –∏–Ω–¥–µ–∫—Å, –¥–æ–ª—å—à–µ –±–∏–ª–¥. efSearch ‚Üë ‚Üí –ª—É—á—à–µ recall, –≤—ã—à–µ latency.

**–¢–µ–æ—Ä–∏—è –∏ –ø–æ–Ω–∏–º–∞–Ω–∏–µ:**

- **M**:
    
    - –°–∫–æ–ª—å–∫–æ –∏—Å—Ö–æ–¥—è—â–∏—Ö —Ä–µ–±–µ—Ä (neighbors) —É —É–∑–ª–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ.
        
    - –ë–æ–ª—å—à–æ–µ M:
        
        - - –õ—É—á—à–µ –ø–æ–∫—Ä—ã—Ç–∏–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ ‚Üí –≤—ã—à–µ recall.
                
        - ‚àí –ë–æ–ª—å—à–µ –ø–∞–º—è—Ç—å.
            
- **efConstruction**:
    
    - –ù–∞—Å–∫–æ–ª—å–∫–æ "—à–∏—Ä–æ–∫–æ" –∏—â–µ–º –±–ª–∏–∂–∞–π—à–∏—Ö —Å–æ—Å–µ–¥–µ–π –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –∏–Ω–¥–µ–∫—Å–∞.
        
    - ‚Üë ‚Üí –±–æ–ª–µ–µ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–≤—è–∑–∏ ‚Üí –ª—É—á—à–µ recall –ø—Ä–∏ –ø–æ–∏—Å–∫–µ.
        
    - ‚àí –í—Ä–µ–º—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è —Ä–∞—Å—Ç—ë—Ç.
        
- **efSearch**:
    
    - –°–∫–æ–ª—å–∫–æ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –¥–µ—Ä–∂–∏–º –≤ –ø—Ä–∏–æ—Ä–∏—Ç–∏-–∫—å—é –≤–æ –≤—Ä–µ–º—è –ø–æ–∏—Å–∫–∞.
        
    - ‚Üë ‚Üí –±–æ–ª—å—à–µ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è ‚Üí –≤—ã—à–µ recall.
        
    - ‚àí Latency –ø–æ–∏—Å–∫–∞ —Ä–∞—Å—Ç–µ—Ç.
        

–ü—Ä–∞–∫—Ç–∏–∫–∞:

- –ù–∞—á–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:¬†`M=16`,¬†`efConstruction=100‚Äì200`,¬†`efSearch=50‚Äì200`.
    
- –ü–æ—Ç–æ–º —Ç—é–Ω–∏–Ω–≥ –ø–æ–¥ –Ω—É–∂–Ω—ã–π recall/latency.
    

---

#### –í–æ–ø—Ä–æ—Å: IVF ‚Äî –≤ —á—ë–º –∏–¥–µ—è –∏ –≥–ª–∞–≤–Ω—ã–π —Ç—é–Ω–∏–Ω–≥-–ø–∞—Ä–∞–º–µ—Ç—Ä?

**–û—Ç–≤–µ—Ç:**  
–ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –Ω–∞ nlist —Ü–µ–Ω—Ç—Ä–æ–∏–¥–æ–≤; –∏—â–µ–º —Ç–æ–ª—å–∫–æ –≤ nprobe –±–ª–∏–∂–∞–π—à–∏—Ö –∫–ª–∞—Å—Ç–µ—Ä–∞—Ö. nprobe ‚Üë ‚Üí –≤—ã—à–µ recall, –≤—ã—à–µ latency.

**–¢–µ–æ—Ä–∏—è –∏ –ø–æ–Ω–∏–º–∞–Ω–∏–µ:**

IVF (Inverted File):

- –í–µ–∫—Ç–æ—Ä—ã —Ä–∞–∑–¥–µ–ª—è—é—Ç—Å—è –Ω–∞¬†**–∫–ª–∞—Å—Ç–µ—Ä—ã**¬†(centroids), –æ–±—ã—á–Ω–æ k-means.
    
- –î–ª—è –∑–∞–ø—Ä–æ—Å–∞:
    
    1. –ù–∞—Ö–æ–¥–∏–º –±–ª–∏–∂–∞–π—à–∏–µ –∫–ª–∞—Å—Ç–µ—Ä—ã (–ø–æ —Ü–µ–Ω—Ç—Ä–æ–∏–¥–∞–º).
        
    2. –ò—â–µ–º –±–ª–∏–∂–∞–π—à–∏—Ö —Å–æ—Å–µ–¥–µ–π¬†**—Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ —ç—Ç–∏—Ö –∫–ª–∞—Å—Ç–µ—Ä–æ–≤**.
        

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:

- `nlist`¬†‚Äî —Å–∫–æ–ª—å–∫–æ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ (—Ä–∞–∑–¥–µ–ª–æ–≤):
    
    - –ú–∞–ª–æ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ ‚Üí –∫–∞–∂–¥—ã–π –±–æ–ª—å—à–æ–π ‚Üí —Å–∏–ª—å–Ω–∞—è —ç–∫–æ–Ω–æ–º–∏—è –Ω–µ –¥–æ—Å—Ç–∏–≥–∞–µ—Ç—Å—è.
        
    - –°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ ‚Üí —Ü–µ–Ω—Ç—Ä–æ–∏–¥—ã —à—É–º–Ω—ã–µ, overhead.
        
- `nprobe`¬†‚Äî —Å–∫–æ–ª—å–∫–æ –∫–ª–∞—Å—Ç–µ—Ä–æ–≤ –æ–ø—Ä–∞—à–∏–≤–∞—Ç—å –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞:
    
    - –ú–∞–ª—ã–π nprobe ‚Üí –∏—â–µ–º –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–ª–∞—Å—Ç–µ—Ä–∞—Ö ‚Üí –±—ã—Å—Ç—Ä–æ, –Ω–æ –Ω–∏–∂–µ recall.
        
    - –ë–æ–ª—å—à–æ–π nprobe ‚Üí –ø–æ–∫—Ä—ã–≤–∞–µ–º –ø–æ—á—Ç–∏ –≤—Å–µ ‚Üí –≤—ã—à–µ recall, –≤—ã—à–µ latency.
        

–í—ã–±–æ—Ä:

- –ù–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ¬†`nlist`¬†—á–∞—Å—Ç–æ 256‚Äì4096,¬†`nprobe`¬†4‚Äì64.
    
- –ü–æ–¥–±–∏—Ä–∞–µ—Ç—Å—è —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω–æ –ø–æ trade-off‚Äô–∞–º.
    

---

#### –í–æ–ø—Ä–æ—Å: Product Quantization (PQ) ‚Äî –∑–∞—á–µ–º –∏ –∫–∞–∫–æ–π –∫–æ–º–ø—Ä–æ–º–∏—Å—Å?

**–û—Ç–≤–µ—Ç:**  
–°–∂–∏–º–∞–µ—Ç –≤–µ–∫—Ç–æ—Ä—ã –≤ –∫–æ–¥—ã, —É—Å–∫–æ—Ä—è–µ—Ç distance computations –∏ —ç–∫–æ–Ω–æ–º–∏—Ç RAM/SSD. –ö–æ–º–ø—Ä–æ–º–∏—Å—Å ‚Äî –∞–ø–ø—Ä–æ–∫—Å–∏–º–∞—Ü–∏—è —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–π (–ø–æ—Ç–µ—Ä—è –∫–∞—á–µ—Å—Ç–≤–∞), –Ω—É–∂–µ–Ω —Ç—Ä–µ–π–Ω–∏–Ω–≥ –∫–æ–¥–±—É–∫–æ–≤.

**–¢–µ–æ—Ä–∏—è –∏ –ø–æ–Ω–∏–º–∞–Ω–∏–µ:**

–ò–¥–µ—è PQ:

- –í–µ–∫—Ç–æ—Ä —Ä–∞–∑–º–µ—Ä–Ω–æ—Å—Ç–∏ d —Ä–∞–∑–±–∏–≤–∞–µ—Ç—Å—è –Ω–∞ m –ø–æ–¥-–≤–µ–∫—Ç–æ—Ä–æ–≤.
    
- –î–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–¥-–≤–µ–∫—Ç–æ—Ä–∞ —Å—Ç—Ä–æ–∏—Ç—Å—è —Å–ª–æ–≤–∞—Ä—å —Ü–µ–Ω—Ç—Ä–æ–∏–¥–æ–≤ (codebook).
    
- –í–º–µ—Å—Ç–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–æ–ª–Ω–æ–≥–æ float-–≤–µ–∫—Ç–æ—Ä–∞ —Ö—Ä–∞–Ω–∏–º¬†**–∏–Ω–¥–µ–∫—Å—ã**¬†—Ü–µ–Ω—Ç—Ä–æ–∏–¥–æ–≤:
    
    - `x ‚âà [c1[i1], c2[i2], ..., cm[im]]`.
        
- –ü–∞–º—è—Ç—å:
    
    - –ë—ã–ª–æ:¬†`d * 4`¬†–±–∞–π—Ç–∞ (float32).
        
    - –°—Ç–∞–ª–æ:¬†`m * 1`¬†–±–∞–π—Ç (–µ—Å–ª–∏ codebook 256-—ç–ª–µ–º–µ–Ω—Ç–Ω—ã–π).
        

–ü–ª—é—Å—ã:

- –ö–æ–ª–æ—Å—Å–∞–ª—å–Ω–∞—è —ç–∫–æ–Ω–æ–º–∏—è –ø–∞–º—è—Ç–∏: –º–æ–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å 10‚Å∏ –≤–µ–∫—Ç–æ—Ä–æ–≤ –≤ RAM.
    
- –ë—ã—Å—Ç—Ä–æ–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–π –ø–æ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–º —Ç–∞–±–ª–∏—Ü–∞–º.
    

–ú–∏–Ω—É—Å—ã:

- –ê–ø–ø—Ä–æ–∫—Å–∏–º–∞—Ü–∏—è —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–π ‚Üí —á—É—Ç—å —Ö—É–∂–µ –∫–∞—á–µ—Å—Ç–≤–æ (recall).
    
- –ù—É–∂–Ω–æ –æ–±—É—á–∞—Ç—å codebook (offline, –Ω–∞ –ø–æ–¥–≤—ã–±–æ—Ä–∫–µ –≤–µ–∫—Ç–æ—Ä–æ–≤).
    

–í –ø—Ä–æ–¥–µ:

- –ß–∞—Å—Ç–æ –∫–æ–º–±–∏–Ω–∏—Ä—É—é—Ç —Å IVF (IVF+PQ), —á—Ç–æ–±—ã —Å–Ω–∞—á–∞–ª–∞ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤, –ø–æ—Ç–æ–º –±—ã—Å—Ç—Ä–æ —Å—á–∏—Ç–∞—Ç—å —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –ø–æ PQ-–∫–æ–¥–∞–º.
    

---

#### –í–æ–ø—Ä–æ—Å: –ü–æ—á–µ–º—É IVF+PQ –ø–æ–ø—É–ª—è—Ä–Ω–µ–µ ‚Äú—á–∏—Å—Ç–æ–≥–æ PQ‚Äù?

**–û—Ç–≤–µ—Ç:**  
IVF —É–º–µ–Ω—å—à–∞–µ—Ç –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤, PQ —É–¥–µ—à–µ–≤–ª—è–µ—Ç —Å—Ä–∞–≤–Ω–µ–Ω–∏—è –≤–Ω—É—Ç—Ä–∏ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤. –í–º–µ—Å—Ç–µ –¥–∞—é—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –¥–µ—Å—è—Ç–∫–∏/—Å–æ—Ç–Ω–∏ –º–∏–ª–ª–∏–æ–Ω–æ–≤ –≤–µ–∫—Ç–æ—Ä–æ–≤.

**–¢–µ–æ—Ä–∏—è –∏ –ø–æ–Ω–∏–º–∞–Ω–∏–µ:**

–ß–∏—Å—Ç—ã–π PQ:

- –•—Ä–∞–Ω–∏–º PQ-–∫–æ–¥—ã –¥–ª—è –≤—Å–µ—Ö N –≤–µ–∫—Ç–æ—Ä–æ–≤.
    
- –î–ª—è –∑–∞–ø—Ä–æ—Å–∞ –Ω—É–∂–Ω–æ –≤—ã—á–∏—Å–ª–∏—Ç—å —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ –≤—Å–µ—Ö N PQ-–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –≤–µ–∫—Ç–æ—Ä–æ–≤.
    
- –í—Å—ë —Ä–∞–≤–Ω–æ¬†`O(N)`¬†–ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –æ–±—ä–µ–∫—Ç–æ–≤ (—Ö–æ—Ç—è –∏ –¥—ë—à–µ–≤–æ –≤—ã—á–∏—Å–ª–∏—Ç–µ–ª—å–Ω–æ).
    

IVF+PQ:

1. –î–µ–ª–∏–º –≤–µ–∫—Ç–æ—Ä–∞ –Ω–∞ –∫–ª–∞—Å—Ç–µ—Ä—ã (IVF).
    
2. –í–Ω—É—Ç—Ä–∏ –∫–∞–∂–¥–æ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞ —Ö—Ä–∞–Ω–∏–º PQ-–∫–æ–¥—ã, –∞ –Ω–µ –∏—Å—Ö–æ–¥–Ω—ã–µ –≤–µ–∫—Ç–æ—Ä–∞.
    
3. –î–ª—è –∑–∞–ø—Ä–æ—Å–∞:
    
    - –ù–∞—Ö–æ–¥–∏–º –±–ª–∏–∂–∞–π—à–∏–µ¬†`nprobe`¬†–∫–ª–∞—Å—Ç–µ—Ä–æ–≤.
        
    - –°—á–∏—Ç–∞–µ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –ø–æ PQ —Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ –Ω–∏—Ö (M << N).
        

–†–µ–∑—É–ª—å—Ç–∞—Ç:

- –í—Ä–µ–º—è –ø–æ–∏—Å–∫–∞¬†`O(nprobe * n_cluster_size)`¬†–≤–º–µ—Å—Ç–æ¬†`O(N)`.
    
- –ü–∞–º—è—Ç—å —Å–∏–ª—å–Ω–æ –º–µ–Ω—å—à–µ, —á–µ–º –¥–ª—è —Ç–æ—á–Ω—ã—Ö float-–≤–µ–∫—Ç–æ—Ä–æ–≤.
    

---

### Hybrid search –∏ —Ñ–∏–ª—å—Ç—Ä—ã

#### –í–æ–ø—Ä–æ—Å: –ß—Ç–æ —Ç–∞–∫–æ–µ hybrid search (vector + keyword) –∏ –∑–∞—á–µ–º –æ–Ω?

**–û—Ç–≤–µ—Ç:**  
–ö–æ–º–±–∏–Ω–∞—Ü–∏—è —Å–µ–º–∞–Ω—Ç–∏–∫–∏ (–≤–µ–∫—Ç–æ—Ä) –∏ —Ç–æ—á–Ω–æ—Å—Ç–∏ (BM25/–∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞). –£–ª—É—á—à–∞–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å: —Ä–µ–¥–∫–∏–µ —Ç–µ—Ä–º–∏–Ω—ã/–∏–º–µ–Ω–∞ –ª–æ–≤—è—Ç—Å—è keyword, –æ–±—â–∏–π —Å–º—ã—Å–ª ‚Äî –≤–µ–∫—Ç–æ—Ä–æ–º.

**–¢–µ–æ—Ä–∏—è –∏ –ø–æ–Ω–∏–º–∞–Ω–∏–µ:**

–ü—Ä–æ–±–ª–µ–º–∞:

- –ß–∏—Å—Ç—ã–π BM25/TF-IDF:
    
    - –û—Ç–ª–∏—á–Ω–æ –ª–æ–≤–∏—Ç —Ç–æ—á–Ω—ã–µ —Ç–µ—Ä–º–∏–Ω—ã (–∏–º–µ–Ω–∞, –∞—Ä—Ç–∏–∫—É–ª—ã), –Ω–æ –ø–ª–æ—Ö–æ —Å–∏–Ω–æ–Ω–∏–º—ã/–ø–∞—Ä–∞—Ñ—Ä–∞–∑—ã.
        
- –ß–∏—Å—Ç—ã–π vector search:
    
    - –•–æ—Ä–æ—à–æ –ª–æ–≤–∏—Ç —Å–µ–º–∞–Ω—Ç–∏–∫—É, –Ω–æ –º–æ–∂–µ—Ç –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –≤–∞–∂–Ω—ã–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã (–∞—Ä—Ç–∏–∫—É–ª—ã, —Ü–∏—Ñ—Ä—ã, –∫–æ–¥—ã).
        

Hybrid:

- –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —Å—Ç—Ä–æ—è—Ç—Å—è:
    
    - text index (BM25/FTS).
        
    - vector index (HNSW/IVF+PQ).
        
- –î–ª—è –∑–∞–ø—Ä–æ—Å–∞:
    
    - –ü–æ–ª—É—á–∞–µ–º top-K –ø–æ –≤–µ–∫—Ç–æ—Ä—É (—Å–µ–º–∞–Ω—Ç–∏–∫–∞).
        
    - –ü–æ–ª—É—á–∞–µ–º top-K –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º.
        
    - –ö–æ–º–±–∏–Ω–∏—Ä—É–µ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, reranking, –≤–∑–≤–µ—à–µ–Ω–Ω–∞—è —Å—É–º–º–∞, LTR).
        

–ü—Ä–∏–º–µ—Ä:

- –ó–∞–ø—Ä–æ—Å: ‚Äú–∫—Ä–æ—Å—Å–æ–≤–∫–∏ –Ω–∞–π–∫ —á–µ—Ä–Ω—ã–µ 42‚Äù.
    
- –í–µ–∫—Ç–æ—Ä–Ω–∞—è —á–∞—Å—Ç—å –ø–æ–π–º—ë—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç ‚Äú–æ–±—É–≤—å / —Å–ø–æ—Ä—Ç–∏–≤–Ω–∞—è‚Äù.
    
- Keyword —á–∞—Å—Ç—å –æ—Å–æ–±–µ–Ω–Ω–æ –≤–∞–∂–Ω–∞ –¥–ª—è:
    
    - ‚Äú–Ω–∞–π–∫‚Äù (–±—Ä–µ–Ω–¥), ‚Äú42‚Äù (—Ä–∞–∑–º–µ—Ä), ‚Äú—á–µ—Ä–Ω—ã–µ‚Äù (—Ü–≤–µ—Ç).
        

---

#### –í–æ–ø—Ä–æ—Å: Pre-filter vs post-filter –ø–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º ‚Äî –ø–ª—é—Å—ã/–º–∏–Ω—É—Å—ã?

**–û—Ç–≤–µ—Ç:**  
Pre-filter —Å–Ω–∏–∂–∞–µ—Ç –Ω–∞–≥—Ä—É–∑–∫—É, –Ω–æ —Å–ª–æ–∂–Ω–µ–µ –¥–ª—è –∏–Ω–¥–µ–∫—Å–∞ –∏ –º–æ–∂–µ—Ç —Å–Ω–∏–∑–∏—Ç—å recall. Post-filter –ø—Ä–æ—â–µ, –Ω–æ –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å ‚Äú–ø–µ—Ä–µ–∑–∞–ø—Ä–æ—Å–∏—Ç—å‚Äù –±–æ–ª—å—à–µ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –∏ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç latency.

**–¢–µ–æ—Ä–∏—è –∏ –ø–æ–Ω–∏–º–∞–Ω–∏–µ:**

**Pre-filter:**

- –°–Ω–∞—á–∞–ª–∞ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ –ø–æ–∏—Å–∫–∞ –ø–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º:
    
    - `WHERE brand='Nike' AND size=42`.
        
- –ó–∞—Ç–µ–º –¥–µ–ª–∞–µ–º vector search¬†**—Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤**.
    

–ü–ª—é—Å—ã:

- –ú–µ–Ω—å—à–µ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ ‚Üí –±—ã—Å—Ç—Ä–µ–µ –ø–æ–∏—Å–∫.
    
- –ú–µ–Ω—å—à–µ –ø–∞–º—è—Ç–∏/CPU.
    

–ú–∏–Ω—É—Å—ã:

- –ò–Ω–¥–µ–∫—Å –¥–æ–ª–∂–µ–Ω –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å —Ç–∞–∫–∏–µ —Ñ–∏–ª—å—Ç—Ä—ã (—Å–ª–æ–∂–Ω–µ–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è).
    
- –ï—Å–ª–∏ —Ñ–∏–ª—å—Ç—Ä —Å–ª–∏—à–∫–æ–º –∂–µ—Å—Ç–∫–∏–π, –º–æ–∂–µ–º¬†**–ø–æ—Ç–µ—Ä—è—Ç—å**¬†—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã (recall –ø–∞–¥–∞–µ—Ç).
    

---

**Post-filter:**

- –°–Ω–∞—á–∞–ª–∞ –¥–µ–ª–∞–µ–º vector search –ø–æ –≤—Å–µ–π –±–∞–∑–µ:
    
    - –ë–µ—Ä—ë–º top-K (–Ω–∞–ø—Ä–∏–º–µ—Ä, 1000).
        
- –ü–æ—Ç–æ–º —Ñ–∏–ª—å—Ç—Ä—É–µ–º –ø–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º:
    
    - –û—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —Ç–µ, –≥–¥–µ¬†`brand='Nike' AND size=42`.
        
- –ï—Å–ª–∏ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤, –º–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å K –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å.
    

–ü–ª—é—Å—ã:

- –û—á–µ–Ω—å –ø—Ä–æ—Å—Ç–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è.
    
- –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –Ω–µ –∑–∞–≤—è–∑–∞–Ω—ã –Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –∏–Ω–¥–µ–∫—Å–∞.
    

–ú–∏–Ω—É—Å—ã:

- –ù—É–∂–Ω–æ –¥–æ—Å—Ç–∞–≤–∞—Ç—å –∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –±–æ–ª—å—à–µ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤.
    
- –ú–æ–∂–µ—Ç –≤—ã—Ä–∞—Å—Ç–∏ latency (–æ—Å–æ–±–µ–Ω–Ω–æ –µ—Å–ª–∏ K —Å–∏–ª—å–Ω–æ —É–≤–µ–ª–∏—á–∏–≤–∞—Ç—å).
    

–ù–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ:

- –ß–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –≥–∏–±—Ä–∏–¥: pre-filter –ø–æ –≥—Ä—É–±—ã–º, —Å—Ç–∞–±–∏–ª—å–Ω—ã–º —É—Å–ª–æ–≤–∏—è–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ä–µ–≥–∏–æ–Ω), post-filter –ø–æ –±–æ–ª–µ–µ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º.
    

---

#### –í–æ–ø—Ä–æ—Å: –ö–∞–∫ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –≤ vector DB, —á—Ç–æ–±—ã —Ñ–∏–ª—å—Ç—Ä—ã –±—ã–ª–∏ –±—ã—Å—Ç—Ä—ã–º–∏?

**–û—Ç–≤–µ—Ç:**  
–û—Ç–¥–µ–ª—å–Ω—ã–µ –ø–æ–ª—è —Å –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–µ–π/bitset, —Ö—Ä–∞–Ω–µ–Ω–∏–µ docIDs, –ø—Ä–µ–¥–≤—ã—á–∏—Å–ª–µ–Ω–Ω—ã–µ –º–∞—Å–∫–∏ –ø–æ –∞—Ç—Ä–∏–±—É—Ç–∞–º, –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–∞—Ä–¥–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å –∏ –∏–∑–±–µ–≥–∞–Ω–∏–µ ‚Äú–≤—ã—Å–æ–∫–æ–∫–∞—Ä–¥–∏–Ω–∞–ª—å–Ω—ã—Ö‚Äù —Ñ–∏–ª—å—Ç—Ä–æ–≤ –±–µ–∑ –∏–Ω–¥–µ–∫—Å–∞.

**–¢–µ–æ—Ä–∏—è –∏ –ø–æ–Ω–∏–º–∞–Ω–∏–µ:**

–û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–∏—ë–º—ã:

1. **DocID + –≤–Ω–µ—à–Ω–∏–π —Å—Ç–æ—Ä**:
    
    - –í–µ–∫—Ç–æ—Ä–Ω—ã–π –∏–Ω–¥–µ–∫—Å —Ö—Ä–∞–Ω–∏—Ç¬†`doc_id`.
        
    - –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ (—Ç–∞–±–ª–∏—Ü–∞/kv).
        
    - –§–∏–ª—å—Ç—Ä—ã —Ä–µ–∞–ª–∏–∑—É—é—Ç—Å—è —á–µ—Ä–µ–∑:
        
        - –ø—Ä–µ–¥–≤—ã—á–∏—Å–ª–µ–Ω–Ω—ã–µ bitset‚Äô—ã –ø–æ –∞—Ç—Ä–∏–±—É—Ç–∞–º (–Ω–∞–ø—Ä–∏–º–µ—Ä,¬†`is_premium`,¬†`region`).
            
        - –∏–Ω–¥–µ–∫—Å—ã –ø–æ –ø–æ–ª—è–º (B+Tree, bitmap).
            
2. **Bitset –ø–æ –Ω–∏–∑–∫–æ–∫–∞—Ä–¥–∏–Ω–∞–ª—å–Ω—ã–º –ø–æ–ª—è–º**:
    
    - –î–ª—è¬†`status`,¬†`region`,¬†`is_premium`¬†—Å–æ–∑–¥–∞—é—Ç—Å—è –±–∏—Ç–æ–≤—ã–µ –º–∞—Å–∫–∏.
        
    - –ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –ø–µ—Ä–µ—Å–µ–∫–∞—é—Ç—Å—è (AND) –Ω—É–∂–Ω—ã–µ –º–∞—Å–∫–∏.
        
3. **–ò–∑–±–µ–≥–∞—Ç—å –≤—ã—Å–æ–∫–æ–∫–∞—Ä–¥–∏–Ω–∞–ª—å–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤ –±–µ–∑ –∏–Ω–¥–µ–∫—Å–∞**:
    
    - –§–∏–ª—å—Ç—Ä¬†`user_id`¬†–Ω–∞ –º–∏–ª–ª–∏–æ–Ω—ã –∑–Ω–∞—á–µ–Ω–∏–π –±–µ–∑ –∏–Ω–¥–µ–∫—Å–∞ ‚Üí p99 latency –≤–∑–ª–µ—Ç–∞–µ—Ç.
        

---

### –≠–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—è, –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è, –∫–∞—á–µ—Å—Ç–≤–æ

#### –í–æ–ø—Ä–æ—Å: Online upsert/delete ‚Äî –ø–æ—á–µ–º—É —ç—Ç–æ —Å–ª–æ–∂–Ω–µ–µ –¥–ª—è HNSW?

**–û—Ç–≤–µ—Ç:**  
–ì—Ä–∞—Ñ–æ–≤—ã–µ –∏–Ω–¥–µ–∫—Å—ã —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã –∫ –¥–∏–Ω–∞–º–∏–∫–µ: —É–¥–∞–ª–µ–Ω–∏—è –æ—Å—Ç–∞–≤–ª—è—é—Ç ‚Äú–¥—ã—Ä—ã‚Äù, –∞–ø—Å–µ—Ä—Ç—ã —Ç—Ä–µ–±—É—é—Ç –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è. –ß–∞—Å—Ç–æ –Ω—É–∂–µ–Ω –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π rebuild/compaction –∏–ª–∏ tombstones.

**–¢–µ–æ—Ä–∏—è –∏ –ø–æ–Ω–∏–º–∞–Ω–∏–µ:**

- HNSW ‚Äî –≥—Ä–∞—Ñ. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–≤—è–∑–µ–π –æ–ø—Ç–∏–º–∞–ª—å–Ω–∞, –∫–æ–≥–¥–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –æ—Ñ—Ñ–ª–∞–π–Ω.
    
- –ü—Ä–∏ insert‚Äô–∞—Ö:
    
    - –í—Å—Ç–∞–≤–∫–∞ –Ω–æ–≤–æ–≥–æ —É–∑–ª–∞ —Ç—Ä–µ–±—É–µ—Ç:
        
        - –ü–æ–∏—Å–∫–∞ —Å–æ—Å–µ–¥–µ–π.
            
        - –û–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–µ–±–µ—Ä.
            
    - –≠—Ç–æ –¥–æ—Ä–æ–∂–µ, —á–µ–º insert –≤ –ø—Ä–æ—Å—Ç—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã (IVF —Å append).
        
- –ü—Ä–∏ delete:
    
    - –£–¥–∞–ª–µ–Ω–∏–µ –≤–µ—Ä—à–∏–Ω—ã –ø–æ—Ä—Ç–∏—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –≥—Ä–∞—Ñ–∞.
        
    - –ï—Å–ª–∏ –ø—Ä–æ—Å—Ç–æ –ø–æ–º–µ—Ç–∏—Ç—å ‚Äúdeleted‚Äù:
        
        - –ì—Ä–∞—Ñ –æ—Å—Ç–∞—ë—Ç—Å—è, –Ω–æ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è —Ö—É–∂–µ.
            
    - –ù—É–∂–Ω—ã:
        
        - tombstones (–ª–æ–≥–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ).
            
        - –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π rebuild/compaction.
            

–ü–æ—ç—Ç–æ–º—É –¥–ª—è high-churn (–º–Ω–æ–≥–æ updates/deletes) HNSW –º–æ–∂–µ—Ç –¥–µ–≥—Ä–∞–¥–∏—Ä–æ–≤–∞—Ç—å –±–µ–∑ —Ä–µ–≥—É–ª—è—Ä–Ω–æ–≥–æ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è.

---

#### –í–æ–ø—Ä–æ—Å: –ö–∞–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤–∞–∂–Ω—ã –¥–ª—è vector search?

**–û—Ç–≤–µ—Ç:**  
Recall@K / nDCG@K, latency p50/p95/p99, QPS, memory footprint, build time, update cost, tail latency –ø—Ä–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ö.

**–¢–µ–æ—Ä–∏—è –∏ –ø–æ–Ω–∏–º–∞–Ω–∏–µ:**

–ö–∞—á–µ—Å—Ç–≤–æ:

- **Recall@K**:
    
    - –°–∫–æ–ª—å–∫–æ –∏–∑ —Ç–æ–ø-N ‚Äú–∏—Å—Ç–∏–Ω–Ω—ã—Ö‚Äù —Å–æ—Å–µ–¥–µ–π –≤–µ—Ä–Ω—É–ª –∏–Ω–¥–µ–∫—Å –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ K.
        
- **nDCG@K**:
    
    - –û—Ü–µ–Ω–∏–≤–∞–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ —Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏—è, —É—á–∏—Ç—ã–≤–∞–µ—Ç –ø–æ–∑–∏—Ü–∏–∏.
        

–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:

- Latency:
    
    - p50, p95, p99 ‚Äî –º–µ–¥–∏–∞–Ω–∞ –∏ —Ö–≤–æ—Å—Ç—ã.
        
- QPS (queries per second).
    
- Memory:
    
    - –°–∫–æ–ª—å–∫–æ RAM –∏–Ω–¥–µ–∫—Å –µ—Å—Ç –Ω–∞ –∑–∞–¥–∞–Ω–Ω–æ–µ N.
        
- Build time:
    
    - –í—Ä–µ–º—è –ø–æ—Å—Ç—Ä–æ–π–∫–∏ –∏–Ω–¥–µ–∫—Å–∞ –Ω–∞ N –≤–µ–∫—Ç–æ—Ä–∞—Ö.
        
- Update cost:
    
    - –í—Ä–µ–º—è upsert/delete.
        
- Tail latency –ø—Ä–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ö:
    
    - –ù–∞—Å–∫–æ–ª—å–∫–æ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ—Ä—Ç–∏—Ç p99.
        

---

#### –í–æ–ø—Ä–æ—Å: Drift —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ ‚Äî —á—Ç–æ —ç—Ç–æ –∏ –∫–∞–∫ –∂–∏—Ç—å —Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º –º–æ–¥–µ–ª–∏?

**–û—Ç–≤–µ—Ç:**  
–ù–æ–≤–∞—è –º–æ–¥–µ–ª—å –º–µ–Ω—è–µ—Ç –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ ‚Üí —Å—Ç–∞—Ä—ã–µ –∏ –Ω–æ–≤—ã–µ –≤–µ–∫—Ç–æ—Ä—ã –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º—ã. –ü—Ä–∞–∫—Ç–∏–∫–∞: –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —ç–º–±–µ–¥–¥–∏–Ω–≥–∏, –¥–µ—Ä–∂–∞—Ç—å –¥–≤–∞ –∏–Ω–¥–µ–∫—Å–∞ (v1/v2), –º–∏–≥—Ä–∞—Ü–∏—è –±–∞—Ç—á–∞–º–∏, shadow-–æ—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞.

**–¢–µ–æ—Ä–∏—è –∏ –ø–æ–Ω–∏–º–∞–Ω–∏–µ:**

Drift:

- –ü–µ—Ä–µ–≤—ã—á–∏–ª–∏ –º–æ–¥–µ–ª—å —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤:
    
    - –°—Ç–∞—Ä—ã–µ embeddings:¬†`f_old(text)`.
        
    - –ù–æ–≤—ã–µ:¬†`f_new(text)`.
        
- `f_old`¬†–∏¬†`f_new`¬†–º–æ–≥—É—Ç –¥–∞–≤–∞—Ç—å —Å–æ–≤–µ—Ä—à–µ–Ω–Ω–æ —Ä–∞–∑–Ω—ã–µ –≤–µ–∫—Ç–æ—Ä—ã:
    
    - –ù–µ–ª—å–∑—è –ø—Ä–æ—Å—Ç–æ —Å–º–µ—à–∏–≤–∞—Ç—å –∏—Ö –≤ –æ–¥–Ω–æ–º –∏–Ω–¥–µ–∫—Å–µ.
        
    - –†–∞—Å—Å—Ç–æ—è–Ω–∏—è –º–µ–∂–¥—É¬†`f_old`¬†–∏¬†`f_new`¬†–Ω–µ–∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ–º—ã.
        

–ü–∞—Ç—Ç–µ—Ä–Ω—ã:

1. –í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ:
    
    - `embedding_version`¬†–∫–∞–∫ –ø–æ–ª–µ.
        
    - –û—Ç–¥–µ–ª—å–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã per version (`index_v1`,¬†`index_v2`).
        
2. –î–≤–æ–π–Ω–æ–π –∏–Ω–¥–µ–∫—Å:
    
    - –ü–æ–∫–∞¬†`v2`¬†–≤–∞–ª–∏–¥–∞—Ü–∏—è, –∑–∞–ø—Ä–æ—Å—ã –∏–¥—É—Ç –≤¬†`v1`.
        
    - –í —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ —Å—á–∏—Ç–∞—é—Ç—Å—è¬†`v2`¬†–∏ –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç—Å—è –∫–∞—á–µ—Å—Ç–≤–æ.
        
3. –ú–∏–≥—Ä–∞—Ü–∏—è –±–∞—Ç—á–∞–º–∏:
    
    - –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –ø–µ—Ä–µ—Ä–∞—Å—á–∏—Ç—ã–≤–∞–µ–º embeddings.
        
4. Shadow traffic:
    
    - –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º –æ—Ç–≤–µ—Ç—ã¬†`v1`¬†–∏¬†`v2`, –Ω–µ –≤–ª–∏—è—è –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
        

---

#### –í–æ–ø—Ä–æ—Å: –¢–∏–ø–∏—á–Ω—ã–µ production-–∞–Ω—Ç–∏–ø–∞—Ç—Ç–µ—Ä–Ω—ã —Å vector DB?

**–û—Ç–≤–µ—Ç:**

1. –±–µ–∑ –≤–µ—Ä—Å–∏–π —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤,
    
2. —Å–ª–∏—à–∫–æ–º –º–∞–ª–µ–Ω—å–∫–∏–π efSearch/nprobe ‚Äú—Ä–∞–¥–∏ —Å–∫–æ—Ä–æ—Å—Ç–∏‚Äù ‚Üí –ø–æ—Ç–µ—Ä—è –∫–∞—á–µ—Å—Ç–≤–∞,
    
3. –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ recall/latency,
    
4. —Å–º–µ—à–∏–≤–∞–Ω–∏–µ offline –∏ online –∏–Ω–¥–µ–∫—Å–æ–≤,
    
5. —Ñ–∏–ª—å—Ç—Ä—ã –±–µ–∑ –∏–Ω–¥–µ–∫—Å–∞ ‚Üí p99 –≤–∑—Ä—ã–≤–∞–µ—Ç—Å—è.
    

**–¢–µ–æ—Ä–∏—è –∏ –ø–æ–Ω–∏–º–∞–Ω–∏–µ (–∫—Ä–∞—Ç–∫–æ):**

- –ù–µ—Ç –≤–µ—Ä—Å–∏–π —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ ‚Üí –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –º–æ–¥–µ–ª–∏.
    
- –ê–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–æ–∏—Å–∫–∞ (efSearch, nprobe) –±–µ–∑ –º–µ—Ç—Ä–∏–∫ ‚Üí —Ö–æ—Ä–æ—à–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å, –Ω–æ –ø–∞–¥–∞–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ, –±–∏–∑–Ω–µ—Å –Ω–µ–¥–æ–≤–æ–ª–µ–Ω.
    
- –ù–µ—Ç –º–µ—Ç—Ä–∏–∫ –∫–∞—á–µ—Å—Ç–≤–∞ ‚Üí ‚Äú–Ω–∞ –≥–ª–∞–∑‚Äù —Ä–∞–±–æ—Ç–∞–µ—Ç/–Ω–µ—Ç, —Å–ª–æ–∂–Ω–æ –¥–µ–±–∞–∂–∏—Ç—å.
    
- Offline –∏–Ω–¥–µ–∫—Å (—Ä–µ–¥–∫–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è) —Å–º–µ—à–∞–Ω —Å online (—á–∞—Å—Ç–æ –º–µ–Ω—è–µ—Ç—Å—è) ‚Üí —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω.
    
- –§–∏–ª—å—Ç—Ä—ã –ø–æ –ø–æ–ª—è–º –±–µ–∑ –∏–Ω–¥–µ–∫—Å–æ–≤ ‚Üí –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ post-filter —Å –æ–≥—Ä–æ–º–Ω—ã–º K –∏ –¥–∏–∫–∏–º p99.
    

---

### RAG –∏ —Å–∏—Å—Ç–µ–º—ã

#### –í–æ–ø—Ä–æ—Å: RAG –ø–∞–π–ø–ª–∞–π–Ω ‚Äî —á—Ç–æ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ vector DB –∏ –∫–∞–∫ –≤—ã–±–∏—Ä–∞—é—Ç —á–∞–Ω–∫–∏?

**–û—Ç–≤–µ—Ç:**  
–•—Ä–∞–Ω—è—Ç embedding —á–∞–Ω–∫–æ–≤ + —Ç–µ–∫—Å—Ç + –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (doc_id, section, timestamp). Chunking: –ø–æ —Å–º—ã—Å–ª–æ–≤—ã–º –≥—Ä–∞–Ω–∏—Ü–∞–º, overlap, –¥–ª–∏–Ω–∞ –ø–æ–¥ –∫–æ–Ω—Ç–µ–∫—Å—Ç LLM. –ü–ª–æ—Ö–æ–π —á–∞–Ω–∫ ‚Üí –ø–ª–æ—Ö–æ–π retrieval.

**–¢–µ–æ—Ä–∏—è –∏ –ø–æ–Ω–∏–º–∞–Ω–∏–µ:**

–í vector DB –æ–±—ã—á–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—Å—è:

- `embedding`: –≤–µ–∫—Ç–æ—Ä —á–∞–Ω–∫–∞.
    
- `text`: —Å–∞–º —á–∞–Ω–∫ —Ç–µ–∫—Å—Ç–∞.
    
- `metadata`: doc_id, –∏—Å—Ç–æ—á–Ω–∏–∫, —Ä–∞–∑–¥–µ–ª, –≤—Ä–µ–º—è, –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞.
    

–ß–∞–Ω–∫–∏–Ω–≥:

- –†–∞–∑–±–∏–≤–∞–µ–º –¥–æ–∫—É–º–µ–Ω—Ç –Ω–∞ –∫—É—Å–∫–∏:
    
    - –ü–æ –∞–±–∑–∞—Ü–∞–º, –∑–∞–≥–æ–ª–æ–≤–∫–∞–º, —Å–º—ã—Å–ª–æ–≤—ã–º –±–ª–æ–∫–∞–º.
        
- –†–∞–∑–º–µ—Ä:
    
    - –û–±—ã—á–Ω–æ 200‚Äì1000 —Ç–æ–∫–µ–Ω–æ–≤ (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç –º–æ–¥–µ–ª–∏ –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞).
        
- Overlap:
    
    - –ù–µ–±–æ–ª—å—à–æ–µ –ø–µ—Ä–µ–∫—Ä—ã—Ç–∏–µ –º–µ–∂–¥—É —á–∞–Ω–∫–∞–º–∏ (10‚Äì30%), —á—Ç–æ–±—ã –Ω–µ ‚Äú—Ä–≤–∞—Ç—å‚Äù –º—ã—Å–ª—å.
        

–ü–ª–æ—Ö–æ–π —á–∞–Ω–∫–∏–Ω–≥:

- –°–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π ‚Üí —á–∞—Å—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è (–æ–±—Ä–µ–∑–∫–∞).
    
- –°–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π ‚Üí –æ—Ç–≤–µ—Ç –Ω–µ –∏–º–µ–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.
    
- –†–≤—ë—Ç —Ç–∞–±–ª–∏—Ü—ã, –∫–æ–¥, —Ñ–æ—Ä–º—É–ª—ã ‚Üí retrieval –±–µ—Å—Å–º—ã—Å–ª–µ–Ω–Ω—ã–π.
    

---

#### –í–æ–ø—Ä–æ—Å: –ü–æ—á–µ–º—É ‚Äúretrieval‚Äù —á–∞—â–µ –≤–∞–∂–Ω–µ–µ, —á–µ–º ‚Äú–≥–µ–Ω–µ—Ä–∞—Ü–∏—è‚Äù –≤ RAG?

**–û—Ç–≤–µ—Ç:**  
LLM —Ö–æ—Ä–æ—à–æ –ø–∏—à–µ—Ç, –Ω–æ –Ω–µ —É–≥–∞–¥—ã–≤–∞–µ—Ç —Ñ–∞–∫—Ç—ã. –ï—Å–ª–∏ retrieval –ø—Ä–∏–Ω–æ—Å–∏—Ç –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç ‚Äî –º–æ–¥–µ–ª—å —É–≤–µ—Ä–µ–Ω–Ω–æ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ. –ü–æ—ç—Ç–æ–º—É –∫–∞—á–µ—Å—Ç–≤–æ –∏–Ω–¥–µ–∫—Å–∞, chunking –∏ hybrid search –∫—Ä–∏—Ç–∏—á–Ω—ã.

**–¢–µ–æ—Ä–∏—è –∏ –ø–æ–Ω–∏–º–∞–Ω–∏–µ:**

- LLM –±–µ–∑ —Ö–æ—Ä–æ—à–µ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞:
    
    - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —É–±–µ–¥–∏—Ç–µ–ª—å–Ω—ã–π, –Ω–æ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –Ω–µ–≤–µ—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç (hallucinations).
        
- RAG:
    
    - –ö–∞—á–µ—Å—Ç–≤–æ –æ—Ç–≤–µ—Ç–∞ –ø–æ—á—Ç–∏ –ª–∏–Ω–µ–π–Ω–æ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–∞—á–µ—Å—Ç–≤–∞ retrieved –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.
        
- –ï—Å–ª–∏ retrieval –ø—Ä–∏–Ω–æ—Å–∏—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∏–ª–∏ –Ω–µ–ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:
    
    - –ú–æ–¥–µ–ª—å –Ω–µ ‚Äú—Å–∫–∞–∂–µ—Ç —á–µ—Å—Ç–Ω–æ, —á—Ç–æ –Ω–µ –∑–Ω–∞–µ—Ç‚Äù, –∞ –ø–æ–ø—ã—Ç–∞–µ—Ç—Å—è –¥–æ–≥–∞–¥–∞—Ç—å—Å—è.
        
    - –û—Ç—Å—é–¥–∞ –ª–æ–∂–Ω—ã–µ —É–≤–µ—Ä–µ–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã.
        

–ü–æ—ç—Ç–æ–º—É:

- –ë–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –∏ —É—Å–∏–ª–∏–π –Ω–∞–¥–æ —Ç—Ä–∞—Ç–∏—Ç—å –Ω–∞:
    
    - –ß–∞–Ω–∫–∏–Ω–≥.
        
    - –ò–Ω–¥–µ–∫—Å.
        
    - –ú–µ—Ç—Ä–∏–∫–∏ retrieval (recall, MRR, nDCG).
        
    - Hybrid search.
        
- –ê –Ω–µ —Ç–æ–ª—å–∫–æ –Ω–∞ ‚Äú–ø–æ–¥–∫—Ä—É—Ç–∫—É –ø—Ä–æ–º–ø—Ç–∞‚Äù.
    

---

#### –í–æ–ø—Ä–æ—Å: –ö–∞–∫ –æ—Ü–µ–Ω–∏–≤–∞—Ç—å RAG end-to-end?

**–û—Ç–≤–µ—Ç:**  
Offline: retrieval metrics + answer correctness (human/LLM-judge), citation precision, faithfulness. Online: CTR/CSAT, –æ—Ç–∫–∞–∑/—ç—Å–∫–∞–ª–∞—Ü–∏–∏, latency, ‚Äúno answer‚Äù rate.

**–¢–µ–æ—Ä–∏—è –∏ –ø–æ–Ω–∏–º–∞–Ω–∏–µ:**

Offline:

1. **Retrieval-–º–µ—Ç—Ä–∏–∫–∏**:
    
    - Recall@K: –ø–æ–ø–∞–ª –ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –≤ —Ç–æ–ø-K.
        
    - nDCG@K: —É—á–∏—Ç—ã–≤–∞–µ—Ç –ø–æ–∑–∏—Ü–∏—é —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.
        
2. **Answer-–º–µ—Ç—Ä–∏–∫–∏**:
    
    - Accuracy/F1 –ø–æ –æ—Ç–≤–µ—Ç–∞–º –Ω–∞ —Ç–µ—Å—Ç–æ–≤—ã–µ –≤–æ–ø—Ä–æ—Å—ã.
        
    - Human evaluation –∏–ª–∏ LLM-as-a-judge.
        
3. **Citation-–º–µ—Ç—Ä–∏–∫–∏**:
    
    - –ù–∞—Å–∫–æ–ª—å–∫–æ —Å—Å—ã–ª–∫–∏/—Ü–∏—Ç–∞—Ç—ã –≤ –æ—Ç–≤–µ—Ç–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –∏—Å—Ç–æ—á–Ω–∏–∫—É.
        
4. **Faithfulness**:
    
    - –û—Ç–≤–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç—É, –Ω–µ –ø—Ä–∏–≤–Ω–æ—Å–∏—Ç –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Ñ–∞–∫—Ç—ã.
        

Online:

- –ü–æ–≤–µ–¥–µ–Ω—á–µ—Å–∫–∏–µ:
    
    - CTR (–µ—Å–ª–∏ —ç—Ç–æ –ø–æ–∏—Å–∫–æ–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å).
        
    - CSAT/Thumbs up-down.
        
    - –î–æ–ª—è —ç—Å–∫–∞–ª–∞—Ü–∏–π –Ω–∞ —á–µ–ª–æ–≤–µ–∫–∞.
        
    - ‚Äúno answer‚Äù / ‚ÄúI don‚Äôt know‚Äù rate.
        
- –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ:
    
    - Latency (p50/p95/p99).
        
    - –û—Ç–∫–∞–∑—ã.
        
    - –¢–∞–π–º-–∞—É—Ç—ã.
        

---

### –°—É–ø–µ—Ä–∫–æ—Ä–æ—Ç–∫–∏–π –±–ª–æ–∫ ‚Äú—Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º‚Äù (—á–∞—Å—Ç–æ —Å–ø—Ä–∞—à–∏–≤–∞—é—Ç)

#### –í–æ–ø—Ä–æ—Å: FAISS vs Milvus/Weaviate/Pinecone ‚Äî –æ–¥–Ω–∞ —Ñ—Ä–∞–∑–∞?

**–û—Ç–≤–µ—Ç:**  
FAISS ‚Äî –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∏–Ω–¥–µ–∫—Å–∞/–ø–æ–∏—Å–∫–∞ (—á–∞—Å—Ç–æ single-node, –≤—Å—Ç—Ä–∞–∏–≤–∞–µ–º–∞—è). Milvus/Weaviate ‚Äî —Å–µ—Ä–≤–µ—Ä–Ω—ã–µ open-source vector DB (–∫–ª–∞—Å—Ç–µ—Ä, —Ö—Ä–∞–Ω–µ–Ω–∏–µ, —Ñ–∏–ª—å—Ç—Ä—ã). Pinecone ‚Äî managed SaaS vector DB.

**–¢–µ–æ—Ä–∏—è –∏ –ø–æ–Ω–∏–º–∞–Ω–∏–µ (–∫–æ—Ä–æ—Ç–∫–æ):**

- **FAISS**:
    
    - C++/Python –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –æ—Ç Meta.
        
    - –û—á–µ–Ω—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã (HNSW, IVF, PQ...).
        
    - –ù–æ –Ω–µ—Ç ‚Äú–±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö‚Äù: –Ω–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö, –Ω–∏ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏, –Ω–∏ –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏–∏ ‚Äî –≤—Å—ë –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å —Å–∞–º–æ–º—É.
        
- **Milvus/Weaviate/Qdrant/Vald**:
    
    - –°–µ—Ä–≤–µ—Ä–Ω—ã–µ, –∫–ª–∞—Å—Ç–µ—Ä–Ω—ã–µ, open-source.
        
    - –•—Ä–∞–Ω—è—Ç –≤–µ–∫—Ç–æ—Ä–∞ + –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ.
        
    - –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç —Ñ–∏–ª—å—Ç—Ä—ã, —à–∞—Ä–¥–∏—Ä–æ–≤–∞–Ω–∏–µ, —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é.
        
- **Pinecone/Vertex Matching Engine –∏ —Ç.–ø.**:
    
    - Managed SaaS.
        
    - –°–Ω–∏–º–∞—é—Ç –≥–æ–ª–æ–≤–Ω—É—é –±–æ–ª—å –ø–æ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–µ, –∑–∞ –¥–µ–Ω—å–≥–∏.
        

---

–ì–æ—Ç–æ–≤–æ: –≤–µ—Å—å –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ –≤–æ–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤ —Ç–µ–ø–µ—Ä—å –∑–∞–∫—Ä—ã—Ç —Ç–µ–æ—Ä–∏–µ–π.  
–ï—Å–ª–∏ —Ö–æ—á–µ—à—å, –º–æ–≥—É:

- –°–∂–∞—Ç—å —ç—Ç–æ –≤ –±–æ–ª–µ–µ –∫–æ–º–ø–∞–∫—Ç–Ω—É—é –≤–µ—Ä—Å–∏—é –¥–ª—è ‚Äú–ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è –ø–µ—Ä–µ–¥ —Å–æ–±–µ—Å–æ–º‚Äù.
    
- –ò–ª–∏ —Ä–∞–∑–Ω–µ—Å—Ç–∏ –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ –±–ª–æ–∫–∏: ‚ÄúSQL/–∏–Ω–¥–µ–∫—Å—ã/ACID‚Äù, ‚ÄúDistributed/CAP‚Äù, ‚ÄúVector/RAG‚Äù.